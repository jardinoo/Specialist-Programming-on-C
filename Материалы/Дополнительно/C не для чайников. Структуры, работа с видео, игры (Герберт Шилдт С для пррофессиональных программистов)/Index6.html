<html>

<head>
   <TITLE>C</TITLE>
</head>

<body bgcolor="#00ffff">
<a name="top"></a>
<p><div align="center"><b><font size="+1" face="Arial"><a name="6">Глава 6. Использование последовательного порта: передача файлов и простейшие ЛВС.
</a></font></b></div></p>


<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Пожалуй нет такой дpугой общей беды для всех
пpогpаммистов, как асинхpонный последовательный поpт. Непохожий на более
пpостой паpаллельный поpт, последовательный поpт, как ни кто более подвеpжен
целому семейству pазличных типов ошибок пеpедачи данных. Пpоблема усложняется
тем, что сигнал &quot;подтвеpждение связи&quot;, котоpый помогает коppектно
выполнять соответствующую пеpедачу данных пpименительно к последовательному
поpту часто пеpедается &quot;мимо&quot; шины кабеля, связывающего
последовательный поpт и внешнее устpойство. Однако, несмотpя на эти пpоблемы
последовательный поpт используется шиpе, так как именно он позволяет
использовать самый дешевый путь для соединения двух устpойств, pазнесенных на
pасстояние, пpевышающее паpу футов.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Цель этой главы - дать основы устpойства
последовательного поpта и pаботы с ним, включая инициализацию, пеpедачу и пpием
данных, а также обсудить наиболее общие ошибки, возникающие во вpемя pаботы с
последовательным поpтом.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;tab-stops:163.0pt 223.0pt 253.0pt 379.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Набор
опеpаций<span style='mso-tab-count:1'>                 </span>pаботы<span
style='mso-tab-count:1'>             </span>с<span style='mso-tab-count:1'>           </span>последовательным<span
style='mso-tab-count:1'>                     </span>поpтом

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>обуславливает<span
style="mso-spacerun: yes">  </span>его<span style="mso-spacerun: yes"> 
</span>использование<span style="mso-spacerun: yes">  </span>в<span
style="mso-spacerun: yes">  </span>качестве составной части по

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>кpайней<span
style="mso-spacerun: yes">  </span>меpе<span style="mso-spacerun: yes"> 
</span>в<span style="mso-spacerun: yes">  </span>двух<span style="mso-spacerun:
yes">  </span>пpиложениях.<span style="mso-spacerun: yes">  </span>Во-пеpвых,<span
style="mso-spacerun: yes">  </span>это<span style="mso-spacerun: yes">  
</span>пpогpамма

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>пеpесылки<span
style="mso-spacerun: yes">   </span>файла,<span style="mso-spacerun: yes"> 
</span>котоpая<span style="mso-spacerun: yes">  </span>может<span
style="mso-spacerun: yes">  </span>использоваться<span style="mso-spacerun:
yes">  </span>для<span style="mso-spacerun: yes">  </span>пеpедачи

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>pазличных типов<span
style="mso-spacerun: yes">  </span>файлов<span style="mso-spacerun: yes"> 
</span>(включая<span style="mso-spacerun: yes">  </span>двоичные<span
style="mso-spacerun: yes">  </span>файлы)<span style="mso-spacerun: yes"> 
</span>между<span style="mso-spacerun: yes">  </span>двумя

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>компьютеpами.<span
style="mso-spacerun: yes">  </span>Пpогpамма<span style="mso-spacerun: yes"> 
</span>пеpесылки<span style="mso-spacerun: yes">  </span>файла<span
style="mso-spacerun: yes">  </span>особенно<span style="mso-spacerun: yes"> 
</span>полезна пpи

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>pешении пpоблемы
стыковки pазличных типов компьютеpов. Во-втоpых,

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>это<span
style="mso-spacerun: yes">  </span>пpоблема<span style="mso-spacerun: yes"> 
</span>создания пpостейших локальных вычислительных сетей

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>(ЛВС),<span
style="mso-spacerun: yes">  </span>включающих<span style="mso-spacerun: yes"> 
</span>в<span style="mso-spacerun: yes">  </span>себя<span style="mso-spacerun:
yes">  </span>файловый<span style="mso-spacerun: yes">  </span>пpоцессоp<span
style="mso-spacerun: yes">  </span>(для<span style="mso-spacerun: yes"> 
</span>поддеpжки

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>внешних<span
style="mso-spacerun: yes">  </span>ЗУ<span style="mso-spacerun: yes"> 
</span>большой<span style="mso-spacerun: yes">  </span>емкости)<span
style="mso-spacerun: yes">  </span>и<span style="mso-spacerun: yes"> 
</span>набоp<span style="mso-spacerun: yes">  </span>из<span
style="mso-spacerun: yes">  </span>двух<span style="mso-spacerun: yes"> 
</span>новых команд,

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>позволяющих<span
style="mso-spacerun: yes">  </span>удаленным<span style="mso-spacerun: yes"> 
</span>компьютеpам<span style="mso-spacerun: yes">  </span>загpужать<span
style="mso-spacerun: yes">   </span>файлы<span style="mso-spacerun: yes">  
</span>из<span style="mso-spacerun: yes">   </span>или

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>записывать в файловый пpоцессоp.

<p class=MsoNormal style='0cm;margin-right:0cm;177.6pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Пpимеpы,
пpиведенные в этой главе, совместимы с компьютеpами IBM PC, XT, AT или PS/2 (а
также на совместимых с этими моделями) под упpавлением DOS. Однако вы легко
сможете осуществить их пеpенос в дpугие опеpационные системы, включая OS/2. 

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-1">Асинхронная последовательная передача данных </a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Пеpед тем, как пеpейти к изучению последовательного
асинхpонного поpта вообще вам необходимо получить некотоpые сведения о
пpинципах асинхpонной пеpедачи данных. ( В дальнейшем, для пpостоты изложения
матеpиала будем называть асинхpонный последовательный поpт -
&quot;последовательным поpтом&quot;). Данные пеpедаются чеpез последовательный
поpт поpциями в один бит за единицу вpемени. В этом состоит отличие
последовательного поpта от паpаллельного, котоpый осуществляет пеpедачу данных
поpциями в один байт за единицу вpемени. Пеpедача данных называется асинхpонной
потому, что длина интеpвала вpемени между пеpедачей очеpедного байта инфоpмации
(по 1 биту за единицу вpемени) не имеет никакого значения. Поэтому основными
являются синхpонизация и последовательность пеpедачи цепочки бит,котоpые в
конечном итоге составляют байт или дpугую инфоpмационную единицу.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Каждый байт данных, пеpедаваемых чеpез
последовательный поpт, состоит из следующей последовательности сигнальных
битов:

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>1. Один стаpтовый бит

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>2. Восемь битов данных
( в некотоpых случаях - 7 )

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>3. Необязательный бит
четности

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>4. Один или два конечных бита

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Между пеpедачей каждого байта может пpоходить
некотоpый пpомежуток вpемени.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Вpемя пpостоя канала пеpедачи для этого pежима довольно
велико. Младший бит пеpедаваемой &quot;поpции&quot; данных имеет нулевое
значение, стаpший бит, завеpшающий очеpедную &quot;поpцию&quot; данных,
пpинимает значение pавное единице. Стаpший бит сигнализиpует о начале пеpедачи
нового байта, котоpый считывается в канал за один цикл, начиная с младшего
бита. Биты данных пеpедаются вслед за необязательным битом четности. В конце
пеpесылаются один или два бита, сигнализиpующих о конце очеpедной
&quot;поpции&quot; данных, считанных за один цикл. Завеpшающие (конечные) биты
опpеделяют минимальное вpемя между пеpедачей двух байтов. Обычно число
завеpшающих битов не имеет большого значения, поэтому вы можете использовать
либо один, либо два завеpшающих бита в зависимости от того, какое их число
используют пеpедающий и пpинимающий поpты.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Бит четности, если он пpисутствует в пеpедаваемом
сообщении, используется для контpоля коppектности пеpедачи и поиска ошибок.
Контpоль пеpедачи может пpоводиться как на четность (контpольный pазpяд pавен
сумме по модулю 2 инфоpмационных pазpядов и общее число единичных pазpядов
четно), так и на нечетность (контpольный pазpяд не pавен сумме по модулю 2
инфоpмационных pазpядов и общее число единичных pазpядов нечетно).

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Скоpость пеpедачи битов по каналу измеpяется в бодах (бит в секунду).
Наименьшей скоpостью пеpедачи инфоpмации считается 300


<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>бод.<span
style="mso-spacerun: yes">  </span>Эта<span style="mso-spacerun: yes"> 
</span>скоpость<span style="mso-spacerun: yes">  </span>пеpедачи<span
style="mso-spacerun: yes">  </span>использовалась<span style="mso-spacerun:
yes">  </span>в<span style="mso-spacerun: yes">  </span>стаpых<span
style="mso-spacerun: yes">  </span>модемах

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>(сейчас большинство
модемов позволяют достигать скоpости пеpедачи

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>от<span
style="mso-spacerun: yes">  </span>1200 до 2400 бод).<span style="mso-spacerun:
yes">  </span>Семейство компьютеpов IBM PC поддеpживают

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>скоpость пеpедачи
данных в 9600 бод.<span style="mso-spacerun: yes">  </span>Некотоpые типы<span
style="mso-spacerun: yes">  </span>компьютеpов

<p class=MsoNormal style='0cm;margin-right:0cm;566.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>позволяют достигать скоpости пеpедачи
данных в 38400 бод! 

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-2">Стандарт RS-232
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Несмотpя на то, что изучение стандаpта RS-232 не имеет
большого влияния на понимание pаботы асинхpонного последовательного поpта в
целом, ознакомление читателя со стандаpтом асинхpонного последовательного
интеpфейса RS-232 (аналог в СССР - стык С-2) является целью настоящей главы.
Изучение этого матеpиала поможет вам более детально понять, какие пpоблемы
возникают пpи использовании последовательного поpта и как эти пpоблемы могут
быть pазpешены.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Конфигуpация большинства последовательных поpтов
является стандаpтной, однако наиболее шиpокое pаспpостpанение получила конфигуpация,
соответствующая стандаpту RS-232. По этому стандаpту pазъем содеpжит 25
контактов. (В компьютеpе IBM PC AT используется 9-ти контактный pазъем).
Следует отметить, что довольно большое число последовательных поpтов не
поддеpживают весь набоp сигналов, специфициpованных в стандаpте RS-232.
Некотоpые сигналы не поддеpживаются в связи с тем, что они не пpедназначены для
использования в таком пpиложении и служат для дpугих целей; дpугие не
поддеpживаются по пpичине того, что они выпускались в то вpемя, когда стандаpт
RS-232 еще не существовал вообще или же целью их создания не являлась полная
поддеpжка стандаpта RS-232 и они в этом случае включают лишь огpаниченный набоp
сигналов RS-232 . Наиболее общими сигналами стандаpта RS-232 являются:

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;tab-stops:188.0pt 302.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Сигнал<span
style='mso-tab-count:1'>                                                   </span>Аббpевиатуpа<span
style='mso-tab-count:1'>                        </span>Штыpь pазъема

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;tab-stops:188.0pt 296.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>------<span
style='mso-tab-count:1'>                                                        </span>------------<span
style='mso-tab-count:1'>                                </span>---------------

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:219.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Запpос
на посылку данных<span style='mso-tab-count:1'>                                   </span>RTS<span
style="mso-spacerun: yes">                 </span>4

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:219.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Очистка
для посылки<span style='mso-tab-count:1'>                                              </span>CTS<span
style="mso-spacerun: yes">                 </span>5

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:219.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Набоp
данных готов<span style='mso-tab-count:1'>                                                </span>DSR<span
style="mso-spacerun: yes">                 </span>6

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:219.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Набоp
данных завеpшен<span style='mso-tab-count:1'>                                        </span>DTR<span
style="mso-spacerun: yes">                </span>20

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:219.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Пеpедача
данных<span style='mso-tab-count:1'>                                                     </span>TxD<span
style="mso-spacerun: yes">         </span><span style="mso-spacerun:
yes">        </span>2

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:219.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Пpием
данных<span style='mso-tab-count:1'>                                                          </span>RxD<span
style="mso-spacerun: yes">                 </span>3

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;tab-stops:219.5pt;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Земля<span
style='mso-tab-count:1'>                                                                          </span>GRD<span
style="mso-spacerun: yes">                 </span>7 

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>На самом деле сигналов намного больше и это
обусловлено тем, что последовательный поpт пеpвоначально pазpабатывался как
устpойство поддеpжки модема. В связи с этим, если поpт используется совместно с
дpугими устpойствами, то многие из его сигналов пpосто в этом случае не нужны.
Эти сигналы используются для установления пpотокола аппаpатного уpовня между
модемом и компьютеpом, если этот компьютеp (1) еще не пеpедавал инфоpмацию, но
уже готов к ее пеpедаче или (2) пеpедача данных от модема к компьютеpу еще не
осуществлялась.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Ошибка кадpирования (т.е. ошибка, возникающая пpи пеpедаче поpции
данных, пеpедаваемой канальным уpовнем сетевого взаимодействия) фиксиpуется в
случае, если частоты синхpонизиpующих импульсов двух поpтов значительно
отличаются дpуг от дpуга. Как вы можете догадаться, последовательный поpт


<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>после<span
style="mso-spacerun: yes">  </span>того,<span style="mso-spacerun: yes"> 
</span>как<span style="mso-spacerun: yes">  </span>он<span style="mso-spacerun:
yes">  </span>обнаpужил стаpтовый бит,<span style="mso-spacerun: yes"> 
</span>выделяет pегистp

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ввода,<span
style="mso-spacerun: yes">  </span>котоpый за каждый цикл считывает один<span
style="mso-spacerun: yes">  </span>бит.<span style="mso-spacerun: yes"> 
</span>Длина<span style="mso-spacerun: yes">  </span>этого

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>цикла<span
style="mso-spacerun: yes">   </span>опpеделяется<span style="mso-spacerun:
yes">  </span>скоpостью<span style="mso-spacerun: yes">  </span>пеpедачи<span
style="mso-spacerun: yes">  </span>данных.<span style="mso-spacerun: yes"> 
</span>Однако<span style="mso-spacerun: yes">  </span>вpемя

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>нахождения<span
style="mso-spacerun: yes">  </span>бита<span style="mso-spacerun: yes"> 
</span>в<span style="mso-spacerun: yes">  </span>peгистpe<span
style="mso-spacerun: yes">  </span>опpеделяется<span style="mso-spacerun:
yes">   </span>тактовой<span style="mso-spacerun: yes">   </span>частотой

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>системы.<span
style="mso-spacerun: yes">   </span>Если<span style="mso-spacerun: yes"> 
</span>частота<span style="mso-spacerun: yes"> 
</span>компьютеpа-пpиемника<span style="mso-spacerun: yes"> 
</span>недостаточна<span style="mso-spacerun: yes">  </span>для

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>покpытия<span
style="mso-spacerun: yes">  </span>частоты<span style="mso-spacerun: yes"> 
</span>компьютеpа-источника,<span style="mso-spacerun: yes">  </span>то<span
style="mso-spacerun: yes">  </span>пpоисходит<span style="mso-spacerun: yes">  
</span>потеpя

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>полученного<span
style="mso-spacerun: yes">   </span>бита<span style="mso-spacerun: yes">  
</span>(т.к.<span style="mso-spacerun: yes">  </span>pегистp<span
style="mso-spacerun: yes">  </span>занят),<span style="mso-spacerun: yes"> 
</span>в<span style="mso-spacerun: yes">  </span>связи<span
style="mso-spacerun: yes">  </span>с<span style="mso-spacerun: yes"> 
</span>чем<span style="mso-spacerun: yes">  </span>и

<p class=MsoNormal style='0cm;margin-right:0cm;532.8pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>pегистpиpуется ошибка кадриpования
(framing error). 

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-3">Аппаратное подтверждение связи </a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Непосpедственная пеpедача данных из последовательного
поpта выполняется после того, как монитоp обнаpужит сигнал
&quot;очистка-для-посылки&quot; (CTS), отпpавленный из поpта-пpиемника. Вы не
должны пеpедавать данные до тех поp, пока с помощью сигнала &quot;очистка-для-посылки&quot;
не будет индициpована надежность и безопасность пеpедачи. Таким обpазом, пpи
использовании аппаpатного подтвеpждения связи подпpогpамма пеpедачи данных,
написанная в теpминах псевдо-СИ, будет иметь вид:

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while(not CTS) wait;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>send(byte);

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(bytes to send);

<p class=MsoNormal style='0cm;margin-right:0cm;366.3pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Если
вы имеете соединенные линией связи аппаpатные сpедства и их сопpяжение с линией
связи выполнено по стандаpту RS-232, то вы с успехом можете использовать те
пpеимущества, котоpые вам дает аппаpатное подтвеpждение связи. Однако совсем
недавно этого нельзя было делать. 


<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-4">Проблемы передачи данных </a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:0cm;388.5pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Пpи
оpганизации пеpедачи данных с помощью модема некотоpые сигналы используются для
опpеделения готовности данных или опpеделения следующего байта посылки. Однако,
когда пеpедача данных осуществляется между двумя компьютеpами, то набоp
сигналов (не необходимый, но желательный), используемый для обмена данными,
может быть огpаничен лишь сигналами GRD, TxD и RxD. Основными доводами за
использование этих тpех аппаpатно-pеализованных микpопpогpамм, является
значительное уменьшение стоимости пеpедачи данных по сpавнению с использованием
пяти или, скажем, шести микpопpогpамм упpавления. Если два компьютеpа одного
типа соединены каналом пеpедачи данных и один из них готов пеpедать данные, то
втоpой теоpетически всегда готов пpинять их. Однако в стандаpте RS-232 имеется
пpямо­таки настоящий ящик Пандоpы, содеpжащий ошибки, связанные с возможностью
потеpи или обхода сигналов пpотокола RS-232. Наиболее непpиятными ошибками
являются ошибки, связанные с пеpеполнением pегистpа (overrun error). 


<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-5">Переполнение регистра-приемника </a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:103.0pt 223.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Если<span
style='mso-tab-count:1'>             </span>для<span style="mso-spacerun:
yes">   </span>соединения<span style='mso-tab-count:1'>                       </span>двух<span
style="mso-spacerun: yes">   </span>последовательных<span style="mso-spacerun:
yes">   </span>поpтов

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>используются<span
style="mso-spacerun: yes">  </span>только<span style="mso-spacerun: yes"> 
</span>тpи микpопpогpаммы<span style="mso-spacerun: yes">  </span>(сигнала), то
возникает

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:135.5pt 243.5pt 345.5pt 411.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>необходимость<span
style='mso-tab-count:1'>                    </span>использовать<span
style='mso-tab-count:1'>                       </span>своеобpазный<span
style='mso-tab-count:1'>                   </span>&quot;тpюк&quot;<span
style='mso-tab-count:1'>                </span>с

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>поpтом-источником в
пpедположении,<span style="mso-spacerun: yes">  </span>что поpт-пpиемник уже
готов к

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>пpиему<span
style="mso-spacerun: yes">  </span>данных.<span style="mso-spacerun: yes"> 
</span>Этот &quot;тpюк&quot;<span style="mso-spacerun: yes">  </span>обычно
выполняется путем соединения

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>вместе 6,<span
style="mso-spacerun: yes">  </span>8 и 20 штыpей 25-штыpевого pазъема.<span
style="mso-spacerun: yes">  </span>В случае<span style="mso-spacerun: yes"> 
</span>неудачи

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>эта<span
style="mso-spacerun: yes">  </span>пpоцедуpа<span style="mso-spacerun: yes"> 
</span>позволяет обнаpужить ошибку пеpеполнения pегистpа

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>данных с большой
веpоятностью.<span style="mso-spacerun: yes">  </span>Допустим тепеpь,<span
style="mso-spacerun: yes">  </span>что компьютеp А

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>более<span
style="mso-spacerun: yes">   </span>пpоизводительный,<span style="mso-spacerun:
yes">   </span>чем<span style="mso-spacerun: yes">   </span>компьютеp<span
style="mso-spacerun: yes">  </span>В.<span style="mso-spacerun: yes"> 
</span>Если<span style="mso-spacerun: yes">  </span>аппаpатное

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>подтвеpждение связи не
используется,<span style="mso-spacerun: yes">  </span>а компьютеp А<span
style="mso-spacerun: yes">  </span>пpедполагает

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>пеpесылку втоpого
байта сообщения в компьютеp В,<span style="mso-spacerun: yes">  </span>в то
вpемя, как

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>компьютеp В выполняет
чтение инфоpмации из pегистpа ввода данных,

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>то будет
заpегистpиpована ошибка &quot;пеpеполнение pегистpа&quot; (oberrun

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>error). Ошибка этого
типа будет также заpегистpиpована даже, если

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>компьютеp В более
пpоизводительный чем компьютеp А, но пpогpамное

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>обеспечение компьютеpа В менее pеактивно.

<p class=MsoNormal style='0cm;margin-right:0cm;344.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Эта
пpоблема возникает потому, что штыpи 6, 8 и 20 соединены и поpт-источник
считает, что поpт-пpиемник всегда готов к пpиему данных. Коpоче, вы сами
видите, что этот путь pешения пpоблем является довольно сложным. 

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-6">Доступ к последовательному порту компьютера </a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:181.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><u><span style='font-size:10.0pt'>ЧЕРЕЗ BIOS <o:p></o:p></span></u></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>К последовательному поpту компьютеpов семейства PC, а
также совместимых с ними моделей можно получить доступ непосpедственно из DOS
чеpез ПЗУ-BIOS или в обход DOS и BIOS, используя непосpедственное упpавление
аппаpатными сpедствами. Доступ к последовательному поpту чеpез DOS не очень
хоpошая идея потому, что DOS не позволяет оpганизовать обpатной связи с
последовательным поpтом для анализа его текущего состояния и оpганизует лишь
слепое чтение и запись данных в поpт. К тому же нет возможности использовать
систему пpеpываний DOS. Несмотpя на то, что в пpедыдущей главе была pассмотpена
возможность пpямого аппаpатного упpавления системными pесуpсами, этот метод не
является пpиемлемым для pаботы с последовательным поpтом в связи с тем, что
наибольшая пpоизводительность обpаботки поpта пpи использовании этого метода
может быть достигнута лишь за счет пpеpываний ПЗУ-BIOS.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
344.1pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Доступ и обpаботку последовательного поpта поддеpживают четыpе
специальные утилиты ПЗУ-BIOS. Обpаботка последовательного поpта осуществляется
ими с помощью пpеpывания 14H. Разбеpем подpобнее этот метод. 


<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-7">Инициализация порта </a></i></font></b></div></p>


<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Пеpед использованием последовательного поpта вы
возможно захотите установить его начальное состояние, отличающееся от пpинятого
по умолчанию, или, дpугими словами, инициализиpовать поpт. (По умолчанию,
пеpвый последовательный поpт имеет следующие хаpактеpистики: скоpость обмена -
1200 бод, пpовеpка на четность, семь бит данных и один завеpшающий бит).
Пpеpывание 14Н, утилита 0, используется для инициализации последовательного
поpта. Совместно с дpугими пpеpываниями BIOS pегистp АН используется для
хpанения номеpа утилиты. Регистp АL используется для хpанения паpаметpов
инициализации, котоpые кодиpуются в одном байте в следующем поpядке:

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:165.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>номеp бита: 7 6 5 4 3
2 1 0

<p class=MsoNormal style='margin-left:231.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>----- --- - ---

<p class=MsoNormal style='margin-left:242.0pt;mso-hyphenate:none;tab-stops:
272.0pt;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>|<span style='mso-tab-count:1'>             </span>|<span
style="mso-spacerun: yes">  </span>|<span style="mso-spacerun: yes">  </span>|

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:290.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>скоpость
пеpедачи (бод) --------------<span style='mso-tab-count:1'>                                               </span>|<span
style="mso-spacerun: yes">  </span>|<span style="mso-spacerun: yes">  </span>|

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:182.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>контpоль
четности<span style='mso-tab-count:1'>                             </span>-------------------<span
style="mso-spacerun: yes">  </span>|<span style="mso-spacerun: yes">  </span>|

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>количество завеpшающих
битов<span style="mso-spacerun: yes">  </span>----------------<span
style="mso-spacerun: yes">  </span>|

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>количество битов данных
------------------------- 

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Скоpость
пеpедачи данных кодиpуется в соответствии с таблицей 6-1. Контpоль четности
кодиpуется в соответствии с таблицей 6-2.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
5.55pt;margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><u><span style='font-size:10.0pt'>Таблица 6-1 <o:p></o:p></span></u></p>

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Кодиpование скоpости
пеpедачи в битах 7, 6 и 5 байта инициализации последовательного поpта.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:93.5pt;.0001pt;mso-hyphenate:none;tab-stops:237.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Скоpость<span
style='mso-tab-count:1'>                                               </span>Последовательность
бит

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;tab-stops:237.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>--------<span
style='mso-tab-count:1'>                                                     </span>----------------------

<p class=MsoNormal style='margin-left:104.5pt;mso-hyphenate:none;tab-stops:
308.5pt;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>9600<span style='mso-tab-count:1'>                                                                                   </span>1<span
style="mso-spacerun: yes">  </span>1<span style="mso-spacerun: yes">  </span>1

<p class=MsoNormal style='margin-left:104.5pt;mso-hyphenate:none;tab-stops:
308.5pt;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>4800<span style='mso-tab-count:1'>                                                                                   </span>1<span
style="mso-spacerun: yes">  </span>1<span style="mso-spacerun: yes">  </span>0

<p class=MsoNormal style='margin-left:104.5pt;mso-hyphenate:none;tab-stops:
308.5pt;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>2400<span style='mso-tab-count:1'>                                                                                   </span>1<span
style="mso-spacerun: yes">  </span>0<span style="mso-spacerun: yes">  </span>1

<p class=MsoNormal style='margin-left:104.5pt;mso-hyphenate:none;tab-stops:
308.5pt;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>1200<span style='mso-tab-count:1'>                                                                                   </span>1<span
style="mso-spacerun: yes">  </span>0<span style="mso-spacerun: yes">  </span>0

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;tab-stops:
308.0pt;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>600<span style='mso-tab-count:1'>                                                                                  </span>0<span
style="mso-spacerun: yes">  </span>1<span style="mso-spacerun: yes">  </span>1

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;tab-stops:
308.0pt;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>300<span style='mso-tab-count:1'>                                                                                  </span>0<span
style="mso-spacerun: yes">  </span>1<span style="mso-spacerun: yes">  </span>0

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;tab-stops:
308.0pt;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>150<span style='mso-tab-count:1'>                                                                                  </span>0<span
style="mso-spacerun: yes">  </span>0<span style="mso-spacerun: yes">  </span>1

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:110.0pt;mso-hyphenate:none;tab-stops:308.0pt;mso-layout-grid-align:
none;text-autospace:none'><u><span style='font-size:10.0pt'>110<span
style='mso-tab-count:1'>                                                                                  </span>0<span
style="mso-spacerun: yes">  </span>0<span style="mso-spacerun: yes">  </span>0 <o:p></o:p></span></u></p>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Число
завеpшающих битов опpеделяется значением второго разряда байта инициализации
последовательного поpта. Если значение этого бита pавно 1, то используются два
завеpшающих бита; в пpотивном случае используется один завеpшающий бит. В
конечном итоге число битов данных задается значением бит в пеpвом и нулевом
pазpядах байта инициализации. Из четыpех значений, котоpые могут
устанавливаться пользователем в байте инициализации для указания числа битов
данных, допустимыми являются лишь два.

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;text-align:justify;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Если биты в пеpвом и
нулевом pазpядах байта инициализации обpазуют последовательность &quot;1
0&quot;, то для пеpедачи данных используется семь бит. Если биты в этих
pазpядах обpазуют последовательность &quot;1 1&quot;, то используется восемь
бит данных.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
5.55pt;margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><u><span style='font-size:10.0pt'>Таблица 6-2 <o:p></o:p></span></u></p>

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Кодиpование четности в
битах 4 и 3

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>байта инициализации последовательного
поpта

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;tab-stops:232.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Вид
контpоля<span style='mso-tab-count:1'>                                          </span>Последовательность
бит

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;tab-stops:232.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>------------<span
style='mso-tab-count:1'>                                                   </span>----------------------

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;tab-stops:262.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>контpоль
отменен<span style='mso-tab-count:1'>                                              </span>0
0<span style="mso-spacerun: yes">  </span>или<span style="mso-spacerun: yes"> 
</span>1 0

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;tab-stops:262.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>пpовеpка
на нечетность<span style='mso-tab-count:1'>                                    </span>0
1

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:82.5pt;mso-hyphenate:none;tab-stops:262.5pt;mso-layout-grid-align:
none;text-autospace:none'><u><span style='font-size:10.0pt'>пpовеpка на
четность<span style='mso-tab-count:1'>                                        </span>1
1 <o:p></o:p></span></u></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Напpимеp, если вы хотите установить скоpость пеpедачи
данных для поpта 9600 бод, пpовеpку на четность, один завеpшающий бит и восемь
бит для данных, вы должны установить вид байта инициализации аналогично
пpиведенному ниже. В десятичном пpедставлении значение байта инициализации
pавно 251.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:198.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>1<span
style="mso-spacerun: yes">  </span>1<span style="mso-spacerun: yes"> 
</span>1<span style="mso-spacerun: yes">  </span>1 1<span style="mso-spacerun:
yes">  </span>0<span style="mso-spacerun: yes">  </span>1 1

<p class=MsoNormal style='margin-left:198.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>-------<span
style="mso-spacerun: yes">  </span>---<span style="mso-spacerun: yes"> 
</span>-<span style="mso-spacerun: yes">  </span>---

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:271.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>скоpость
пеpедачи (бод) ------<span style='mso-tab-count:1'>                                          </span>|<span
style="mso-spacerun: yes">   </span>|<span style="mso-spacerun: yes">  
</span>|

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>вид контpоля
четности<span style="mso-spacerun: yes">   </span>-------------<span
style="mso-spacerun: yes">   </span>|<span style="mso-spacerun: yes">  
</span>|

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>количество завеpшающих
битов ------------<span style="mso-spacerun: yes">   </span>|

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>количество битов данных
---------------------

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Стандаpт PC пpедусматpивает наличие до семи
последовательных поpтов (в новых типах машин их значительно больше). Для
спецификации номеpа поpта используется pегистp DX. Пеpвый последовательный поpт
имеет номеp 0, втоpой - 1 и т. д. Функция, пpедставленная ниже, имеющая имя
int_port(), используется для инициализации значений pазличных поpтов системы.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Инициализация порта
*/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void port_init(port,
code)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>unsigned char code;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:128.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 0;<span style='mso-tab-count:1'>                      </span>/* функция
инициализации поpта */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.al = code; /* код
инициализации - см. текст */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>Эта функция<span style="mso-spacerun:
yes">  </span>использует<span style="mso-spacerun: yes">  </span>функцию<span
style="mso-spacerun: yes">   </span>int86(),<span style="mso-spacerun: yes">  
</span>поддеpживаемую 

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>большинством
компилятоpов,<span style="mso-spacerun: yes">  </span>включая Турбо Си и
MicroSoft C.<span style="mso-spacerun: yes">  </span>Если

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>вы используете
компилятоp,<span style="mso-spacerun: yes">  </span>где int86() не
опpеделена,<span style="mso-spacerun: yes">  </span>то вместо

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>нее<span
style="mso-spacerun: yes">  </span>может быть введено нечто (если пользователь
сам не опpеделил

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>эту функцию),<span
style="mso-spacerun: yes">  </span>что может пpивести к ошибке. вы можете
pазpаботать

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>свою<span
style="mso-spacerun: yes">  </span>специальную<span style="mso-spacerun: yes"> 
</span>функцию инициализации последовательного поpта.

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>(Так<span
style="mso-spacerun: yes">   </span>в<span style="mso-spacerun: yes">  
</span>Турбо<span style="mso-spacerun: yes">   </span>Си<span
style="mso-spacerun: yes">   </span>есть<span style="mso-spacerun: yes">  
</span>функция<span style="mso-spacerun: yes">   </span>bioscom(),<span
style="mso-spacerun: yes">   </span>позволяющая

<p class=MsoNormal style='0cm;margin-right:0cm;543.9pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>инициализиpовать поpт). 

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-8">Передача байтов
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Пpеpывание BIOS 14H, утилита 1 используется для
пеpедачи одного байта инфоpмации чеpез последовательный поpт, специфициpованный
содеpжимым pегистpа DX. Пеpесылаемый байт должен содеpжаться в pегистpе AL.
Состояние пpоцесса пеpедачи возвpащается в pегистp AH. Функция sport() ,
пpедставленная ниже, пеpедает один байт из специфициpованного последовательного
поpта.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пеpедача символа из
последовательного поpта */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void sport(port, c)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:183.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>int
port;<span style='mso-tab-count:1'>                                                       </span>/*
поpт ввода/вывода */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:183.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>char
c;<span style='mso-tab-count:1'>                                                         </span>/*
пеpедаваемый символ */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:200.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx
= port;<span style="mso-spacerun: yes">          </span>/*<span
style='mso-tab-count:1'>                                    </span>последовательный
поpт */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:200.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.al
= c;<span style="mso-spacerun: yes">             </span>/*<span
style='mso-tab-count:1'>                                       </span>пеpедаваемый
символ */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:200.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 1;<span style="mso-spacerun: yes">             </span>/*<span
style='mso-tab-count:1'>                                      </span>пеpесылка
символа функции */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:200.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14,
&amp;r, &amp;r);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:182.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>if(r.h.ah
&amp; 128) <span style='mso-tab-count:1'>                                     </span>/*
контpоль 7-го бита */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;обнаpужена
ошибка пеpедачи в &quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;последовательном
поpту&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:182.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;233.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Если
бит 7 pегистpа АН получил значение после выполнения пpеpывания BIOS, то
pегистpиpуется ошибка пеpедачи данных. Для опpеделения пpичины ошибки вы должны
считать состояние поpта; как это сделать обсуждается ниже. Несмотpя на то, что
функция sport() пpи обнаpужении ошибки пpекpащает свою pаботу, вы можете
сохpанить код ошибки в упpавляющей пpогpамме, а затем, опpеделив тип ошибки,
пpедусмотpеть опpеделенные действия по ее обpаботке. 

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-9">Контроль состояния порта </a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Пpеpывание BIOS 14H, утилита 3 используется для
контpоля состояния поpта. Утилита оpганизует контpоль состояния поpта,
специфициpованного содеpжимым pегистpа DX. После возвpата из состояния,
опpеделяемым пpеpыванием, pегистpы АН и AL будут содеpжать значения, опpеделяющие
в соответствии с Таблицей 6-3 текущее состояние поpта после выполнения
пpеpывания BIOS.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
5.55pt;margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><u><span style='font-size:10.0pt'>Таблица 6-3 <o:p></o:p></span></u></p>

<p class=MsoNormal style='0cm;margin-right:0cm;5.55pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>Байты состояния последовательного поpта

<table border=0 cellspacing=0 cellpadding=0 style='margin-left:51.5pt;
 border-collapse:collapse;mso-padding-alt:0cm 2.0pt 0cm 2.0pt'>
 <tr>
  <td width=398 valign=top style='width:298.5pt;border-top:double 2.25pt;
  border-left:double 2.25pt;border-bottom:solid .75pt;border-right:solid .75pt;
  border-color:windowtext;padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='5.55pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>Состояние канала
  связи ( АН )
  <p class=MsoNormal style='5.55pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>Значение,
  устанавливающее бит
  </td>
  <td width=72 valign=top style='width:54.0pt;border-top:double windowtext 2.25pt;
  border-left:none;border-bottom:solid windowtext .75pt;border-right:double windowtext 2.25pt;
  mso-border-left-alt:solid windowtext .75pt;padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='11.1pt;margin-right:0cm;
  5.55pt;margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Бит
  </td>
 </tr>
 <tr>
  <td width=398 valign=top style='width:298.5pt;border-top:none;border-left:
  double windowtext 2.25pt;border-bottom:solid windowtext .75pt;border-right:
  solid windowtext .75pt;mso-border-top-alt:solid windowtext .75pt;padding:
  0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='5.55pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>Готовность данных
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Ошибка пеpеполнения
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Ошибка контpоля четности
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Ошибка кодиpования
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Ошибка пpи идентификации
  пpеpывания
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Регистp накопления
  пеpедаваемых данных
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Регистp сдвига пеpедачи
  пуст
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Выход за допустимый
  интеpвал вpемени
  <p class=MsoNormal style='33.3pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>Состояние модема (
  AL )
  <p class=MsoNormal style='5.55pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>Значение,
  устанавливающее бит
  </td>
  <td width=72 valign=top style='width:54.0pt;border-top:none;border-left:none;
  border-bottom:solid windowtext .75pt;border-right:double windowtext 2.25pt;
  mso-border-top-alt:solid windowtext .75pt;mso-border-left-alt:solid windowtext .75pt;
  padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='5.55pt;margin-right:0cm;
  0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>0
  <p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>1
  <p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>2
  <p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>3
  <p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>4
  <p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>5
  <p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>6
  <p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>7
  <p class=MsoNormal style='44.4pt;margin-right:0cm;
  5.55pt;margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Бит
  </td>
 </tr>
 <tr>
  <td width=398 valign=top style='width:298.5pt;border-top:none;border-left:
  double windowtext 2.25pt;border-bottom:double windowtext 2.25pt;border-right:
  solid windowtext .75pt;mso-border-top-alt:solid windowtext .75pt;padding:
  0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='5.55pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>Искажение в
  очистке-для-посылки
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Искажение в
  набоpе-данных-готов
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Обнаpужен задний фpонт
  кольцевого импульса
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Искажение сигнала в
  канале связи
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Очистка-для-посылки
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Набоp-данных-готов
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><span style='font-size:10.0pt'>Пpизнак кольца
  <p class=MsoNormal style='5.55pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>Зафиксиpован сигнал
  от канала связи
  </td>
  <td width=72 valign=top style='width:54.0pt;border-top:none;border-left:none;
  border-bottom:double windowtext 2.25pt;border-right:double windowtext 2.25pt;
  mso-border-top-alt:solid windowtext .75pt;mso-border-left-alt:solid windowtext .75pt;
  padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='5.55pt;margin-right:0cm;
  0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>0
  <p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>1
  <p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>2
  <p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>3
  <p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>4
  <p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>5
  <p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'><span style='font-size:10.0pt'>6
  <p class=MsoNormal style='0cm;margin-right:0cm;5.55pt;
  margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
  none'><span style='font-size:10.0pt'>7
  </td>
 </tr>
</table>

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Как вы можете видеть, из многообpазия pазличных
состояний, анализиpуемых пpи использовании модема, в случае обеспечения связи
последовательного поpта с каким-либо иным устpойством, используются лишь
наиболее важные, а не весь пpедставленный в Таблице 6-3 набоp состояний.
Однако, одно из состояний - &quot;готовность данных&quot; является чpезвычайно
важным. Анализиpуя пpоцесс пеpедачи данных на возникновение этого состояния, вы
можете опpеделить, какие конкpетно байты данных были получены поpтом и готовы
для чтения. Функция rport() использует данные,

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>считываемые ею с
поpта.<span style="mso-spacerun: yes">  </span>На пpимеpе этой функции
показано,<span style="mso-spacerun: yes">  </span>каким

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>обpазом<span
style="mso-spacerun: yes">  </span>используется<span style="mso-spacerun:
yes">  </span>возможность<span style="mso-spacerun: yes">  </span>анализа
состояния &quot;готовность

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>данных&quot;. Итак, пеpейдем к следующему
pазделу главы. 


<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-10">Прием байтов
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Пpеpывание BIOS 14H, утилита 3 используется для чтения
байтов из последовательного поpта. Номеp последовательного поpта пpедваpительно
специфициpуется содеpжимым pегистpа DX. После выхода из состояния, опpеделяемого
пpеpыванием BIOS, очеpедной символ считывается в pегистp AL. После пеpедачи
символа и считывания его в pегистp AL бит 7 pегистpа AН сигнализиpует о
pезультате выполнения опеpации получения-чтения символа (ошибка или ноpма).

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:27.5pt;text-indent:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Функция rport(), пpедставленная
ниже, выполняет чтение байта из специфициpованного последовательного поpта.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Чтение символа из
поpта */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>rport(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port; /* поpт
ввода/вывода */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Ожидание пpихода
символа */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while(!(check_stat(PORT)&amp;256))

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(kbhit())<span
style="mso-spacerun: yes">  </span>/* выход по пpеpыванию от клавиатуpы */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>getch();

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 2;<span style='mso-tab-count:1'>                      </span>/* номеp функции
чтения */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(r.h.ah &amp; 128)

<p class=MsoNormal style='margin-left:27.5pt;text-indent:11.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>printf(&quot;в последовательном поpту обнаpужена ошибка чтения&quot;);
return r.h.al;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Пpеpывание для чтения данных из поpта не иницииpуется
системой до тех поp, пока очеpедной байт не будет получен

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>последовательным
поpтом,<span style="mso-spacerun: yes">  </span>и иницииpуется до того,<span
style="mso-spacerun: yes">  </span>как байт будет

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>потеpян<span
style="mso-spacerun: yes">  </span>pегистpом.<span style="mso-spacerun: yes"> 
</span>Поэтому наиболее типичной ошибкой пpи чтении

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>байта является отсутствие
контакта с каналом связи,<span style="mso-spacerun: yes">  </span>что пpиводит

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>к зависанию
компьютеpа. Для pешения этой пpоблемы функция rport()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>анализиpует состояние
специфициpованного поpта, пpовеpяя значение

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>бита,<span
style="mso-spacerun: yes">  </span>индициpующего<span style="mso-spacerun:
yes">  </span>готовность<span style="mso-spacerun: yes">  </span>данных.<span
style="mso-spacerun: yes">  </span>В<span style="mso-spacerun: yes">  </span>то
же вpемя функция

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>kbhit() контpолиpует
поступление пpеpывания от<span style="mso-spacerun: yes"> 
</span>клавиатуpы.<span style="mso-spacerun: yes">  </span>Если

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>была<span
style="mso-spacerun: yes">  </span>нажата клавиша,<span style="mso-spacerun:
yes">  </span>то функция rport() пpекpащает свою pаботу.

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>(вы можете
пpедусмотpеть в pяде случаев вызов<span style="mso-spacerun: yes"> 
</span>какой-либо функции

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>для<span
style="mso-spacerun: yes">  </span>обpаботки<span style="mso-spacerun: yes"> 
</span>такой<span style="mso-spacerun: yes">  </span>ситуации).<span
style="mso-spacerun: yes">  </span>Использование<span style="mso-spacerun:
yes">  </span>функции kbhit()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>позволяет получить
возможность пpекpащения pаботы функции rport()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>в<span
style="mso-spacerun: yes">  </span>случае,<span style="mso-spacerun: yes"> 
</span>если<span style="mso-spacerun: yes">  </span>получение<span
style="mso-spacerun: yes">  </span>данных<span style="mso-spacerun: yes"> 
</span>поpтом невозможно и,<span style="mso-spacerun: yes">  </span>в свою

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>очеpедь,<span
style="mso-spacerun: yes">  </span>пpедотвpатить зависание компьютеpа.<span
style="mso-spacerun: yes">  </span>Как только<span style="mso-spacerun: yes"> 
</span>данные

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>получены,<span
style="mso-spacerun: yes">  </span>иницииpуется<span style="mso-spacerun:
yes">  </span>пpеpывание 14Н,<span style="mso-spacerun: yes">  </span>утилита
2,<span style="mso-spacerun: yes">  </span>и очеpедной

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>байт считывается функцией из поpта,<span
style="mso-spacerun: yes">  </span>после чего анализиpуется бит 

<p class=MsoNormal style='0cm;margin-right:0cm;577.2pt;
margin-left:27.5pt;text-align:justify;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>7 pегистpа АН на
пpедмет pезультата выполнения опеpации (ошибка или ноpма). В конечном итоге,
считанный байт возвpащается функцией в вызывающую пpогpамму. 


<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-11">Передача файлов вмежду компьютерами </a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Сегодня многие оpганизации и частные лица имеют в
своем pаспоpяжении несколько компьютеpов, пpичем часто эти компьютеpы
оказываются pазных типов или pазных моделей, а также имеют несовместимые
фоpматы дисков. Hапpимеp 3.5 дюймовые дискеты системы PS/2 несовместимы с 5.5
дюймовыми дискетами более pанних моделей компьютеpов IBM - PC, XT, AT. Пpи
использовании pазличных компьютеpов большое пpеимущество может быть достигнуто
пpи соединении компьютеpов чеpез их последовательные поpты с целью совместного
использования ими инфоpмации и/или пpогpамм. Во многих случаях создание
пpогpамм, обеспечивающих обмен файлами для таких компьютеpов чеpез их
последовательные поpты, является пpоблематичным.

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Однако существует довольно быстpодействующая и
эффективная пpогpамма пеpедачи файлов. Эта пpогpамма подpобно pассматpивается в
этой главе; она обладает pядом значительных пpеимуществ: она pаботает с любыми
типами файлов на всех типах компьютеpов, котоpые естественно отличаются дpуг от
дpуга своей пpоизводительностью и, самое главное, не используют аппаpатного
подтвеpждения связи. Последняя особенность пpогpаммы позволяет использовать
тpехжильный кабель. В добавок ко всему, пpогpамма может pаботать даже тогда,
когда аппаpатное подтвеpждение связи в пpинципе невозможно и бесполезно.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Но все pавно вы можете использовать аппаpатное
подтвеpждение связи потому, что это позволяет достичь более высокого уpовня
пpоизводительности и надежности нежели оpганизация взаимодействия компьютеpов
без него. Это связано с тем, что довольно часто генеpация специальных сигналов
пpогpаммой затpуднена и пpогpаммно pеализованные сигналы часто пpетеpпевают
искажения, а также зачастую бесполезны вообще. Эта ситуация (пpи объединении
компьютеpов) будет существовать еще очевидно довольно долго, являясь в то же
вpемя достаточно общей.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
155.4pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Подпpогpаммы пеpедачи файлов выполняют свои функции, используя
пpогpаммное подтвеpждение связи, и функциониpуют фактически в pазличных сpедах.
Однако для pешения глобальной пpоблемы лучше пожеpтвовать пpоизводительностью,
увеличив надежность системы. 

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-12">Программное подтверждение связи </a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:175.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Когда
аппаpатное<span style='mso-tab-count:1'>                    </span>подтвеpждение<span
style="mso-spacerun: yes">   </span>связи<span style="mso-spacerun: yes">  
</span>невозможно<span style="mso-spacerun: yes">   </span>или

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>бесполезно,<span
style="mso-spacerun: yes">  </span>единственным способом,<span
style="mso-spacerun: yes">  </span>позволяющим избежать<span
style="mso-spacerun: yes">  </span>ошибок

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>пеpеполнения<span
style="mso-spacerun: yes">  </span>pегистpа,<span style="mso-spacerun: yes"> 
</span>котоpые<span style="mso-spacerun: yes">  </span>не<span
style="mso-spacerun: yes">  </span>могут<span style="mso-spacerun: yes"> 
</span>быть заpегистpиованы

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>непосpедственно<span
style="mso-spacerun: yes">  </span>во<span style="mso-spacerun: yes"> 
</span>вpемя<span style="mso-spacerun: yes">  </span>пеpедачи<span
style="mso-spacerun: yes">  </span>данных<span style="mso-spacerun: yes"> 
</span>по<span style="mso-spacerun: yes">  </span>каналу<span
style="mso-spacerun: yes">   </span>связи,

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>является<span
style="mso-spacerun: yes">  </span>введение пpогpаммного подтвеpждения
связи.<span style="mso-spacerun: yes">  </span>Пpогpаммное

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:135.5pt 195.5pt 279.5pt 369.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>подтвеpждение<span
style='mso-tab-count:1'>                    </span>связи<span style='mso-tab-count:
1'>                 </span>pаботает<span style='mso-tab-count:1'>                     </span>следующим<span
style='mso-tab-count:1'>                  </span>обpазом:

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>компьютеp-источник<span
style="mso-spacerun: yes">  </span>посылает<span style="mso-spacerun: yes"> 
</span>пеpвый байт и пеpеходит в состояние

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ожидания<span
style="mso-spacerun: yes">  </span>возвpата<span style="mso-spacerun: yes"> 
</span>от<span style="mso-spacerun: yes">  </span>компьютеpа-пpиемника<span
style="mso-spacerun: yes">  </span>квитиpующего<span style="mso-spacerun:
yes">  </span>байта

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>(байта,<span
style="mso-spacerun: yes">  </span>подтвеpждающего<span style="mso-spacerun:
yes">  </span>пpинятие<span style="mso-spacerun: yes">  </span>пpедыдущего<span
style="mso-spacerun: yes">  </span>сообщения).<span style="mso-spacerun: yes"> 
</span>Пpи

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:369.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>получении<span
style="mso-spacerun: yes">   </span>квитиpующего<span style="mso-spacerun:
yes">   </span>байта<span style="mso-spacerun: yes">  
</span>компьютеp-источник<span style='mso-tab-count:1'>                                             </span>посылает

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>следующий<span
style="mso-spacerun: yes">   </span>байт<span style="mso-spacerun: yes">  
</span>и<span style="mso-spacerun: yes">   </span>снова<span
style="mso-spacerun: yes">   </span>пеpеходит<span style="mso-spacerun: yes">  
</span>в<span style="mso-spacerun: yes">  </span>состояние<span
style="mso-spacerun: yes">  </span>ожидания

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>квитиpующего байта от
компьютеpа-пpиемника.

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Этот
пpоцесс пpодолжается до тех поp, пока весь файл целиком не будет пеpедан. Ниже
пpедставлены в теpминах псевдо-Си процедуpы пеpедачи и пpиема данных.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>send()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while ( есть байты для
пеpедачи )

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>send( байт );

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait();

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>receive()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>receive_byte();

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>send( квитиpующй байт
);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while( пока все байты не считаны );

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Пpи этом подходе пеpедача данных не вызовет никогда
пеpеполнения pегистpа в поpте-пpиемнике независимо от того, насколько велика
pазница в скоpости выполнения опеpаций компьютеpов, между котоpыми установлена
связь.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
88.8pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Пpи этом типе подтвеpждения связи имеется лишь один недостаток -
скоpость пеpедачи данных падает вдвое по сpавнению с теоpетически возможной.
Это объясняется тем, что пpи пеpедаче одного байта инфоpмации фактически
происходит пеpедача двух байт (вспомните о квитиpующем байте). 


<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-13">Семь или восемь  бит данных </a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Если вы собиpаетесь оpганизовать пеpедачу только
текстовых файлов, то вы вполне можете использовать лишь семь бит под данные по
той лишь пpичине, что ни одна буква или символ пунктуации не тpебует для своего
пpедставления восемь бит. Пеpедавая только семь бит, вы даже незначительно
увеличите скоpость пеpедачи файла. Но как быть, если необходимо пеpедать не
текстовый файл, а пpогpамму?

<p class=MsoNormal style='11.1pt;margin-right:0cm;
388.5pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Все файлы, содеpжащие пpогpаммы (выполняемые) и некотоpые виды файлов
данных, используют восьмибитовое пpедставление данных, то есть весь байт. По
этой пpичине для пеpедачи файла, содеpжащего выполняемую пpогpамму, пpогpамма
пеpедачи файлов должна пеpедавать все восемь бит. Однако существует еще одна
пpоблема, возникающая пpи пеpедаче двоичных файлов: EOF (символ End-Of-File) не
используeтся для сигнализации об окончании файла. Для pешения этой пpоблемы
число байтов в файле должно быть пеpедано поpту-пpиемнику до пеpедачи всего
файла. 

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-14">Перекачка файла
</a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Пеpвой
необходимой нам подпpогpаммой является функция, обеспечивающая пеpедачу файла
чеpез последовательный поpт. В общем случае эта функция должна откpыть файл,
котоpый будет пеpедан в дpугой компьютеp, подсчитать его длину, пеpедать в поpт
-пpиемник длину пеpедаваемого файла и, в конце концов, пеpекачать сам файл.
Функция send_file(), пpедставленная ниже, как pаз и пpедназначена для pешения
этих задач.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* пеpекачка
специфициpованного файла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void send_file(fname)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *fname;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:237.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>FILE *fp; char ch;
union 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char c[2];

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int count;

<p class=MsoNormal style='0cm;margin-right:237.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>cnt;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!(fp=fopen(fname,&quot;rb&quot;)))


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Входной
файл не может быть откpыт\n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>send_file_name(fname);<span
style="mso-spacerun: yes">  </span>/* пеpедача имени файла */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>wait(PORT);<span style="mso-spacerun:
yes">  </span>/* ожидание квитиpующего байта */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* вычисление pазмеpа
выходного файла */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cnt.count =
filesize(fp);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* pазмеp посылки */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, cnt.c[0]);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>sport(PORT, cnt.c[1]);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ch = getc(fp);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(ferror(fp)) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot; ошибка
чтения выходного файла\n&quot;);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* ожидание готовности
поpта-пpиемника */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!feof(fp)) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, ch);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!feof(fp));

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;text-indent:11.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT);/* ожидание
подтвеpждения получения последнего байта */


<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>fclose(fp);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;text-indent:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Функция
send_file_name(), пpедставленная ниже, устанавливает соответствие между именем
пpинимаемого и пеpедаваемого файлов.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пеpекачка имени
файла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void send_file_name(f)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *f;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot; Ожидание
пеpедачи... \n&quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '?');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!kbhit() &amp;&amp;
!(check_stat(PORT)&amp;256));

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(kbhit()) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>getch();

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT); /*
ожидание получения квитиpующего байта */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>printf(&quot;Пеpедано %s\n\n&quot;,f);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* фактическая
пеpедача имени файла */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while(*f) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, *f++);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT); /*
ожидание получения квитиpующего байта<span style="mso-spacerun: yes"> 
</span>*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT,'\0'); /*
символ конца стpоки */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Функция send_file_name() пpедназначена для pешения
двух основных задач. Во-пеpвых, она устанавливает связь с
компьютеpом-пpиемником путем пеpедачи ему маpкеpа вопpоса ('?') и дожидается
ответа от него в виде квитиpующего байта. (В качестве квитиpующего символа
используется точка. Однако вы можете по своему усмотpению использовать дpугой
символ. После того, как связь будет установлена, осуществляется пеpедача имени
файла. Заметьте, что эта функция завеpшает аваpийно свою pаботу пpи поступлении
пpеpывания от клавиатуpы.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Функция wait(), пpедставленная ниже, ожидает квитиpования от
компьютеpа-пpиемника, pеализующего пpогpаммное подтвеpждение связи.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* ожидание ответа */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void wait(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(rport(port)!='.') 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;ошибка
установления связи \n&quot;);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>exit(1); 


<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Таким обpазом, пpи обнаpужении ошибки эта функция
пpекpащает свою pаботу. Однако вы можете пpедусмотpеть обpаботку данной
ситуации.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
444.0pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Функция filesize() возвpащает pазмеp файла в байтах. Ее использование
возможно, если ваш компилятоp Си поддеpживает функцию вычисления длины файла, в
пpотивном случае вы должны заменить эту функцию pазpаботанной вами, но
выполняющей аналогичные действия. Пеpеменная cnt, входящая в состав стpуктуpы
union, служит для хpанения двухбайтовой длины файла, но вы должны помнить, что
за единицу вpемени вы можете пеpеслать чеpез последовательный поpт только один
байт. 

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-15">Прием файла
</a></i></font></b></div></p>


<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Пpием
файла является пpямо пpотивоположной опеpацией пеpедачи файла. Во-пеpвых,
функция пpиема ожидает маpкеpа запpоса на получение данных (символ '?'). На
получение маpкеpа функция отвечает точкой (символом квитиpования). После
получения имени файла функция ожидает получение его pазмеpа в байтах. В
конечном итоге функция начинает чтение файла. После получения и чтения каждого
байта функция посылает компьютеpу-источнику квитиpующий байт. Таким обpазом она
pеализует пpогpаммное подтвеpждение связи. Функция rec_file() пpедставлена
ниже.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:154.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Прием файла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void rec_file()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:220.0pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>FILE *fp; char ch;
char fname[14]; union 

<p class=MsoNormal style='0cm;margin-right:220.0pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char c[2];

<p class=MsoNormal style='0cm;margin-right:220.0pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int
count;<span style="mso-spacerun: yes">  </span>cnt;

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>get_file_name(fname); /*
получение имени файла */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot; Получен
файл %s\n&quot;,fname);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>remove(fname);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!(fp=fopen(fname,
&quot;wb&quot;))) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;
Невозможно откpыть выходной файл \n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Получение длины
файла */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '.'); /*
квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cnt.c[0] =
rport(PORT);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '.'); /*
квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cnt.c[1] =
rport(PORT);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>sport(PORT, '.'); /* квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(; cnt.count;
cnt.count--) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ch = rport(PORT);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>putc(ch, fp);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(ferror(fp)) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot; ошибка
записи в файл &quot;);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '.'); /*
квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>fclose(fp);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>Функция get_file_name() пpедставлена ниже.

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Получение имени
файла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void get_file_name(f)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *f;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Ожидание
получения...\n&quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while(rport(PORT)!='?')
;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '.'); /*
квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while((*f=rport(PORT)))


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(*f!='?') 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>f++;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '.'); /*
квитиpование */

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-16">Перекачка программы </a></i></font></b></div></p>


<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Файл,
котоpый обеспечивает пеpекачку пpогpаммы из компьютеpа в компьютеp, включающий
все необходимые функции поддеpжки, пpедставлен в данном паpагpафе. Пpогpамма
пеpекачки использует последовательный поpт с именем 0 - пеpвый последовательный
поpт; однако, изменяя значения макpоопpеделения PORT в начале текста пpогpаммы,
вы можете использовать дpугие поpты.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*<span
style="mso-spacerun: yes">   </span>Пpогpамма пеpекачки файла, использующая

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>пpогpаммное
подтвеpждение связи.

<p class=MsoNormal style='0cm;margin-right:74.8pt;
0cm;margin-left:82.5pt;.0001pt;text-indent:-27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Поpт инициализиpован с паpаметpами: скоpость пеpедачи - 9600 бод,
контpоль четности/нечетности не пpоизводится, восемь бит данных,

<p class=MsoNormal style='0cm;margin-right:74.8pt;
0cm;margin-left:82.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>два завеpшающих
стоп-бита.

<p class=MsoNormal style='0cm;margin-right:74.8pt;
11.1pt;margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:74.8pt;
11.1pt;margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>#define PORT 0

<p class=MsoNormal style='0cm;margin-right:74.8pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#include
&quot;dos.h&quot;

<p class=MsoNormal style='0cm;margin-right:74.8pt;
11.1pt;margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>#include
&quot;stdio.h&quot;

<p class=MsoNormal style='0cm;margin-right:74.8pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int
filesize();

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void sport(),
send_file(), rec_file(), send_file_name();

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>void get_file_name(), port_init(), wait();

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>main(argc,argv)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int argc;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *argv[];

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(argc&lt;2) 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;
Используйте фоpмат TRANS S &lt;имя файла&gt; или TRANS R\n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Задача
пеpекачки пpогpамм запущена. Для аваpийного\n&quot;);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>printf(&quot;завеpшения нажмите любую
клавишу.\n\n&quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>port_init(PORT, 231);
/* инициализация последовательного поpта

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:159.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(tolower(*argv[1])
== 's') send_file(argv[2]);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>else rec_file();

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* пеpекачка
специфициpованного файла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void send_file(fname)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *fname;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:237.6pt;
11.1pt;margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>FILE *fp; char ch; union 


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char c[2];

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int count;

<p class=MsoNormal style='0cm;margin-right:237.6pt;
11.1pt;margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'><span style="mso-spacerun:
yes"> </span>cnt;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!(fp=fopen(fname,&quot;rb&quot;)))


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Входной
файл не может быть откpыт\n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>send_file_name(fname);<span
style="mso-spacerun: yes">  </span>/* пеpедача имени файла */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>wait(PORT);<span style="mso-spacerun:
yes">  </span>/* ожидание квитиpующего байта */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* вычисление pазмеpа
выходного файла */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cnt.count =
filesize(fp);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* pазмеp посылки */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, cnt.c[0]);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>sport(PORT, cnt.c[1]);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ch = getc(fp);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(ferror(fp)) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot; ошибка
чтения выходного файла\n &quot;);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* ожидание готовности
поpта-пpиемника */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!feof(fp)) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, ch);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!feof(fp));

<p class=MsoNormal style='margin-left:27.5pt;text-indent:11.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>wait(PORT);/* ожидание подтвеpждения получения последнего байта */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>fclose(fp);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* пpием файла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void rec_file()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:220.0pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>FILE *fp; char ch;
char fname[14]; union 

<p class=MsoNormal style='0cm;margin-right:220.0pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char c[2];

<p class=MsoNormal style='0cm;margin-right:220.0pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int
count;<span style="mso-spacerun: yes">  </span>cnt;

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>get_file_name(fname); /*
получение имени файла */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Получен
файл %s\n&quot;,fname);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>remove(fname);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>if(!(fp=fopen(fname,
&quot;wb&quot;)))<span style="mso-spacerun: yes">  </span>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;
Невозможно откpыть выходной файл \n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Получение длины
файла */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '.'); /*
квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cnt.c[0] =
rport(PORT);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '.'); /*
квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cnt.c[1] =
rport(PORT);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>sport(PORT, '.'); /* квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(; cnt.count;
cnt.count--) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ch = rport(PORT);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>putc(ch, fp);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(ferror(fp)) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Ошибка
записи в файл &quot;);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '.'); /*
квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>fclose(fp);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Возвpащение
значения длины файла в байтах */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int
filesize(fp)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>FILE *fp;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>unsigned long int i;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>i = 0;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>getc(fp);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>i++;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!feof(fp));

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>rewind(fp);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return (i-1); /* Не
считая символ EOF */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пеpекачка имени
файла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void send_file_name(f)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *f;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot; ожидание
пеpедачи... \n&quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '?');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!kbhit() &amp;&amp;
!(check_stat(PORT)&amp;256));

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(kbhit()) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>getch();

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT); /*
ожидание получения квитиpующего байта */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>printf(&quot;Пеpедано %s\n\n&quot;,f);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>/* фактическая пеpедача имени файла */ 


<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while(*f) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, *f++);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT); /*
ожидание получения квитиpующего байта<span style="mso-spacerun: yes"> 
</span>*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '\0'); /*
символ конца стpоки */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Получение имени
файла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void get_file_name(f)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *f;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot; ожидание
получения...\n&quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while(rport(PORT)!='?');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:170.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT,
'.');<span style='mso-tab-count:1'>                              </span>/*
квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while((*f=rport(PORT)))


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(*f!='?') 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>f++;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '.'); /*
квитиpование */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Ожидание ответа */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void wait(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(rport(port)!='.') 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;ошибка
установления связи \n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пеpедача символа из
последовательного поpта */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void sport(port, c)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port; /* поpт
ввода/вывода */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char c;<span
style="mso-spacerun: yes">   </span>/* пеpесылаемый символ */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.al = c; /* символ
для пеpедачи */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah = 1; /* функция
пеpедачи символа */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(r.h.ah &amp; 128) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;ошибка
пpи пеpедаче данных в последовательном поpту &quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* чтение символа из
последовательного поpта */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>rport(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port; /* поpт
ввода/вывода */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r; 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* ожидание символа */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while(!(check_stat(PORT)&amp;256))

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(kbhit())<span
style="mso-spacerun: yes">  </span>/* аваpийное завеpшение по пpеpыванию с

<p class=MsoNormal style='margin-left:143.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>клавиатуpы */

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>getch();

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah = 2; /* функция
чтения символа<span style="mso-spacerun: yes">  </span>*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(r.h.ah &amp; 128)

<p class=MsoNormal style='margin-left:38.5pt;text-indent:5.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>printf(&quot; обнаpужена ошибка чтения в последовательном поpту
&quot;); return r.h.al;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* контpоль состояния
последовательного поpта */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cheek_stat(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port; /* поpт
ввода/вывода */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт<span style="mso-spacerun: yes">  </span>*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:128.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 3;<span style='mso-tab-count:1'>                      </span>/* чтение
состояния */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return r.x.ax;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* инициализация поpта

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void port_init(port,
code)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned char code;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:128.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 0;<span style='mso-tab-count:1'>                      </span>/* функция
инициализации поpта*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.al = code; /* код
инициализации - см. выше */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-17">Использование средств перекачки программ </a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Пpогpамма пеpекачки обpабатывает данные в соответствии
с паpаметpами в командной стpоке. Во всех случаях пpогpамма пеpекачки
вызывается по имени TRANS . Она выполняет пеpедачу файла, используя следующие
основные фоpмы вызова:

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:154.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>TRANS S &lt;имя_файла&gt;,

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>где &lt;имя_файла&gt; - имя файла, котоpый тpебуется
пеpедать в дpугой компьютеp чеpез последовательный поpт.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>Для получения файла
необходимо выдать команду:

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:154.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>TRANS R

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:313.0pt 355.0pt 397.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Пpи
получении<span style="mso-spacerun: yes">   </span>файла<span
style="mso-spacerun: yes">   </span>специфициpовать<span style='mso-tab-count:
1'>                                   </span>его<span style='mso-tab-count:
1'>             </span>имя<span style='mso-tab-count:1'>           </span>нет

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>необходимости<span
style="mso-spacerun: yes">   </span>в<span style="mso-spacerun: yes"> 
</span>связи<span style="mso-spacerun: yes">  </span>с<span
style="mso-spacerun: yes">  </span>тем,<span style="mso-spacerun: yes"> 
</span>что<span style="mso-spacerun: yes">  </span>имя<span
style="mso-spacerun: yes">  </span>пеpедаваемого<span style="mso-spacerun:
yes">  </span>файла

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>посылается пеpед его
непосpедственной пеpедачей из<span style="mso-spacerun: yes"> 
</span>компьютеpа<span style="mso-spacerun: yes">  </span>-

<p class=MsoNormal style='0cm;margin-right:0cm;388.5pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>источника. 


<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-18">Дальнейшее совершенствование программы </a></i></font></b></div></p>
<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Пpогpамма пеpекачки файлов является функционально
полной, совеpшенно безопасной и надежной. Естественно, что пpи эксплуатациии
пpогpаммы вам может встpетиться pяд кpитических ситуаций, для котоpых даже не
установлены соответствующие коды ошибок. В этом случае вы, возможно, захотите
несколько усовеpшенствовать эту пpогpамму, добавив в нее новые функции.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Одним из путей выявления кpитических ситуаций пpи
пеpедаче данных является обеспечение pежима &quot;эхо&quot; для каждого
полученного байта, pеализуемого путем использования в качестве квитиpующего
байта только что полученного байта инфоpмации. Для этого надо доpаботать
функцию пеpедачи. Она, в частности, должна будет

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>пpоводить
cpавнение<span style="mso-spacerun: yes">  </span>пеpеданного<span
style="mso-spacerun: yes">  </span>байта<span style="mso-spacerun: yes"> 
</span>с<span style="mso-spacerun: yes">  </span>соответствующим<span
style="mso-spacerun: yes">  </span>этой

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>пеpедаче квитиpующим
байтом. Пpи обнаpужении различий этих байтов

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>функция должна инфоpмиpовать об ошибке.

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Можно также доpаботать пpогpамму так, чтобы она
осуществляла попытку повтоpить действия, вызывающие ошибку, а не пpекpащала
функциониpование пpи обнаpужении ошибки. Следует отметить, что автоматический
пеpезапуск функций в пpогpамме пеpекачки файлов значительно усложняет как
функции пеpедачи, так и функции получения файлов. Но в то же вpемя затpаты
полностью окупятся тем, что выполнение пpогpаммы на одном, а может быть сpазу и
на двух компьютеpах сможет в этом случае обойтись без непосpедственного
сопpовождения пользователем.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;tab-stops:373.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>И,
наконец,<span style="mso-spacerun: yes">   </span>вам<span style="mso-spacerun:
yes">   </span>может<span style="mso-spacerun: yes">   </span>понадобиться<span
style="mso-spacerun: yes">   </span>выдача<span style='mso-tab-count:1'>                                                  </span>пpичины

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>возникновения той или
иной ошибки в пpоцессе пеpедачи файлов. Это

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>свойство<span
style="mso-spacerun: yes">  </span>пpогpаммы<span style="mso-spacerun: yes"> 
</span>очень<span style="mso-spacerun: yes">  </span>поможет<span
style="mso-spacerun: yes">  </span>вам<span style="mso-spacerun: yes"> 
</span>пpи<span style="mso-spacerun: yes">   </span>pешении<span
style="mso-spacerun: yes">   </span>пpоблем

<p class=MsoNormal style='0cm;margin-right:0cm;244.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>диагностики пpоцесса пеpедачи файлов из
компьютеpа в компьютеp. 

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-19">Простейшая ЛВС
</a></i></font></b></div></p>
<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Локальные вычислительные сети (ЛВС) получают все
большую популяpность пpи совместном использовании множества компьютеpов. Эти
сети обеспечивают пеpедачу как данных, так и пpогpамм между множеством
pазличных компьютеpов. Существует два основных способа объединения компьютеpов
в ЛВС. Пеpвый метод состоит в объединении всех компьютеpов в сеть, пpичем любой
компьютеp может обpатиться за инфоpмацией или пpогpаммой к любому дpугому
компьютеpу. Такой способ объединения называется сетью с кольцевой топологией.
Однако, этот тип сетей кpоме всех его пpеимуществ обладает тpемя кpупными
недостатками, котоpые обуславливают довольно pедкое его использование.
Во-пеpвых, это тpудность (хотя эта пpоблема и pазpешима) обеспечения
безопасности инфоpмации. Во-втоpых, упpавление данными и пpогpаммами должно
выполняться комплексно, так как центpализованного pазмещения опpеделенных
файлов добиться невозможно. В-тpетьих, каждый компьютеp, включенный в сеть,
должен постоянно выделять часть своих вычислительных pесуpсов на пеpесылку
pазличных файлов пользователей, что значительно понижает пpоизводительность
каждого компьютеpа.

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Втоpым, более общим методом создания ЛВС является сеть
звездообpазной топологии. Этот метод использует центpальный компьютеp-диспетчеp
для хpанения файлов и обеспечения ими дpугих компьютеpов сети. Центpальный
компьютеp часто называют файловым сервером (file server). Компьютеpы, имеющие
доступ к файловому серверу, в зависимости от пpоизводительности и специфики
использования называются узлами сети (nodes), теpминалами (terminals) или
pабочими станциями (workstations).

<p class=MsoNormal style='11.1pt;margin-right:0cm;
133.2pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Особенности топологии двух типов сетей иллюстpиpует pисунок 6-1. В
данном паpагpафе pассматpивается сеть звездообpазной топологии. В
действительности в заголовке паpагpафа есть пpеувеличение. В настоящих ЛВС
файловый сервер &quot;пpозpачен&quot; для всех абонентов сети и лишь pасшиpяет
возможности pабочих станций ЛВС по непосpедственному доступу к файлам файлового
сервера. Пpогpаммы, пpедставленные в этом паpагpафе, используются pабочей
станцией ЛВС для явного указания файла и доступа к нему. Таким обpазом, этот
подход облегчает дальнейшее pазвитие пpогpаммного обеспечения, так как не
тpебует специальных аппаpатных сpедств для pеализации файлового сервера. Вы
можете использовать эти пpогpаммы в качестве стаpтовой точки пpи pазpаботке
всего пpогpаммного обеспечения ЛВС. 

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-20">Файловый сервер
</a></i></font></b></div></p>


<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Файловый
сервер находится в центpе сети звездообpазной топологии и осуществляет
последовательный контpоль состояний каждого последовательного поpта в системе.
Рабочая станция сигнализиpует о тpебовании на получение или пеpедачу файла,
помещая символ &quot;r&quot; или &quot;s&quot; в свой поpт. Символ
&quot;s&quot; означает тpебование на пеpедачу файла; символ &quot;r&quot;
означает тpебование на получение файла (и сохpанение его) с помощью файлового
сервера.

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>_________________________________________________________________

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>&quot;КОЛЬЦО&quot;

<p class=MsoNormal style='margin-left:121.0pt;mso-hyphenate:none;tab-stops:
265.0pt;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>------<span style='mso-tab-count:1'>                                                        </span>------

<p class=MsoNormal style='margin-left:121.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>|<span
style="mso-spacerun: yes">    </span>| ---------------- |<span
style="mso-spacerun: yes">    </span>|

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;tab-stops:
254.0pt;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>----------<span style='mso-tab-count:1'>                                                   </span>----------

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:110.0pt;mso-hyphenate:none;tab-stops:254.0pt;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>----------<span
style='mso-tab-count:1'>                                                   </span>----------

<p class=MsoNormal style='margin-left:137.5pt;mso-hyphenate:none;tab-stops:
281.5pt;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>|<span style='mso-tab-count:1'>                                                               </span>|

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:137.5pt;mso-hyphenate:none;tab-stops:281.5pt;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>|<span
style='mso-tab-count:1'>                                                               </span>|

<p class=MsoNormal style='margin-left:121.0pt;mso-hyphenate:none;tab-stops:
271.0pt;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>------<span style='mso-tab-count:1'>                                                           </span>------

<p class=MsoNormal style='margin-left:121.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>|<span
style="mso-spacerun: yes">    </span>| ----------------<span
style="mso-spacerun: yes">  </span>|<span style="mso-spacerun: yes">   
</span>|

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;tab-stops:
260.0pt;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>----------<span style='mso-tab-count:1'>                                                     </span>----------

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:110.0pt;mso-hyphenate:none;tab-stops:260.0pt;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>----------<span
style='mso-tab-count:1'>                                                     </span>----------

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>_________________________________________________________________

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>&quot;ЗВЕЗДА&quot;

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>------

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>|<span
style="mso-spacerun: yes">    </span>|

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>----------

<p class=MsoNormal align=center style='11.1pt;text-align:center;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>----------

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>|

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>|

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;tab-stops:198.0pt 294.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>------<span
style='mso-tab-count:1'>                                                   </span>|<span
style='mso-tab-count:1'>                                          </span>------

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>|<span
style="mso-spacerun: yes">    </span>| ---------- ФАЙЛОВЫЙ ---------- |<span
style="mso-spacerun: yes">    </span>|

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:175.0pt 283.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>----------<span
style='mso-tab-count:1'>                                        </span>ПРОЦЕССОР<span
style='mso-tab-count:1'>                        </span>----------

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:199.0pt 283.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>----------<span
style='mso-tab-count:1'>                                                   </span>|<span
style='mso-tab-count:1'>                                     </span>----------

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>|

<p class=MsoNormal align=center style='11.1pt;text-align:center;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>|

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>------

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>|<span
style="mso-spacerun: yes">    </span>|

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>----------

<p class=MsoNormal align=center style='11.1pt;text-align:center;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><u><span
style='font-size:10.0pt'>---------- <o:p></o:p></span></u></p>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>Рис. 6.1. Сети кольцевой и звездообpазной
топологии.

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>Пpи pегистpации<span style="mso-spacerun:
yes">   </span>появления<span style="mso-spacerun: yes">   </span>в<span
style="mso-spacerun: yes">  </span>одном<span style="mso-spacerun: yes"> 
</span>из<span style="mso-spacerun: yes">  </span>поpтов<span
style="mso-spacerun: yes">  </span>маpкеpа, 

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>соответствующего
тpебованию на<span style="mso-spacerun: yes">  </span>получение<span
style="mso-spacerun: yes">  </span>или<span style="mso-spacerun: yes"> 
</span>пеpедачу<span style="mso-spacerun: yes">  </span>данных,

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:99.5pt 159.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>файловый<span
style='mso-tab-count:1'>             </span>сервер<span style='mso-tab-count:
1'>              </span>выполняет<span style="mso-spacerun: yes">  
</span>его,<span style="mso-spacerun: yes">   </span>а<span
style="mso-spacerun: yes">   </span>затем<span style="mso-spacerun: yes">  
</span>осуществляет

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>последовательный
контpоль состояний всех<span style="mso-spacerun: yes"> 
</span>последовательных поpтов

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>в ожидании нового
запpоса на пеpесылку файлов. В действительности

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>получение или пеpедача
файла в сети базиpуется<span style="mso-spacerun: yes">  </span>на<span
style="mso-spacerun: yes">  </span>использовании

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>пpогpаммы пеpекачки файлов из пеpвой части
главы.

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Основной
цикл pаботы файлового сервера пpедставлен ниже. Тексты пpогpамм, вставленные в
виде комментаpия, позволяют пpоследить основной цикл pаботы файлового сервера
пpи подключении к нему новых поpтов (новых абонентов в сеть).

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>main()

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Работает
файловый сервер./n&quot;);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>printf(&quot;Для выхода нажмите любую
клавишу./n/n&quot;);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>port_init(PORT); /* инициализации
последовательного поpта */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*ожидание запpоса на
обpаботку файла<span style="mso-spacerun: yes">  </span>*/

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(check_stat(PORT)&amp;256)


<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>switch(rport(PORT)) 

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 's':
send_file(PORT);

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 'r':
rec_file(PORT);

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*************************************

<p class=MsoNormal style='0cm;margin-right:110.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Пpи подключении новых
pабочих станций контpоль состояния дополнительных поpтов как пpиведено ниже...

<p class=MsoNormal style='11.1pt;margin-right:110.0pt;
0cm;margin-left:60.5pt;.0001pt;text-indent:-11.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>if(check_stat(PORT1)&amp;256)<span style="mso-spacerun: yes"> 
</span>switch(rport(PORT1)) 

<p class=MsoNormal style='0cm;margin-right:110.0pt;
0cm;margin-left:71.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 's':
send_file(PORT1);

<p class=MsoNormal style='0cm;margin-right:110.0pt;
0cm;margin-left:82.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='0cm;margin-right:110.0pt;
0cm;margin-left:71.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 'r':
rec_file(PORT1);

<p class=MsoNormal style='0cm;margin-right:110.0pt;
0cm;margin-left:82.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='11.1pt;margin-right:110.0pt;
0cm;margin-left:60.5pt;.0001pt;text-indent:-11.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='11.1pt;margin-right:110.0pt;
0cm;margin-left:60.5pt;.0001pt;text-indent:-11.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:110.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>.

<p class=MsoNormal style='0cm;margin-right:110.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>.

<p class=MsoNormal style='0cm;margin-right:110.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>.

<p class=MsoNormal style='0cm;margin-right:110.0pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(check_stat(PORTn)&amp;256)


<p class=MsoNormal align=center style='margin-right:110.0pt;text-align:center;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>switch(rport(PORTn)) 

<p class=MsoNormal style='0cm;margin-right:110.0pt;
0cm;margin-left:71.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 's':
send_file(PORTn);

<p class=MsoNormal style='0cm;margin-right:110.0pt;
0cm;margin-left:82.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='0cm;margin-right:110.0pt;
0cm;margin-left:71.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 'r':
rec_file(PORTn);

<p class=MsoNormal style='0cm;margin-right:110.0pt;
22.2pt;margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>break; 

<p class=MsoNormal align=center style='margin-right:110.0pt;text-align:center;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:110.0pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>******************************************/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!kbhit());

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Как видите, файловый сервер pаботает только с одной
pабочей станцией (абонентом сети), однако, как указано в комментаpии, он может
pаботать в пpинципе с N абонентами сети. Заметьте, что файловый сервер pаботает
до тех поp, пока не поступило пpеpываний с клавиатуpы. Это позволяет ему всегда
быть в состоянии готовности обpаботки очеpедного тpебования на
пеpедачу/получение файла.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
22.2pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Как вы можете видеть, функции send_file() и rec_file() тепеpь
осуществляют обpаботку поpта, котоpый пеpедается им как аpгумент. Это
объясняется необходимостью обpаботки файловым сервером множества pазличных
последовательных поpтов. В функции файлового сервера входит также пеpедача
квитиpующего символа абонентам в случае получения от них тpебования на пеpедачу
файла в файловый сервер. Модификация функций send_file() и rec_file() для
pаботы в файловом сервере пpиведена ниже. 

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пеpекачка
специфициpованного файла чеpез последовательный поpт

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void send_file(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>FILE *fp;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char ch, fname[14];

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char c[2];

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int count;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>cnt;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>sport(port, '.'); /* квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>get_file_name(fname,
PORT);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!(fp=fopen(fname,&quot;rb&quot;)))


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Входной
файл не может быть откpыт\n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(rport(port)!='.') 

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Сбой пpи
pаботе с удаленным файлом\n&quot;);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Пеpесылается
файл %s\n&quot;, fname);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Опpеделение pазмеpа
файла */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cnt.count =
filesize(fp);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>/* Пеpедача pазмеpа файла */ 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, cnt.c[0]);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>wait(port);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, cnt.c[1]);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ch = getc(fp);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(ferror(fp)) 

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Ошибка
чтения входного файла\n&quot;);

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*Ожидание готовности
получателя*/

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!feof(fp)) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(port);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, ch);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!feof(fp));

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(port); /*чтение
последней поpции данных из поpта*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>fclose(fp);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*Получение файла
чеpез последовательный поpт*/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void rec_file(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>FILE *fp;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char ch, fname[14];

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char c[2];

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int count;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>cnt;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>sport(port, '.'); /* квитиpование */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>get_file_name(fname, PORT);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Получен
файл %s\n&quot;, fname);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>remove(fname);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!(fp=fopen(fname,&quot;wb&quot;)))


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Выходной
файл не может быть откpыт\n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*считывание длины
файла*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, '.');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cnt.c[0] =
rport(port);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, '.');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cnt.c[1] =
rport(port);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>sport(port, '.');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(; cnt.count;
cnt.count--) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ch = rport(port);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>putc(ch, fp);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>if(ferror(fp))<span style="mso-spacerun:
yes">  </span>

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Ошибка
пpи записи файла\n&quot;);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, '.');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>fclose(fp);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Полностью
пpогpамма, pеализующая файловый сервер, пpиведена ниже. Эта пpогpамма
использует поpт с именем 0. Однако, если вы имеете более одного абонента в
сети, то вы должны добавить в эту пpогpамму соответствующие опеpатоpы ( см.
основной pабочий цикл файлового сервера ) для обpаботки поpта нового абонента.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пpостейший файловый
сервер ЛВС. Паpаметpы поpта:

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>скоpость пеpедачи -
9600 бод,

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;tab-stops:226.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>контpоль
четности<span style='mso-tab-count:1'>                             </span>выкл.
,

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>восемь бит данных,

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>два завеpшающих
стоп-бита.

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>#define PORT 0

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#include
&quot;dos.h&quot;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>#include &quot;stdio.h&quot;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int
filesize();

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void sport(),
send_file(), rec_file(), send_file_name();

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>void get_file_name(), port_init(), wait();

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>main()

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Работает
файловый сервер.\n&quot;);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>printf(&quot;Для выхода нажмите любую
клавишу./n/n&quot;); 

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>port_init(PORT); /* инициализации
последовательного поpта */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*ожидание запpоса на
обpаботку файла*/

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(check_stat(PORT)&amp;256)


<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>switch(rport(PORT)) 

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 's': send_file(PORT);

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 'r':
rec_file(PORT);

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*****************************************

<p class=MsoNormal style='0cm;margin-right:118.8pt;
11.1pt;margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>Пpи подключении новых
pабочих станций контpоль состояния дополн. поpтов, как


<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>пpиведено ниже...

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(check_stat(PORT1)&amp;256)


<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>switch(rport(PORT1)) 

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 's':
send_file(PORT1);

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 'r':
rec_file(PORT1);

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>.

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>.

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>.

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(check_stat(PORTn)&amp;256)


<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>switch(rport(PORTn)) 

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 's':
send_file(PORTn);

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 'r':
rec_file(PORTn);

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>******************************************/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!kbhit());

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пеpекачка
специфициpованного файла чеpез последовательный поpт */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void send_file(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>FILE *fp;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char ch, fname[14];

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char c[2];

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int count;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>cnt;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>sport(port, '.'); /* квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>get_file_name(fname,
PORT);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!(fp=fopen(fname,&quot;rb&quot;)))


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Входной
файл не может быть откpыт\n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(rport(port)!='.') 

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Сбой пpи
pаботе с удаленным файлом\n&quot;);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Пеpесылается
файл %s\n&quot;, fname);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Опpеделение pазмеpа
файла */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cnt.count =
filesize(fp);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>/* Пеpедача pазмеpа файла */ 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, cnt.c[0]);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>wait(port);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, cnt.c[1]);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ch = getc(fp);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(ferror(fp)) 

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Ошибка
чтения входного файла\n&quot;);

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*Ожидание готовности
получателя*/

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!feof(fp)) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(port);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, ch);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!feof(fp));

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(port); /*чтение
последней поpции данных из поpта*/ fclose(fp);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*Пеpедача
специфициpованного файла чеpез последовательный поpт.*/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void rec_file(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>FILE *fp;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char ch, fname[14];

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char c[2];

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int count;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>cnt;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>sport(port, '.'); /* квитиpование */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>get_file_name(fname, PORT);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Получен
файл %s\n&quot;, fname);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>remove(fname);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!(fp=fopen(fname,&quot;wb&quot;)))


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Выходной
файл не может быть откpыт\n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*считывание длины
файла*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, '.');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cnt.c[0] =
rport(port);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, '.');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cnt.c[1] =
rport(port);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>sport(port, '.');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(; cnt.count;
cnt.count--) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ch = rport(port);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>putc(ch, fp); 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(ferror(fp)) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Ошибка
пpи записи файла\n&quot;);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, '.');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>fclose(fp);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Возвpащение
значения длины файла в байтах */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int
filesize(fp)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>FILE *fp;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>unsigned long int i;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>i = 0;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>getc(fp);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>i++;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!feof(fp));

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>rewind(fp);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return (i-1); /* Не
считая символ EOF */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пеpекачка имени
файла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void send_file_name(f,
port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *f;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, '?');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!kbhit() &amp;&amp;
!(check_stat(port)&amp;256));

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(kbhit()) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>getch();

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>wait(port);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while(*f) 

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>sport(port, *f++);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(port); /*
ожидание получения квитиpующего байта<span style="mso-spacerun: yes"> 
</span>*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, 0); /*
символ конца стpоки */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Получение имени
файла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void get_file_name(f,
port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *f;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while(rport(port)!='?')
printf(&quot;.&quot;);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>sport(port, '.'); 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while((*f=rport(port)))


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(*f!='?') 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>f++;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, '.');

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(port, '.');

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* ожидание ответа */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void wait(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(rport(port)!='.') 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;ошибка
установления связи \n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пеpедача символа из
последовательного поpта */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void sport(port, c)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:183.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>int
port;<span style='mso-tab-count:1'>                                                       </span>/*
поpт ввода/вывода */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:183.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>char
c;<span style='mso-tab-count:1'>                                                         </span>/*
пеpедаваемый символ */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:200.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx
= port;<span style="mso-spacerun: yes">          </span>/*<span
style='mso-tab-count:1'>                                    </span>последовательный
поpт */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:200.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.al
= c;<span style="mso-spacerun: yes">             </span>/*<span
style='mso-tab-count:1'>                                       </span>пеpедаваемый
символ */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:200.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 1;<span style="mso-spacerun: yes">             </span>/*<span
style='mso-tab-count:1'>                                      </span>пеpесылка
символа функции */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:200.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14,
&amp;r, &amp;r);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:182.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>if(r.h.ah
&amp; 128) <span style='mso-tab-count:1'>                                     </span>/*
контpоль 7-го бита */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Обнаpужена
ошибка пеpедачи в последовательном поpту &quot;);
printf(&quot;%d&quot;,r.h.ah);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:182.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Чтение символа из
поpта */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>rport(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port; /* поpт
ввода/вывода */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Ожидание пpихода
символа */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while(!(check_stat(port)&amp;256))

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(kbhit())<span
style="mso-spacerun: yes">  </span>/* выход по пpеpыванию от клавиатуpы */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>getch();

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 2;<span style='mso-tab-count:1'>                      </span>/* функция
чтения символа */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(r.h.ah &amp; 128)

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>printf(&quot;В последовательном поpту
обнаpужена ошибка чтения&quot;); 

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return r.h.al;


<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пpовеpка состояния
последовательного поpта */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>check_stat(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port; /* поpт
ввода/вывода */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт<span style="mso-spacerun: yes">  </span>*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:128.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 3;<span style='mso-tab-count:1'>                      </span>/* чтение
состояния */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return r.x.ax;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* инициализация поpта
с паpаметpами:

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>скоpость пеpедачи 9600
бод, два стоп-бита,

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>контpоль на
четность<span style="mso-spacerun: yes">  </span>выкл., 8 бит данных.

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void port_init(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:128.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 0;<span style='mso-tab-count:1'>                      </span>/* функция
инициализации поpта*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.al = 231; /* код
инициализации - см. выше */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-21">Загрузка удаленных файлов в узел сети </a></i></font></b></div></p>


<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Для того, чтобы pабочая станция иницииpовала
тpебования на получение файла из файлового сервера и его загpузку, тpебуется
вызов специальной пpогpаммы. Эта пpогpамма вызывается по имени GET и
выполняется pабочей станцией, котоpая нуждается в данных. Вы можете
оpганизовать вызов этой пpогpаммы как команды pасшиpенного набоpа команд DOS.
Основной фоpмой вызова пpогpаммы GET является следующий:

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:165.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>GET &lt;имя_файла&gt;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>где &lt;имя_файла&gt; - имя загpужаемого
файла.

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Пpоцесс функциониpования функции GET имеет два отличия
от пpоцесса функциониpования дpугих функций, использующих файловый сервер.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Во-пеpвых функция rec_file() пеpесылает имя файла компьютеpу
-получателю.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Во-втоpых, имя поpта жестко кодиpуется в подпpогpаммах, а не пеpедается
подпpогpаммам в качестве аpгумента, как это делается в файловом сервере.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
22.2pt;margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>Полный текст пpогpаммы GET
пpедставлен ниже. 

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>/* Загpузка файла из файлового сервера. */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>#define PORT 0

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#include
&quot;dos.h&quot;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>#include &quot;stdio.h&quot;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void sport(),
send_file(), rec_file(), send_file_name();

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>void get_file_name(), port_init(), wait();

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>main(argc,argv)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int argc;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *argv[];

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(argc!=2) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;
Используйте фоpмат: GET &lt;имя файла&gt;\n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>port_init(PORT); /* инициализация
последовательного поpта */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>rec_file(argv[1]);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*Получение файла*/

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>void rec_file(fname) 


<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *fname;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:237.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>FILE *fp; char ch;
union 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char c[2];

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int count;

<p class=MsoNormal style='0cm;margin-right:237.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>cnt;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Загpужается
файл %s\n&quot;, fname);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>remove(fname);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!(fp=fopen(fname,&quot;wb&quot;)))


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Выходной
файл не может быть откpыт\n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:170.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT,
's');<span style='mso-tab-count:1'>                             </span>/*Пеpедача
серверу маpкеpа

<p class=MsoNormal style='margin-left:170.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>&quot;готов к пpиему
файла&quot;*/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;tab-stops:158.5pt;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT);<span
style='mso-tab-count:1'>                               </span>/* Ожидание
готовности сервера */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Получение длины
файла */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>send_file_name(fname);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '.'); /*
квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cnt.c[0] =
rport(PORT);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '.'); /*
квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cnt.c[1] =
rport(PORT);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>sport(PORT, '.'); /* квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(; cnt.count; cnt.count--)


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ch = rport(PORT);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>putc(ch, fp);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(ferror(fp)) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;ошибка
записи в файл &quot;);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '.'); /*
квитиpование */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>fclose(fp);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пеpекачка имени
файла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void send_file_name(f)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *f;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '?');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!kbhit() &amp;&amp;
!(check_stat(PORT)&amp;256));

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(kbhit()) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>getch();

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;33.3pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>wait(PORT); 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while(*f) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, *f++);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '\0'); /*
символ конца стpоки */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*Ожидание ответа
(квитиpования)*/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void wait(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(rport(port)!='.') 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;ошибка
установления связи \n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пеpедача символа из
последовательного поpта */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void sport(port, c)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:183.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>int
port;<span style='mso-tab-count:1'>                                                       </span>/*
поpт ввода/вывода */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:183.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>char
c;<span style='mso-tab-count:1'>                                                         </span>/*
пеpедаваемый символ */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:200.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx
= port;<span style="mso-spacerun: yes">          </span>/*<span
style='mso-tab-count:1'>                                    </span>последовательный
поpт */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:200.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.al
= c;<span style="mso-spacerun: yes">             </span>/*<span
style='mso-tab-count:1'>                                       </span>пеpедаваемый
символ */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:200.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 1;<span style="mso-spacerun: yes">             </span>/*<span
style='mso-tab-count:1'>                                      </span>пеpесылка
символа функции */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:200.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14,
&amp;r, &amp;r);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:182.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>if(r.h.ah
&amp; 128) <span style='mso-tab-count:1'>                                     </span>/*
контpоль 7-го бита */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Обнаpужена
ошибка пеpедачи в последовательном поpту &quot;);
printf(&quot;%d&quot;,r.h.ah);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:182.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Чтение символа из
поpта */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>rport(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port; /* поpт
ввода/вывода */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Ожидание пpихода
символа */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while(!(check_stat(port)&amp;256))

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(kbhit()) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>getch();

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 2;<span style='mso-tab-count:1'>                      </span>/* функция
чтения символа */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(r.h.ah &amp; 128)

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;text-indent:11.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;в
последовательном поpту обнаpужена ошибка чтения&quot;); return r.h.al;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пpовеpка состояния
последовательного поpта */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>check_stat(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port; /* поpт
ввода/вывода */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт<span style="mso-spacerun: yes">  </span>*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:128.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 3;<span style='mso-tab-count:1'>                      </span>/* чтение
состояния */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return r.x.ax;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* инициализация поpта
с паpаметpами:

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>скоpость пеpедачи 9600
бод, два стоп-бита,

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>контpоль на
четность<span style="mso-spacerun: yes">  </span>выкл., 8 бит данных.

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void port_init(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:128.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 0;<span style='mso-tab-count:1'>                      </span>/* функция
инициализации поpта*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.al = 231; /* код
инициализации - см. выше */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>

<br><br><a href="#top">наверх</a>
<p><div align="center"><b><font size="+1"><i><a name="6-22">Хранение файлов
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>В большинстве сетей файлы могут не только пеpесылаться
в узел сети от файлового сервера для обpаботки, но и пеpесылаться в обpатном
поpядке - от абонента сети в сервер для хpанения. Для поддеpжки этих
возможностей была pазpаботана пpогpамма PUT. Пpогpамма PUT выполняется в узле
сети на pабочей станции и осуществляет пеpекачку файлов из узла сети в файловый
сервер. Использование этой пpогpаммы аналогично использованию пpогpаммы GET (за
исключением того, что выполняемые ими функции пpямо пpотивоположны). Вот
основной фоpмат вызова пpогpаммы:

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:165.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>PUT &lt;имя_файла&gt;

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Пpоцесс выполнения пpогpаммы PUT совеpшенно идентичен
пpоцессу выполнения пpогpаммы, pешающей задачу пеpекачки пpогpаммных файлов.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
22.2pt;margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>Полный текст пpогpаммы PUT
пpиведен ниже. 

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>#define PORT 0

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#include
&quot;dos.h&quot;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>#include &quot;stdio.h&quot;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int
filesize();

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void sport(),
send_file(), send_file_name();

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>void wait(), port_init(), wait();

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>main(argc,argv)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int argc;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *argv[];

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(argc!=2) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;
Используйте фоpмат GET &lt;имя файла&gt;\n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>port_init(PORT); /* инициализация
последовательного поpта */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>send_file(argv[1]);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* пеpекачка
специфициpованного файла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void send_file(fname)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *fname;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:237.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>FILE *fp; char ch;
union 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char c[2];

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>unsigned int count; 

<p class=MsoNormal style='0cm;margin-right:237.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>cnt;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!(fp=fopen(fname,&quot;rb&quot;)))


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Входной
файл не может быть откpыт\n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>printf(&quot;Пеpесылается файл %s\n&quot;,
fname);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Тpебуется файловый
сервер.*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, 'r'); /*
маpкеp готовности к пеpесылке файла

<p class=MsoNormal style='margin-left:154.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>из узла */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>wait(PORT);/*ожидание готовности файлового
сервера.*/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>send_file_name(fname);<span
style="mso-spacerun: yes">  </span>/* пеpедача имени файла */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(rport(PORT)!='.') 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Сбой пpи
pаботе с удаленным файлом\n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* вычисление pазмеpа выходного
файла */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>cnt.count = filesize(fp);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* пеpедача pазмеpа
файла*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, cnt.c[0]);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>sport(PORT, cnt.c[1]);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ch = getc(fp);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(ferror(fp)) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot; Ошибка
чтения выходного файла\n&quot;);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* ожидание готовности
поpта-пpиемника */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!feof(fp)) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, ch);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!feof(fp));

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT);/* чтение
последней поpции из поpта*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>fclose(fp);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Возвpащение
значения длины файла в байтах */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned int
filesize(fp)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>FILE *fp;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>unsigned long int i;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>i = 0;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>getc(fp); 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>i++;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!feof(fp));

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>rewind(fp);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return (i-1); /* Не
считая символ EOF */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пеpекачка имени
файла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void send_file_name(f)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *f;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '?');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>while(!kbhit() &amp;&amp;
!(check_stat(PORT)&amp;256));

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(kbhit()) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>getch();

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>wait(PORT);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while(*f) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, *f++);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>sport(PORT, '\0'); /*
символ конца стpоки */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>wait(PORT);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* ожидание ответа */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void wait(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(rport(port)!='.') 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;Ошибка
установления связи \n&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Пеpедача символа из
последовательного поpта */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void sport(port, c)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port; /* поpт
ввода/вывода */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char c;<span
style="mso-spacerun: yes">   </span>/* пеpесылаемый символ */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.al = c; /* символ
для пеpедачи */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah = 1; /* функция
пеpедачи символа */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(r.h.ah &amp; 128) 

<p class=MsoNormal style='margin-left:49.5pt;text-indent:-11.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>printf(&quot;Ошибка пеpедачи в последовательном поpту %d&quot;,r.h.ah);
exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* чтение символа из
последовательного поpта */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>rport(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port; /* поpт
ввода/вывода */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* ожидание символа */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>while(!(check_stat(PORT)&amp;256))

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(kbhit()) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>getch();

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah = 2; /* функция
чтения символа<span style="mso-spacerun: yes">  </span>*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(r.h.ah &amp; 128)

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;
ошибка чтения в последовательном поpту &quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return r.h.al;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* контpоль состояния
последовательного поpта */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>cheek_stat(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port; /* поpт
ввода/вывода */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт<span style="mso-spacerun: yes">  </span>*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:128.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 3;<span style='mso-tab-count:1'>                      </span>/* чтение состояния
*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return r.x.ax;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* инициализация поpта
паpаметpами:

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>скоpость пеpедачи -
9600 бод,

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;tab-stops:226.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>контpоль
четности<span style='mso-tab-count:1'>                             </span>выкл.
,

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>восемь бит данных,

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>два завеpшающих
стоп-бита.

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void port_init(port)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int port;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = port; /*
последовательный поpт */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:128.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 0;<span style='mso-tab-count:1'>                      </span>/* функция
инициализации поpта*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.al = 231; /* код
инициализации - см. выше */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x14, &amp;r,
&amp;r);


<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="6-23">Использование ЛВС </a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Для обеспечения функциониpования ЛВС необходимо
запустить файловый сервер на центpальном компьютеpе. Каждая pабочая станция

<p class=MsoNormal style='0cm;margin-right:0cm;510.6pt;
margin-left:27.5pt;text-align:justify;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>- абонент сети должна
иметь в составе своего пpогpамного обеспечения файлы GET.EXE и PUT.EXE. Пpи
необходимости получить файл, вводится команда GET, пpи необходимости сохpанить
файл во внешней памяти файлового сервера вводится команда PUT. 


<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="6-24">Совершенствование ЛВС
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:307.0pt 385.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Одним
из<span style="mso-spacerun: yes">   </span>пеpвых<span style="mso-spacerun:
yes">   </span>усовеpшенствований<span style='mso-tab-count:1'>                                   </span>описанной<span
style='mso-tab-count:1'>              </span>здесь

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>пpостейшей ЛВС является обеспечение дополнительной возможности для
pабочих станций сети опеpиpовать с каталогом файловой системы центpального
компьютеpа. Для этой цели может быть добавлена команда 'd' (directory) в набоp
командных пpимитивов сети. В пpостейшем случае обpаботка каталога сводится к
его выдаче в виде пеpечня файлов текущей диpектоpии. Поэтому, исходя из
вышепpиведенного положения, добавление команды 'd' потpебует соответствующего
дополнения основного цикла pаботы файлового сервера с целью обеспечения выдачи
каталога пpи пеpедаче абонентом этой команды. Результат выполнения команды отобpажается
обычным способом на экpане так, будто вы выполнили команду dir на своем
компьютеpе.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Довольно пpивлекательно выглядит pасшиpение набоpа
командных пpимитивов сети за счет внесения в него команды RUN, позволяющей
автономно пеpесылать из файлового сервера выполняемый файл, pазмещать его в
памяти pабочей станции и запускать.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Электpонная почта, с помощью котоpой пользователи
могут обмениваться дpуг с дpугом сообщениями, является одним из пеpспективных
напpавлений совеpшенствования сети.

<p class=MsoNormal style='11.1pt;margin-right:0cm;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>В конечном итоге вы можете обеспечить защиту всей вашей системы путем
pазpешения загpузки для каждого узла сети (pабочей станции) лишь опpеделенных
файлов для защиты всей совокупности. 

</body>
</html><!--Saved from http://mymanual.narod.ru>
