<html>

<head>
   <TITLE>C</TITLE>
</head>

<body bgcolor="#00ffff">


<p><div align="center"><b><font size="+1" face="Arial"><a name="1">Глава 1. Исчезающие и иерархические меню. </a></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Одна из наиболее очевидных черт профессионально
написанных программ - это использование исчезающих и иерархических меню. При
правильном использовании, эти меню дают программам дружелюбие, которое
пользователи от них и ожидают. Хотя по существу и простые, и исчезающие, и
иерархические меню представляют некоторые трудности в программировании.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Создание исчезающих и иерархических меню требует
прямого управления экраном. Хотя основные программы меню полностью мобильны,
программы доступа к экрану зависят от операционной системы и оборудования и не
используют обычные функции Си ввода/вывода на консоль. Программы видео доступа
разработаны для работы с любым компьютером, использующим ДОС и имеющим BIOS
операционной системы совместимый с IBM. BIOS-ДОС выбран потому что он широко
используется, но вы можете применить основные идеи и в других системах.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
321.9pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Даже если вас сейчас не интересуют исчезающие и иерархические меню, то
вам следует прочитать часть этой главы, в которой обсуждаются видеоадаптеры,
знание многих основных идей необходимо для понимания последующих глав. 

<p><div align="center"><b><font size="+1"><i><a name="1-1">Что такое исчезающие и иерархические меню?</a></i></font></b></div></p>


<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Важно понимать что такое исчезающие и иерархические
меню и чем они отличаются от стандартных меню. При использовании стандартных
меню экран очищается или сдвигается, и появляется меню. Когда выбор сделан,
экран опять очищается или сдвигается и программа продолжается. Выбор
выполняется по номеру или по первой букве каждой альтернативы.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Когда используется исчезающее или иерархическое меню,
то оно покрывает прямо содержимое экрана. После выбора режима, экран
возвращается в предыдущее состояние. Вы выбираете нужный режим из меню одним из
двух способов: (1) нажимая активную клавишу, которая является буквой или
номером, связанным с выбором, или (2) используя клавиши управления курсором для
передвижения подсвеченного поля и клавишу Ввод. Обычно текущее поле
показывается в инверсном виде. Основная разница между стандартными меню и
исчезающими и иерархическими меню в том, что стандартное меню прерывает
программу. Исчезающие и иерархические меню только приостанавливают текущие
действия программы. С точки зрения пользователя стандартное меню - прерывание
концентрации, тогда как исчезающее меню - просто легкая приостановка,
концентрация внимания пользователя не нарушена.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Разница между исчезающими и иерархическими меню
проста. Только одно исчезающее меню может быть на экране в данный момент
времени. Оно используется когда меню имеет только один уровень в глубину, это
бывает, когда выбор из меню не имеет подвыборов. С другой стороны несколько
иерархических меню могут быть активны одновременно. Они используются когда
выбор из одного меню может потребовать использования другого меню для
определения некоторых альтернатив. Например, вы можете использовать
иерархическое меню, если вы пишете программу, которая определяет фрукт. Если
пользователь выбрал &quot;яблоко&quot;, следующее меню предлагает выбрать цвет
яблока, а третье меню высвечивает яблоки, которые удоволетворяют предыдущим
выборам.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Вы можете представлять исчезающее меню просто как
иерархическое меню, которое не имеет подменю, но разработка отдельных процедур
для этих типов меню имеет то преимущество, что иерархическое меню требует
значительно более сложной программы, чем простое исчезающее меню.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
77.7pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Хотя имеется много способов расположения меню на экране, функции,
разработанные в этой главе имеют наиболее общий вид. Этот метод помещает
очередное поле меню на новую строку под первым полем. 

<p><div align="center"><b><font size="+1"><i><a name="1-2">Работа видеоадаптеров.</a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>Из-за
того, что создание исчезающих и иерархических меню требует прямого управления
экраном, важно понимание адаптеров дисплея. Три основных типа адаптеров - это
одноцветный адаптер, цветной/графический адаптер (CGA) и усовершенствованный
графический адаптер (EGA). CGA и EGA могут иметь несколько режимов работы, включая
40- или 80- символьный текст или графические операции. Эти режимы показаны в
таблице 1-1. Программы меню, разработанные в этой главе, разработаны для
использования режима 80-символьного текста, который является наиболее общим
режимом для общецелевых применений. Это значит, что видео режим системы должен
быть 2, 3 или 7. Независимо от используемого режима - координаты левого
верхнего угла - 0,0.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
5.55pt;margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'>Таблица 1-1.

<table border=0 cellspacing=0 cellpadding=0 width="440">
 <tr>
  <td width=67 valign=top style='width:50.0pt;border-top:double 2.25pt;
  border-left:double 2.25pt;border-bottom:solid .75pt;border-right:solid .75pt;
  border-color:windowtext;padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='11.1pt;margin-right:0cm;
  5.55pt;margin-left:0cm;mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>Режим
  </td>
  <td width=184 valign=top style='width:138.0pt;border-top:double windowtext 2.25pt;
  border-left:none;border-bottom:solid windowtext .75pt;border-right:solid windowtext .75pt;
  mso-border-left-alt:solid windowtext .75pt;padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='11.1pt;margin-right:0cm;
  5.55pt;margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>Тип
  </td>
  <td width=112 valign=top style='width:84.0pt;border-top:double windowtext 2.25pt;
  border-left:none;border-bottom:solid windowtext .75pt;border-right:solid windowtext .75pt;
  mso-border-left-alt:solid windowtext .75pt;padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='11.1pt;margin-right:0cm;
  5.55pt;margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>Размеры
  </td>
  <td width=152 valign=top style='width:114.0pt;border-top:double windowtext 2.25pt;
  border-left:none;border-bottom:solid windowtext .75pt;border-right:double windowtext 2.25pt;
  mso-border-left-alt:solid windowtext .75pt;padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='11.1pt;margin-right:0cm;
  5.55pt;margin-left:22.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>Адаптеры
  </td>
 </tr>
 <tr>
  <td width=67 valign=top style='width:50.0pt;border-top:none;border-left:double windowtext 2.25pt;
  border-bottom:double windowtext 2.25pt;border-right:solid windowtext .75pt;
  mso-border-top-alt:solid windowtext .75pt;padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='5.55pt;margin-right:0cm;
  0cm;margin-left:5.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>0
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>1
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>2
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>3
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>4
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>5
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>6
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>7
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>8
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>9
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>10
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>13
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>14
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>15
  <p class=MsoNormal style='11.1pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>-------
  </td>
  <td width=184 valign=top style='width:138.0pt;border-top:none;border-left:
  none;border-bottom:double windowtext 2.25pt;border-right:solid windowtext .75pt;
  mso-border-top-alt:solid windowtext .75pt;mso-border-left-alt:solid windowtext .75pt;
  padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='5.55pt;margin-right:0cm;
  0cm;margin-left:5.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>текст,ч/б
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>текст 16 цветов
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>текст ч/б
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>текст 16 цветов
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>графика 4 цвета
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>графика 4 серых тона
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>графика ч/б
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>текст ч/б
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>графика 16 цветов
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>графика 16 цветов
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>графика 4 или 16 цв.
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>графика 16 цветов
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>графика 16 цветов
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>графика 4 цвета
  <p class=MsoNormal style='11.1pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>----------------------
  </td>
  <td width=112 valign=top style='width:84.0pt;border-top:none;border-left:
  none;border-bottom:double windowtext 2.25pt;border-right:solid windowtext .75pt;
  mso-border-top-alt:solid windowtext .75pt;mso-border-left-alt:solid windowtext .75pt;
  padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='5.55pt;margin-right:0cm;
  0cm;margin-left:5.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>40*25
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>40*25
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>80*25
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>80*25
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>320*200
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>320*200
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>640*200
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>80*25
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>160*200
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>320*200
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>640*200
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>320*200
  <p class=MsoNormal style='margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>640*200
  <p class=MsoNormal style='5.55pt;text-indent:5.5pt;mso-hyphenate:
  none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
  10.0pt'>640*350 -------------
  </td>
  <td width=152 valign=top style='width:114.0pt;border-top:none;border-left:
  none;border-bottom:double windowtext 2.25pt;border-right:double windowtext 2.25pt;
  mso-border-top-alt:solid windowtext .75pt;mso-border-left-alt:solid windowtext .75pt;
  padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='5.55pt;margin-right:0cm;
  0cm;margin-left:22.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>CGA,EGA
  <p class=MsoNormal style='margin-left:22.0pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>CGA,EGA
  <p class=MsoNormal style='margin-left:22.0pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>CGA,EGA
  <p class=MsoNormal style='margin-left:22.0pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>CGA,EGA
  <p class=MsoNormal style='margin-left:22.0pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>CGA,EGA
  <p class=MsoNormal style='margin-left:22.0pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>CGA,EGA
  <p class=MsoNormal style='0cm;margin-right:4.4pt;
  0cm;margin-left:22.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>CGA,EGA монохромный
  <p class=MsoNormal style='margin-left:22.0pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>PCjr
  <p class=MsoNormal style='margin-left:22.0pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>PCjr
  <p class=MsoNormal style='margin-left:22.0pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>PCjr,EGA
  <p class=MsoNormal style='margin-left:22.0pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>EGA
  <p class=MsoNormal style='margin-left:22.0pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>EGA
  <p class=MsoNormal style='0cm;margin-right:4.4pt;
  5.55pt;margin-left:0cm;text-indent:22.0pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>EGA
  ------
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Символы, выводимые на экран, содержатся в некоторой
зарезервированной области памяти на адаптере дисплея. Адрес одноцветной
информации В0000000H. И CGA, и EGA хранят информацию, начиная с B80000000H.
(Они различны для того, чтобы позволить использовать раздельно текстовый и
графический экран - но на практике это делается редко.) Хотя функции CGA и EGA
различны в разных режимах, они одинаковы в режимах 2 и 3.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Каждый символ, выводимый на экран, требует два байта видео памяти.
Первый байт содержит собственно символ, второй содержит аттрибуты экрана. Для
цветного экрана байт аттрибутов интерпретируется так, как показано в таблице
1-2. Если у вас EGA или CGA, то по умолчанию принимается режим 3, и символы
выводятся с байтом аттрибутов 7. Это значение включает три основных цвета,
производя для символа белый цвет. Для переключения в инверсный

<p
none;text-autospace:none'>режим<span
style="mso-spacerun: yes">  </span>небходимо<span style="mso-spacerun: yes"> 
</span>выключить<span style="mso-spacerun: yes">  </span>три<span
style="mso-spacerun: yes">  </span>основных<span style="mso-spacerun: yes"> 
</span>бита<span style="mso-spacerun: yes">  </span>и<span style="mso-spacerun:
yes">  </span>включить три

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>фоновых бита, что дает значение 70H.

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>Одноцветный
адаптер распознает биты мигания и интенсивности. К счастью, он разработан так,
что интерпретирует аттрибут 7, как нормальный текст (белое на черном) и 70Н как
инверсное видео. Кстати, значение 1 дает подчеркнутые символы. 

<p class=MsoNormal style='11.1pt;margin-right:0cm;
5.55pt;margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><u>Таблица 1-2 <o:p></o:p></span></u></p>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>Байт видеоадаптера

<p class=MsoNormal style='0cm;margin-right:0cm;5.55pt;
margin-left:55.0pt;mso-hyphenate:none;tab-stops:109.0pt 241.0pt;mso-layout-grid-align:
none;text-autospace:none'>Бит<span
style='mso-tab-count:1'>                  </span>Двоичная величина<span
style='mso-tab-count:1'>                      </span>Значение при установке

<table border=0 cellspacing=0 cellpadding=0 style='margin-left:57.0pt;
 border-collapse:collapse;mso-padding-alt:0cm 2.0pt 0cm 2.0pt'>
 <tr>
  <td width=63 valign=top style='width:47.0pt;border:double windowtext 2.25pt;
  border-right:solid windowtext .75pt;padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='5.55pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>0
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>1
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>2
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>3
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>4
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>5
  <p class=MsoNormal style='mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>6
  <p class=MsoNormal style='5.55pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>7
  </td>
  <td width=128 valign=top style='width:96.0pt;border-top:double windowtext 2.25pt;
  border-left:none;border-bottom:double windowtext 2.25pt;border-right:solid windowtext .75pt;
  mso-border-left-alt:solid windowtext .75pt;padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal align=center style='5.55pt;text-align:center;
  mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
  style='font-size:10.0pt'>1
  <p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
  mso-layout-grid-align:none;text-autospace:none'>2
  <p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
  mso-layout-grid-align:none;text-autospace:none'>4
  <p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
  mso-layout-grid-align:none;text-autospace:none'>8
  <p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>16
  <p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>32
  <p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>64
  <p class=MsoNormal style='0cm;margin-right:0cm;5.55pt;
  margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
  none'>128
  </td>
  <td width=216 valign=top style='width:162.0pt;border:double windowtext 2.25pt;
  border-left:none;mso-border-left-alt:solid windowtext .75pt;padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='5.55pt;margin-right:0cm;
  0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>голубой основной
  <p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>зеленый основной
  <p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>красный основной
  <p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>малая интенсивность
  <p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>голубой фоновый
  <p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>зеленый фоновый
  <p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>красный фоновый
  <p class=MsoNormal style='0cm;margin-right:0cm;5.55pt;
  margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
  none'>мигающий символ
  </td>
 </tr>
</table>

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Каждый адаптер имеет по крайней мере в 4 раза больше
памяти, чем необходимо для вывода текста в 80-символьном режиме. Для этого есть
две причины. Во-первых, лишняя память нужна для графики, (конечно кроме
одноцветного адаптера). Во-вторых это позволяет держать в памяти несколько
экранов и потом просто переключаться между ними по мере необходимости. Каждая
область памяти называется видеостраницей и эффект от переключения между
видеостраницами впечатляющ. По умолчанию при инициализации ДОС используется
страница 0, и виртуально все приложения используют страницу 0. По этой причине
она используется и в этой главе. Однако, вы можете использовать и другие
страницы, если захотите.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
88.8pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Имеется три способа доступа к видеоадаптеру. Первый это через
прерывание ДОС, которое достаточно медленно для исчезающего меню. Второй - это
через процедуры BIOS, которые быстрее, и на быстродействующих машинах, таких,
как AT или PS/2 достаточно быстры, если меню невелики. Третий способ - это
чтение и запись прямо в видеопамять, что происходит очень быстро, но требует
большей работы от вас. Эта глава рассматривает два разных подхода в видео
процедурах. Один использует BIOS, а другой прямой доступ к видеопамяти. 
<p><div align="center"><b><font size="+1"><i><a name="1-3">Доступ к экрану через BIOS </a></i></font></b></div></p>


<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Из-за того, что исчезающие и иерархические меню должны
сохранять информацию с того места экрана, на котором они расположены, и восстанавливать
его после выбора, вы должны иметь процедуры, которые сохраняют и загружают
часть экрана. Метод сохранения и восстановления части экрана, рассматриваемый в
этом разделе связан с вызовами двух встроенных в BIOS функций, которые читают и
записывают символы на экран.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
366.3pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Как вы знаете, вызовы BIOS могут быть очень медленными. Однако, они
(более или менее) гарантируют работу на любом компьютере, который имеет BIOS,
совместимый с IBM, даже если аппаратура экрана другая. Позже в этой главе вы
узнаете, как выполнять прямой доступ к видеопамяти на IBM PC и 100% совместимых
машинах для того, чтобы увеличить скорость выполнения. Однако, использование
прямого доступа к видеопамяти снижает в некоторой степени переносимость, так
как требуется 100% совместимость компьютера с IBM PC. Программы меню,
основанные на BIOS следует использовать в применениях, которые требуют большей
мобильности. 
<p><div align="center"><b><font size="+1"><i><a name="1-4">Использование int86() </a></i></font></b></div></p>


<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'> <span
style='font-size:10.0pt'>Вызовы BIOS используют программные прерывания. BIOS
имеет несколько различных прерываний для разных целей. Одно из них мы будем
использовать для доступа к экрану. Это прерывание 16 (10Н), которое
используется для доступа к дисплею. (Если вы не знакомы с доступом к BIOS, то
вы найдете хорошее описание в моей книге &quot;Си: Полный справочник&quot;,
Беркли, 1987). Как и многие прерывания BIOS, прерывание 16 имеет несколько
режимов, выбор которых выполняется по значению регистра AH. Если функция
возвращает значение, то оно заносится в регистр AL. Однако, иногда для
возвращения нескольких значений используются другие регистры. Для доступа к
прерываниям BIOS вам придется использовать функцию Си int86(). (Некоторые
компиляторы могут называть эту функцию другим именем, но MicroSoft C и Турбо Си
называют ее int86(). Последующие рассуждения ориентированы на эти трансляторы,
но вы можете их обобщить.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'>Функция int86() имеет
следующую форму:

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int
int86(num,inregs,outregs)

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int num; /* номер
прерывания */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>union REGS *inregs; /*
входные значения регистров */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>union REGS *outregs; /* выходные значения
регистров */

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
22.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Функция int86() возвращает значение регистра АХ. Тип
REGS описывается в заголовке DOS.H. Этот тип показан здесь так, как он
определен в Турбо Си, однако, он аналогично определен в MisroSoft C и в других
компиляторах.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>struct WORDREGS 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>unsigned int ax, bx,
cx, dx, si, di, cflag, flags;

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>;

<p
none;text-autospace:none'>struct BYTEREGS 

<p
none;text-autospace:none'>unsigned char al, ah,
bl, bh, cl, ch, dl, dh;

<p
none;text-autospace:none'>;

<p
none;text-autospace:none'>union REGS 

<p
none;text-autospace:none'>struct WORDREGS x;

<p
none;text-autospace:none'>struct BYTEREGS h;

<p
none;text-autospace:none'>;

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Как вы можете видеть, REGS - это объединение двух
структур. Использование структуры WORDREGS позволяет рассматривать регистры ЦП
как 16-битные числа. BYTREGS дает вам доступ к отдельным 8- битным регистрам.
Например, для доступа к прерыванию 16, функции 5, вы должны использовать
следующую последовательность.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'>union REGS in,out;

<p
none;text-autospace:none'>in.h.ah=5;

<p class=MsoNormal style='0cm;margin-right:0cm;44.4pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>int86(16,&amp;in,&amp;out); 
<p><div align="center"><b><font size="+1"><i><a name="1-5">Сохранение части экрана.
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Для сохранения содержимого экрана, должно быть
прочитано и запомнено текущее значение каждой позиции экрана. Для считывания
символа с определенной позиции экрана, используется прерывание 16, функция 8,
которая возвращает символ и связанный с ним аттрибут текущей позиции курсора.
Для считывания символа с определенного места экрана, вы должны иметь способ
установки курсора. Хотя некоторые компиляторы Си поддерживают эту функцию,
многие ее не имеют. Тем не менее показанная ниже функция goto_xy() может быть
использована. Она использует прерывание 16, функцию 2 с координатой столбца в
DL и координатой ряда в DH. Видеостраница задается в ВН (используется страница
0 по умолчанию).

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* установка курсора в
x,y */

<p
none;text-autospace:none'>void goto_xy(x,y)

<p
none;text-autospace:none'>int x,y;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>union REGS r;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.ah=2; /* функция
установки курсора */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.dl=y; /*
координата колонки<span style="mso-spacerun: yes">       </span>*/

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.dh=x; /*
координата строки<span style="mso-spacerun: yes">        </span>*/

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.bh=0; /* видео
страница<span style="mso-spacerun: yes">           </span>*/

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int86(0x10,&amp;r,&amp;r);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Прерывание 16, функция 8 возвращает символ из текущей
позиции курсора в AL и его атрибут в AH. Функция save_video(), показанная
здесь, считывает часть экрана, сохраняет информацию в буфер, и очищает эту
часть экрана.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* сохранение части
экрана */

<p
none;text-autospace:none'>void save_video(startx,endx,starty,endy,buf_ptr)

<p
none;text-autospace:none'>int<span
style="mso-spacerun: yes">   </span>startx,endx,starty,endy;

<p
none;text-autospace:none'>unsigned int *buf_ptr;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>union REGS r;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>register int i,j;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=starty;i&lt;endy;i++)

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(j=startx;j&lt;endx;j++)


<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(j,i);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.ah=8; /* функция
чтения символа<span style="mso-spacerun: yes">   </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:283.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.bh=0;
/* видео страница<span style='mso-tab-count:1'>                                                   </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*buf_ptr++ =
int86(0x10,&amp;r,&amp;r);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>putchar(' '); /*
очистка экрана */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>Первые<span style="mso-spacerun: yes"> 
</span>четыре<span style="mso-spacerun: yes">  </span>параметра<span
style="mso-spacerun: yes">  </span>save_video<span style="mso-spacerun: yes"> 
</span>определяют координаты 


<p
none;text-autospace:none'>верхнего<span
style="mso-spacerun: yes">  </span>левого<span style="mso-spacerun: yes"> 
</span>и<span style="mso-spacerun: yes">  </span>правого<span
style="mso-spacerun: yes">  </span>нижнего<span style="mso-spacerun: yes"> 
</span>угла<span style="mso-spacerun: yes">  </span>сохраняемой области.

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Параметр buf_ptr это целый указатель на область памяти, которая
содержит информацию. Она должна быть достаточно большой, чтобы разместить всю
информацию, считанную с экрана.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
499.5pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Программы в этой главе размещают буфер динамически, но вы можете
использовать любую другую схему, если это важно для ваших приложений. Не
забудьте, однако, что буфер должен существовать, до тех пор, пока экран не
вернется в исходное состояние. Эта функция также чистит область, записывая
пробел в каждой позиции. 
<p><div align="center"><b><font size="+1"><i><a name="1-6">Восстановление экрана 
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Восстановление экрана после сделанного выбора из меню,
заключается просто в записи предварительно запомненной информации назад в видео
память. Для того, чтобы сделать это, используйте прерывание 16, функцию 9,
которая требует, чтобы символ был в AL, аттрибут в BL, видео страница в ВН, а
количество записываемых символов в CX (в нашем случае 1). Функция
restore_video(), описанная здесь, помещает информацию из буфера, на который
указывает buf_ptr, на экран, заданный начальными и конечными координатами X и
Y.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* восстановление
части экрана */

<p
none;text-autospace:none'>void
restore_video(startx,endx,starty,endy,buf_ptr)

<p
none;text-autospace:none'>int<span
style="mso-spacerun: yes">   </span>startx,endx,starty,endy;

<p
none;text-autospace:none'>unsigned int *buf_ptr;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>union REGS r;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>register int i,j;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=starty;i&lt;endy;i++)

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(j=startx;j&lt;endx;j++)


<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(j,i);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:283.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.ah=9;
/* функция записи символа<span style='mso-tab-count:1'>                                 </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:283.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.bh=0;
/* видео страница<span style='mso-tab-count:1'>                                                   </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:283.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.x.cx=1;
/* число повторений символа<span style='mso-tab-count:1'>                               </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:283.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.al=*buf_ptr++;
/* символ<span style='mso-tab-count:1'>                                                 </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:283.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.bl=*buf_ptr++;
/* атрибут<span style='mso-tab-count:1'>                                                </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*buf_ptr++ =
int86(0x10,&amp;r,&amp;r);
<p><div align="center"><b><font size="+1"><i><a name="1-7">Создание исчезающих меню 
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Функции, создающей исчезающее меню, должна быть
передана некоторая информация. Во-первых, это список предоставляемых меню
режимов. Поскольку в меню передаются высвечиваемые строки, то простейший путь
передачи списка строк в функцию - помещение их в двумерный массив и передача
указателя на массив. Как утверждалось ранее, значение меню может быть выбрано
либо передвижением освещенной области на нужное поле и нажатием ВК или нажатием
клавиши, указывающей на это поле. Для того, чтобы функция знала, какие клавиши
&quot;горячие&quot; и что они обозначают, ей должны быть переданы их имена.
Лучший путь для этого - передать строку, которая содержит символы
&quot;горячих&quot; клавиш в том же порядке, что и строки меню.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Функция popup() должна также знать как много режимов в
меню, и поэтому это число должно быть передано ей. Она должна также знать где
расположить меню, то есть нужны координаты X и Y. Наконец, в некоторых
ситуациях может быть желательным помещать меню в рамку, а в других - нет.
Поэтому должно быть передано значение рамка включена/выключена. Для того, чтобы
начать разработку функции popup() нам нужно описание :

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* высветить
исчезающее меню и возвратить выбор */

<p
none;text-autospace:none'>int
popup(menu,keys,count,x,y,border)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>char
*menu[];<span style='mso-tab-count:1'>               </span>/*<span
style='mso-tab-count:1'>    </span>текст меню */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>char
*keys;<span style='mso-tab-count:1'>                   </span>/*<span
style='mso-tab-count:1'>    </span>горячие клавиши */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>int
count;<span style='mso-tab-count:1'>                       </span>/*<span
style='mso-tab-count:1'>    </span>число режимов */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>int
x,y;<span style='mso-tab-count:1'>                            </span>/*<span
style='mso-tab-count:1'>    </span>координаты левого верхнего угла */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;mso-layout-grid-align:
none;text-autospace:none'>int border;<span
style='mso-tab-count:1'>                     </span>/*<span style='mso-tab-count:
1'>    </span>если 0 то без рамки */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>Функция popup() делает следующее :

<p
none;text-autospace:none'># Сохраняет область
экрана под меню

<p
none;text-autospace:none'># Высвечивает рамку,
если надо

<p
none;text-autospace:none'># Высвечивает меню

<p
none;text-autospace:none'># Получает ответ
пользователя

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'># Восстанавливает экран в исходное
состояние

<p class=MsoNormal style='0cm;margin-right:0cm;133.2pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>Две
из этих целей были достигнуты в save_video() и restore_video(), описанных в
предыдущем разделе. Давайте рассмотрим как достигнуть три оставшиеся. 
<p><div align="center"><b><font size="+1"><i><a name="1-8">Высвечивание меню. 
</a></i></font></b></div></p>


<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Для того, чтобы высветить меню, необходимо помнить,
что popup получает указатель на массив указателей на строки. Для высвечивания
отдельных строк вы просто индексируете указатель, как массив. Каждый элемент в
массиве является указателем на соответствующий элемент меню. Следующая функция
display_menu() высвечивает каждый элемент меню.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* высвечивание меню
на своем месте */

<p
none;text-autospace:none'>void
display_menu(menu,x,y,count)

<p
none;text-autospace:none'>char *menu[];

<p
none;text-autospace:none'>int x,y,count;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>register int i;

<p
none;text-autospace:none'>for(i=0;i&lt;count;i++,x++)


<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(x,y);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(menu[i]);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Как вы можете видеть, эта функция получает указатель
на массив строк, которые надо вывести, координаты начала меню и количество
строк в меню.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>В дальнейшем простейший способ создать двумерный
массив символов, который содержит строки меню - это создание переменной в общем
виде:

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>char *&lt;имя меню&gt;
[] = 

<p
none;text-autospace:none'>&quot;первая
строка&quot;,

<p
none;text-autospace:none'>&quot;вторая
строка&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>.

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>.

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;N-ая<span
style="mso-spacerun: yes">   </span>строка&quot; ;

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Это описание автоматически заставляет компилятор Си
поместить строки в таблицу строк. Переменная указывает на первый символ первой
строки в таблице. Например, это описание создает переменную fruit (фрукт),
которая указывает на &quot;Я&quot; в &quot;Яблоко&quot;.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>char *fruit[] = 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Яблоко&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Апельсин&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Груша&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Грейпфрут&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Малина&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Клубника&quot;
<p><div align="center"><b><font size="+1"><i><a name="1-9">Высвечивание рамки 
</a></i></font></b></div></p>


<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Если нужна рамка, то можно воспользоваться
нижеприведенной программой для вывода рамки вокруг меню с заданными
координатами левого верхнего и правого нижнего углов. Она использует символы,
которые являются частью стандартного набора символов на машинах, совместимых с
IBM. Если вы хотите, вы можете выбрать другие.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>void
draw_border(startx,starty,endx,endy)

<p
none;text-autospace:none'>int<span
style="mso-spacerun: yes">   </span>startx,starty,endx,endy;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=startx+1;i&lt;endx;i++)


<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(i,starty);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>putchar(179);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(i,endy);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>putchar(179);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=starty+1;i&lt;endy;i++)


<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(startx,i);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>putchar(196);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(endx,i);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>putchar(196);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(startx,starty);
putchar(218);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(startx,endy<span
style="mso-spacerun: yes">  </span>); putchar(191);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(endx<span
style="mso-spacerun: yes">  </span>,starty); putchar(192);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(endx<span
style="mso-spacerun: yes">  </span>,endy<span style="mso-spacerun: yes"> 
</span>); putchar(217);
<p><div align="center"><b><font size="+1"><i><a name="1-10">Ввод выбора пользователя
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Как утверждалось, пользователь может вводить выбор
одним из двух способов. Во-первых с помощью клавиш СТРЕЛКА ВНИЗ и СТРЕЛКА ВВЕРХ
может переместить освещение на строку и нажать Ввод для ее выбора, (Обычно
освещение строки выполняется в инверсном режиме.) Освещенную строку также можно
передвигать пробелом. Второй способ это нажатие клавиши, связанной с выбором.
Функция get_resp(), показанная здесь, достигает этих целей.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* ввести выбор
пользователя */

<p
none;text-autospace:none'>get_resp(x,y,count,menu,keys)

<p
none;text-autospace:none'>int x,y,count;

<p
none;text-autospace:none'>char *menu[];

<p
none;text-autospace:none'>char *keys;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>union inkey 

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>char ch[2];

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int i;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span
style="mso-spacerun: yes"> </span>c;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>int arrow_choice=0,key_choice;

<p
none;text-autospace:none'>y++;

<p
none;text-autospace:none'>/* осветить первый
выбор */

<p
none;text-autospace:none'>goto_xy(x,y);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>write_video(x,y,menu[0],REV_VID);

<p
none;text-autospace:none'>for(;;) 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>while(!bioskey(1)); /*
ждать нажатия */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>c.i=bioskey(0);

<p
none;text-autospace:none'>/* вернуть выбор в
номальный режим */

<p
none;text-autospace:none'>goto_hy(arrow_choice,y);

<p
none;text-autospace:none'>write_video(x+arrow_choice,y,

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>menu[arrow_choice],norm_vid);

<p
none;text-autospace:none'>if(c.ch[0])<span
style="mso-spacerun: yes">  </span>/* обычная клавиша */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>key_choice=
is_in(keys,tоlower(c.ch[0]));

<p
none;text-autospace:none'>if(key_choice) return
key_choice-1;

<p
none;text-autospace:none'>switch(c.ch[0]) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case '\r' : return
arrow_choice;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case ' '<span
style="mso-spacerun: yes">  </span>: arrow_choice++;

<p class=MsoNormal style='margin-left:104.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>break;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case ESC<span
style="mso-spacerun: yes">   </span>: return -1; /* выйти */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>else<span
style="mso-spacerun: yes">  </span>/* специальная клавиша */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>switch(c.ch[1]) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 72 :
arrow_choice--; /* стрелка вниз */

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>break;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 80 :
arrow_choice++; /* стрелка вверх */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>break;

<p
none;text-autospace:none'>if(arrow_choice==count)
arrow_choice=0;

<p
none;text-autospace:none'>if(arrow_choice&lt;0)
arrow_choice=count-1;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* подсветить
выбранную опцию */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(x+arrow_choice,y);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>write_video(x+arrow_choice,y,menu[arrow_choice],REV_VID);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><span
style="mso-spacerun: yes"> </span>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Kогда get_resp() начинает выполняться, освещается
первое значение меню. Макроопределение REV_VID определяется везде, как 70Н, а
NORM_VID как 7Н. Клавиша ESCAPE используется для окончания работы с меню.
Значение ESC 27. После этого программа входит в цикл, ожидающий действий
пользователя. Она использует функцию bioskey() для того, чтобы дождаться
нажатия клавиши, а затем для считывания с этой клавиши. Функция bioskey() специфична
для Турбо Си. Если вы используете другой транслятор, вы можете использовать
следующую версию функции.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* эмуляция части
функции bioskey Турбо Си */

<p
none;text-autospace:none'>bioskey(c)

<p
none;text-autospace:none'>int c;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>switch(c) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 0: return
get_key();

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 1: return
kbhit();

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* чтение 16 битного
скан кода клавиши */

<p
none;text-autospace:none'>get_key()

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>union REGS r;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.ah=0;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>return int86(0x16, &amp;r,&amp;r);

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Причина, по которой вы должны использовать bioskey()
вместо getchar() состоит в том, что программа должна иметь возможность
считывать полный 16 битный скан код, генерируемый нажатием клавиши. Если нажата
символьная клавиша, то символ помещается в младшие 8 бит, а старшие 8 бит равны
0. Однако, если нажата специальная клавиша, такая, как стрелка, младший байт
равен 0, а старший содержит код позиции клавиши. Коды позиции для стрелки вверх
и стрелки вниз равны 72 и 80 соответственно. Такие функции, как getchar(),
возвращают только код символа, и поэтому необходимо получить прямо скан код
помимо них.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Каждый раз при нажатии стрелки освещенная опция переходит в нормальное
изображение, а следующая - освещается. Нажатие стрелки вниз, в момент освещения
крайней нижней позиции, означает возвращение к первому значению. То же самое,
но наоборот происходит когда нажимается стрелка вверх при освещенной первой


<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>строке.

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Функция write_video() используется функцией get_resp()
для записи строки на дисплей в позиции Х,Y с определенным атрибутом.
Write_video(), показанная здесь, используется для вывода строки меню в
инверсном режиме, если она освещена, или в нормальном, если она не освещена.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* вывод строки с
определенным атрибутом */

<p
none;text-autospace:none'>void
write_video(x,y,p,attrib)

<p
none;text-autospace:none'>int x,y;

<p
none;text-autospace:none'>char *p;

<p
none;text-autospace:none'>int attrib;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>union REGS r;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>register int i,j;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=y; *p; i++) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(x,i);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.ah=9; /* функция
записи символа<span style="mso-spacerun: yes">   </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.bh=0; /* видео
страница<span style="mso-spacerun: yes">           </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.x.cx=1; /* число
повторений символа */

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.al=*p++; /*
символ<span style="mso-spacerun: yes">          </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:259.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.bl=attrib;
/* атрибут<span style='mso-tab-count:1'>                                                </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int86(0x10,&amp;r,&amp;r);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Функция is_in() возвращает позицию &quot;горячей&quot;
клавиши в строке. Если пользователь нажал не ключевую клавишу, то is_in
возвращает 0.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>is_in(s,c)

<p
none;text-autospace:none'>char *s,c;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>register int i;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=0; *s; i++)

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if(*s++ == c) return
i+1;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return 0;
<p><div align="center"><b><font size="+1"><i><a name="1-11">Функция popup() 
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
22.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>А теперь, когда все части созданы, функция popup может
быть записана, как это показано здесь.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* вывести исчезающее
меню и вернуть выбор

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>возвращает -2, если
меню не может быть создано

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>возвращает -1, если
пользователь нажал клавишу ESC

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>в остальных случаях
она возвращает номер выбранной

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>альтернативы, начиная
с 0 */

<p
none;text-autospace:none'>int popup(menu,keys,count,x,y,border)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>char
*menu[];<span style='mso-tab-count:1'>               </span>/*<span
style='mso-tab-count:1'>    </span>текст меню */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>char
*keys;<span style='mso-tab-count:1'>                   </span>/*<span
style='mso-tab-count:1'>    </span>горячие клавиши */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>int
count;<span style='mso-tab-count:1'>                       </span>/*<span
style='mso-tab-count:1'>    </span>число альтернатив */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>int
x,y;<span style='mso-tab-count:1'>                            </span>/*<span
style='mso-tab-count:1'>    </span>координаты левого верхнего угла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>int
border;<span style='mso-tab-count:1'>                     </span>/*<span
style='mso-tab-count:1'>    </span>если 0 то без рамки */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i,len;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int endx endy choice;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>unsigned int *p;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if((x&gt;24)||(x&lt;0)||(y&gt;79)||(y&lt;0))


<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(&quot; выход за
пределы экрана&quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return -2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* вычисление размеров
*/

<p
none;text-autospace:none'>len=0;

<p
none;text-autospace:none'>for(i=0;i&lt;count;i++)

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if(strlen(menu[i])
&gt; len) len=strlen(menu[i]);

<p
none;text-autospace:none'>endy=len+2+y;

<p
none;text-autospace:none'>endx=count+1+x;

<p
none;text-autospace:none'>if((endx+1&gt;24) ||
(endy+1&gt;79)) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(&quot; выход за
пределы экрана&quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return -2;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* размещение памяти
для видео буфера */

<p
none;text-autospace:none'>p=(unsigned int
*)malloc((endx-x+1)*(endy-y+1));

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>if(!p) exit(1); /* Вы можете здесь сами
обработать ошибку */

<p
none;text-autospace:none'>/* сохранение части
экрана */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>void
save_video(startx,endx,starty,endy,p);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>if(border) draw_border(x,y,endx,endy);

<p
none;text-autospace:none'>/* высвечивание меню
на своем месте */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>void display_menu(menu,x,y,count);

<p
none;text-autospace:none'>/* ввести выбор
пользователя */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>choice=get_resp(x,y,count,menu,keys)

<p
none;text-autospace:none'>/* восстановление
части экрана */

<p
none;text-autospace:none'>void
restore_video(startx,endx,starty,endy,p);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>free(p); 

<p
none;text-autospace:none'>return choice;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;455.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>Как
вы можете видеть, popup() проверяет выход за пределы экрана и слишком большой
размер меню. Она возвращает -2, если возникла одна из этих ситуаций. Из-за
того, что get_resp() возвращает -1, при нажатии клавиши ESC, возвращение этого
значения функцией popup следует рассматривать как &quot;уничтожение&quot; меню.
Если пользователь сделал выбор, то возвращаемое значение будет в пределах от 0
до count-1 с соответствием первому значению меню 0. Как уже указывалось,
popup() использует динамическое размещение памяти для обеспечения временной
памяти для информации об экране. Обычно это лучший подход, но вы можете
свободно изменить его, если это важно для вашего приложения. 
<p><div align="center"><b><font size="+1"><i><a name="1-12">Общий обзор 
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Простая программа, показанная здесь, использует все
программы, разработанные для использования исчезающих меню. Вы не видели только
функции cls(), которая очищает экран. Некоторые трансляторы Си не имеют функции
для этого, и если это так, то вы не можете использовать следующую программу (в
чистом виде).

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* процедура
исчезающего меню для работы в текстовом режиме */

<p
none;text-autospace:none'>#include
&quot;stdio.h&quot;

<p
none;text-autospace:none'>#include
&quot;dos.h&quot;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>#include &quot;stdlib.h&quot;

<p
none;text-autospace:none'>#define BORDER 1

<p
none;text-autospace:none'>#define ESC 27

<p
none;text-autospace:none'>#define REV_VID 0x70

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>#define NORM_VID<span style="mso-spacerun:
yes">  </span>7

<p
none;text-autospace:none'>void
save_video(),restore_video();

<p
none;text-autospace:none'>void
goto_xy(),cls(),write_video();

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>void display_menu(),draw_border();

<p
none;text-autospace:none'>char *fruit[] = 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Яблоко&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Апельсин&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Груша&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Грейпфрут&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Малина&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Клубника&quot;

<p
none;text-autospace:none'>;

<p
none;text-autospace:none'>char *color[]=

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Красный&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Желтый&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Оранжевый&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Зеленый&quot;

<p
none;text-autospace:none'>;

<p
none;text-autospace:none'>char *apple_type[] = 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Красный
деликатес&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Джонатан&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Белый
налив&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Антоновка&quot;

<p
none;text-autospace:none'>;

<p
none;text-autospace:none'>main()

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>int i;

<p
none;text-autospace:none'>cls();

<p
none;text-autospace:none'>goto_xy(0,0);

<p
none;text-autospace:none'>for(i=0;i&lt;25;i++)

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>printf(&quot;Это тест исчезающего
меню\n&quot;); 

<p
none;text-autospace:none'>popup(fruit,&quot;яагрмк&quot;,6,1,3,BORDER);

<p
none;text-autospace:none'>popup(color,&quot;кжоз&quot;,4,5,10,BORDER);

<p
none;text-autospace:none'>popup(apple_type,&quot;кдба&quot;,4,10,18,BORDER);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* вывести исчезающее
меню и вернуть выбор

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>возвращает -2, если
меню не может быть создано

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>возвращает -1, если
пользователь нажал клавишу ESC

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>в остальных случаях
она возвращает номер выбранной

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>альтернативы, начиная
с 0 */

<p
none;text-autospace:none'>int
popup(menu,keys,count,x,y,border)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>char
*menu[];<span style='mso-tab-count:1'>               </span>/*<span
style='mso-tab-count:1'>    </span>текст меню */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>char
*keys;<span style='mso-tab-count:1'>                   </span>/*<span
style='mso-tab-count:1'>    </span>горячие клавиши */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>int
count;<span style='mso-tab-count:1'>                       </span>/*<span
style='mso-tab-count:1'>    </span>число альтернатив */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>int
x,y;<span style='mso-tab-count:1'>                            </span>/*<span
style='mso-tab-count:1'>    </span>координаты левого верхнего угла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>int
border;<span style='mso-tab-count:1'>                     </span>/*<span
style='mso-tab-count:1'>    </span>если 0 то без рамки */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i,len;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int endx endy choice;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>unsigned char *p;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if((x&gt;24)||(x&lt;0)||(y&gt;79)||(y&lt;0))


<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(&quot; выход за
пределы экрана&quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return -2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* вычисление размеров
*/

<p
none;text-autospace:none'>len=0;

<p
none;text-autospace:none'>for(i=0;i&lt;count;i++)

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if(strlen(menu[i])
&gt; len) len=strlen(menu[i]);

<p
none;text-autospace:none'>endy=len+2+y;

<p
none;text-autospace:none'>endx=count+1+x;

<p
none;text-autospace:none'>if((endx+1&gt;24) ||
(endy+1&gt;79)) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(&quot; выход за
пределы экрана&quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return -2;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* размещение памяти
для видео буфера */

<p
none;text-autospace:none'>p=(unsigned int
*)malloc((endx-x+1)*(endy-y+1));

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>if(!p) exit(1); /* Вы можете здесь сами
обработать ошибку */

<p
none;text-autospace:none'>/* сохранение части
экрана */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>void save_video(x,endx+1,y,endy+1,p);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>if(border) draw_border(x,y,endx,endy);

<p
none;text-autospace:none'>/* высвечивание меню
на своем месте */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>void display_menu(menu,x,y,count);

<p
none;text-autospace:none'>/* ввести выбор
пользователя */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>choice=get_resp(x,y,count,menu,keys)

<p
none;text-autospace:none'>/* восстановление
части экрана */

<p
none;text-autospace:none'>void
restore_video(x,endx+1,y,endy+1,p);

<p
none;text-autospace:none'>free(p);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>return choice; 

<p
none;text-autospace:none'>/* высвечивание меню
на своем месте */

<p
none;text-autospace:none'>void
display_menu(menu,x,y,count)

<p
none;text-autospace:none'>char *menu[];

<p
none;text-autospace:none'>int x,y,count;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>register int i;

<p
none;text-autospace:none'>for(i=0;i&lt;count;i++,x++)


<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(x,y);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(menu[i]);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>void
draw_border(startx,starty,endx,endy)

<p
none;text-autospace:none'>int<span
style="mso-spacerun: yes">   </span>startx,starty,endx,endy;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>register int i;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=startx+1;i&lt;endx;i++)


<p
none;text-autospace:none'>goto_xy(i,starty);

<p
none;text-autospace:none'>putchar(179);

<p
none;text-autospace:none'>goto_xy(i,endy);

<p
none;text-autospace:none'>putchar(179);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=starty+1;i&lt;endy;i++)


<p
none;text-autospace:none'>goto_xy(startx,i);

<p
none;text-autospace:none'>putchar(196);

<p
none;text-autospace:none'>goto_xy(endx,i);

<p
none;text-autospace:none'>putchar(196);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>goto_xy(startx,starty);
putchar(218);

<p
none;text-autospace:none'>goto_xy(startx,endy<span
style="mso-spacerun: yes">  </span>); putchar(191);

<p
none;text-autospace:none'>goto_xy(endx<span
style="mso-spacerun: yes">  </span>,starty); putchar(192);

<p
none;text-autospace:none'>goto_xy(endx<span
style="mso-spacerun: yes">  </span>,endy<span style="mso-spacerun: yes"> 
</span>); putchar(217);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* ввести выбор
пользователя */

<p
none;text-autospace:none'>get_resp(x,y,count,menu,keys)

<p
none;text-autospace:none'>int x,y,count;

<p
none;text-autospace:none'>char *menu[];

<p
none;text-autospace:none'>char *keys;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>union inkey 

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>char ch[2];

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int i;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span
style="mso-spacerun: yes"> </span>c;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>int arrow_choice=0,key_choice;

<p
none;text-autospace:none'>y++;

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>/* осветить первый выбор */ 

<p
none;text-autospace:none'>goto_xy(x,y);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>write_video(x,y,menu[0],REV_VID);

<p
none;text-autospace:none'>for(;;) 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>while(!bioskey(1)); /*
ждать нажатия */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>c.i=bioskey(0);

<p
none;text-autospace:none'>/* вернуть выбор в
номальный режим */

<p
none;text-autospace:none'>goto_xy(arrow_choice,y);

<p
none;text-autospace:none'>write_video(x+arrow_choice,y,

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>menu[arrow_choice],norm_vid);

<p
none;text-autospace:none'>if(c.ch[0])<span
style="mso-spacerun: yes">  </span>/* обычная клавиша */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>key_choice=
is_in(keys,tоlower(c.ch[0]));

<p
none;text-autospace:none'>if(key_choice) return
key_choice-1;

<p
none;text-autospace:none'>switch(c.ch[0]) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case '\r' : return
arrow_choice;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case ' '<span
style="mso-spacerun: yes">  </span>: arrow_choice++;

<p class=MsoNormal style='margin-left:104.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>break;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case ESC<span
style="mso-spacerun: yes">   </span>: return -1; /* выйти */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>else<span
style="mso-spacerun: yes">  </span>/* специальная клавиша */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>switch(c.ch[1]) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 72 :
arrow_choice--; /* стрелка вниз */

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>break;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 80 :
arrow_choice++; /* стрелка вверх */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>break;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>if(arrow_choice==count)
arrow_choice=0;

<p
none;text-autospace:none'>if(arrow_choice&lt;0)
arrow_choice=count-1;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* подсветить
выбранную опцию */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(x+arrow_choice,y);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>write_video(x+arrow_choice,y,menu[arrow_choice],REV_VID);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* вывод строки с
определенным атрибутом */

<p
none;text-autospace:none'>void
write_video(x,y,p,attrib)

<p
none;text-autospace:none'>int x,y;

<p
none;text-autospace:none'>char *p;

<p
none;text-autospace:none'>int attrib;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>union REGS r;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>register int i,j;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=y; *p; i++) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(x,i);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.ah=9; /* функция
записи символа<span style="mso-spacerun: yes">   </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.bh=0; /* видео
страница<span style="mso-spacerun: yes">           </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.x.cx=1; /* число
повторений символа */

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.al=*p++; /*
символ<span style="mso-spacerun: yes">          </span>*/

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:55.0pt;mso-hyphenate:none;tab-stops:259.0pt;mso-layout-grid-align:
none;text-autospace:none'>r.h.bl=attrib; /*
атрибут<span style='mso-tab-count:1'>                                                </span>*/


<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int86(0x10,&amp;r,&amp;r);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* сохранение части
экрана */

<p
none;text-autospace:none'>void
save_video(startx,endx,starty,endy,buf_ptr)

<p
none;text-autospace:none'>int<span
style="mso-spacerun: yes">   </span>startx,endx,starty,endy;

<p
none;text-autospace:none'>unsigned int *buf_ptr;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>union REGS r;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>register int i,j;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=starty;i&lt;endy;i++)

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(j=startx;j&lt;endx;j++)


<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(j,i);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.ah=8; /* функция
чтения символа<span style="mso-spacerun: yes">   </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:283.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.bh=0;
/* видео страница<span style='mso-tab-count:1'>                                                   </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*buf_ptr++ =
int86(0x10,&amp;r,&amp;r);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>putchar(' '); /*
очистка экрана */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* восстановление
части экрана */

<p
none;text-autospace:none'>void restore_video(startx,endx,starty,endy,buf_ptr)

<p
none;text-autospace:none'>int<span
style="mso-spacerun: yes">   </span>startx,endx,starty,endy;

<p
none;text-autospace:none'>unsigned int *buf_ptr;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>union REGS r;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>register int i,j;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=starty;i&lt;endy;i++)

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(j=startx;j&lt;endx;j++)


<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(j,i);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:283.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.ah=9;
/* функция записи символа<span style='mso-tab-count:1'>                                 </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:283.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.bh=0;
/* видео страница<span style='mso-tab-count:1'>                                                   </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:283.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.x.cx=1;
/* число повторений символа<span style='mso-tab-count:1'>                               </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:283.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.al=*buf_ptr++;
/* символ<span style='mso-tab-count:1'>                                                 </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:283.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.bl=*buf_ptr++;
/* атрибут<span style='mso-tab-count:1'>                                                </span>*/

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int86(0x10,&amp;r,&amp;r);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* очистка экрана */

<p
none;text-autospace:none'>void cls()

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>union REGS r;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.ah=6; /* код
прокрутки экрана */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.al=0; /* код
очистки экрана */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.ch=0; /* начальная
строка */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.cl=0; /* начальная
колонка */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.dh=24; /* конечная
строка */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.dl=79; /* конечная
колонка */

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>r.h.bh=7; /* очистка пустой строки */ 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int86(0x10,&amp;r,&amp;r);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;455.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>Вводите
эту программу в ваш компьютер и запускаете ее. В ходе ее выполнения каждое меню
будет высвечено и исчезнет. (В этой программе все ответы теряются, но реальное
применение будет, конечно, их обрабатывать.) Даже если ваш компьютер очень
быстрый, вы возможно заметите, что исчезновение и появление меню требуют
определенной задержки. Единственный путь решения этой проблемы - читать и
писать символы прямо в видео память, что и обсуждается в следующем разделе. Еще
раз отметим, что единственное важное достоинство использование BIOS в том, что
такие меню работают на любом компьютере, который поддерживает BIOS, совместимый
с IBM, даже если компьютер не 100% совместимый. 

<p><div align="center"><b><font size="+1"><i><a name="1-13">Прямой доступ к видео памяти
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Для создания меню, которые действительно &quot;исчезают&quot;
вы должны миновать вызовы функций BIOS и прямо обращаться к видео памяти. Это
позволяет высвечивать символы с молниеносной быстротой. При прямой записи и
чтении из видео памяти вы можете использовать исчезающие меню в реальном
времени!

<p class=MsoNormal style='11.1pt;margin-right:0cm;
377.4pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Чтение и запись в видео память требует использования ДАЛЬНИХ
указателей. Если ваш компилятор не поддерживает дальних указателей, то вы не
имеете прямого доступа к видео памяти. Дальние указатели могут быть
поддерживаемы транслятором Си одним из двух способов. Первый - использование
ключевого слова far, используемого в большинстве компиляторов. Они позволяют
определять указатель, как дальний. Другой способ - использование большой модели
памяти, в которой все указатели по умолчанию дальние. Программы, используемые в
этой главе используют описатель far. Если вы хотите, вы можете просто удалить
его и скомпилировать программу, используя транслятор с большой моделью памяти. 

<p><div align="center"><b><font size="+1"><i><a name="1-14">Определение расположения видео памяти
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Одноцветный адаптер использует для видео памяти адрес
B0000000H, a все остальные - В8000000Н. Для того, чтобы программы с меню
работали правильно с каждым адаптером, они должны знать, какой адаптер имеет
система. К счастью, для этого существует простой способ. Прерывание BIOS 16,
функция 15 возвращает текущий видео режим. Как упоминалось раньше, программы,
разработанные в этой главе, требуют режима 2, 3 или 7. Адаптеры CGA и EGA могут
использовать режим 2 и 3, но не режим 7. Только одноцветный адаптер использует
этот режим. Таким образом, если текущий видео режим 7, то используется
одноцветный адаптер, в остальных случаях это EGA или CGA. Для наших задач, в
текстовом режиме EGA и CGA одинаковы и поэтому все равно, какой из адаптеров у
системы. Таким образом функция popup() должна поверить какой из адаптеров у
системы и присвоить глобальной переменной указатель на соответствующий адрес.
Этот фрагмент программы позволяет сделать это.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>vmode = video_mode();

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if((vmode!=2)
&amp;&amp; (vmode!=3) &amp;&amp; (vmode!=7)) 

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>printf(&quot;
должен быть 80 символьный текстовый режим&quot;);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>exit(1);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* присвоить
соответствующий адрес видео памяти */

<p
none;text-autospace:none'>if(vmode==7)
vid_mem=(char far *)0xB0000000;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>else<span style="mso-spacerun: yes">  
</span>vid_mem=(char far *)0xB8000000;

<p class=MsoNormal style='0cm;margin-right:0cm;266.4pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>Функция
video_mode() возвращает текущий видео режим, и переменную vid_mem, объявленную
везде как char far. 

<p><div align="center"><b><font size="+1"><i><a name="1-15">Изменение save_video() и restore_video()
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Kaк только переменной vid_mem присвоен соответствующий
адрес, появляется простой способ использовать ее для чтения и записи символов в
видео память. Запомните, видео память требует двух байтов для каждого символа,
один для символа, а другой для атрибута. Из-за того, что символьный байт
первый, а атрибутный - второй, то каждой строке экрана требуется 160 байт. Для
того, чтобы определить адрес отдельного символа вы должны использовать формулу:

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'>адрес = адрес_адаптера +
X*160 + Y*2

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Функции save_video() и restore_video() при
использовании прямого доступа к видео памяти выглядят следующим образом.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>void
save_video(startx,endx,starty,endy,buf_ptr)

<p
none;text-autospace:none'>int<span
style="mso-spacerun: yes">   </span>startx,endx,starty,endy;

<p
none;text-autospace:none'>unsigned int *buf_ptr;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i,j;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char far *v, far *t;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=vid_mem;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=starty;i&lt;endy;i++)

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(j=startx;j&lt;endx;j++)


<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>t = v + (j*160) +
i*2;<span style="mso-spacerun: yes">  </span>/* вычисляем адрес */

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;tab-stops:204.5pt;
mso-layout-grid-align:none;text-autospace:none'>*buf_ptr++
= *t++;<span style='mso-tab-count:1'>                              </span>/*
чтение символа */

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;tab-stops:204.5pt;
mso-layout-grid-align:none;text-autospace:none'>*buf_ptr++
= *t;<span style='mso-tab-count:1'>                                  </span>/*
чтение атрибута */

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;tab-stops:204.5pt;
mso-layout-grid-align:none;text-autospace:none'>*(t-1)
= ' ';<span style='mso-tab-count:1'>                                              </span>/*
очистка окна */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* восстановление
части экрана */

<p
none;text-autospace:none'>void
restore_video(startx,endx,starty,endy,buf_ptr)

<p
none;text-autospace:none'>int<span
style="mso-spacerun: yes">   </span>startx,endx,starty,endy;

<p
none;text-autospace:none'>unsigned int *buf_ptr;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i,j;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char far *v, far *t;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=vid_mem;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>t=v;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=starty;i&lt;endy;i++)

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(j=startx;j&lt;endx;j++)


<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v = t;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (j*160) +
i*2;<span style="mso-spacerun: yes">   </span>/* вычисляем адрес */

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ =
*buf_ptr++;<span style="mso-spacerun: yes">    </span>/* запись символа */

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:187.0pt;
mso-layout-grid-align:none;text-autospace:none'>*v
= *buf_ptr++;<span style='mso-tab-count:1'>                            </span>/*
запись атрибута */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>Как вы видете,<span style="mso-spacerun:
yes">  </span>символы и атрибуты записываются или читаются 

<p
none;text-autospace:none'>с<span
style="mso-spacerun: yes">  </span>помощью<span style="mso-spacerun: yes"> 
</span>использования<span style="mso-spacerun: yes">  </span>указателей<span
style="mso-spacerun: yes">  </span>на<span style="mso-spacerun: yes"> 
</span>видео<span style="mso-spacerun: yes">  </span>память.<span
style="mso-spacerun: yes">  </span>Другие

<p
none;text-autospace:none'>функции,<span
style="mso-spacerun: yes">   </span>которые<span style="mso-spacerun: yes"> 
</span>читают<span style="mso-spacerun: yes">  </span>и<span
style="mso-spacerun: yes">  </span>записывают<span style="mso-spacerun: yes"> 
</span>символы<span style="mso-spacerun: yes">  </span>преобразуются

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>подобным образом.

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Если весь доступ к дисплею делать прямым, требуется
одна новая функция (показанная здесь). Функция write_char() записывает один
символ в определенную позицию экрана с определенным атрибутом.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* запись символа с
определенным аттрибутом */

<p
none;text-autospace:none'>void
write_char(x,y,ch,attrib)

<p
none;text-autospace:none'>int x,y;

<p
none;text-autospace:none'>char ch;

<p
none;text-autospace:none'>int attrib;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char far *v;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=vid_mem;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (x*160) +y*2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ = ch; /* запись
символа */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v = attrib; /* запись
атрибута */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Полная версия исчезающих меню с прямым доступом
приведена здесь с тем же простым тестовым примером. Введите его в в свой
компьютер и сравните по производительности с версией, использующей BIOS. Как вы
увидете, разница потрясающая. Кажется, что меню появляются и исчезают
мгновенно.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* Программа
исчезающих меню для текстового режима

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>с использованием
прямого доступа к видео памяти */

<p
none;text-autospace:none'>#include
&quot;stdio.h&quot;

<p
none;text-autospace:none'>#include
&quot;dos.h&quot;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>#include &quot;stdlib.h&quot;

<p
none;text-autospace:none'>#define BORDER 1

<p
none;text-autospace:none'>#define ESC 27

<p
none;text-autospace:none'>#define REV_VID 0x70

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>#define NORM_VID<span style="mso-spacerun:
yes">  </span>7

<p
none;text-autospace:none'>void
save_video(),restore_video();

<p
none;text-autospace:none'>void
goto_xy(),cls(),write_video();

<p
none;text-autospace:none'>void
display_menu(),draw_border();

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char far *vid_mem;

<p
none;text-autospace:none'>char *fruit[] = 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Яблоко&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Апельсин&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Груша&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Грейпфрут&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Малина&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Клубника&quot;

<p
none;text-autospace:none'>char *color[]=

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Красный&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Желтый&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Оранжевый&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Зеленый&quot;

<p
none;text-autospace:none'>;

<p
none;text-autospace:none'>char *apple_type[] = 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Красный
деликатес&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Джонатан&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Белый
налив&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Антоновка&quot;

<p
none;text-autospace:none'>;

<p
none;text-autospace:none'>main()

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>int i;

<p
none;text-autospace:none'>cls();

<p
none;text-autospace:none'>goto_xy(0,0);

<p
none;text-autospace:none'>for(i=0;i&lt;25;i++)

<p
none;text-autospace:none'>printf(&quot;Это тест
исчезающего меню\n&quot;); popup(fruit,&quot;яагрмк&quot;,6,1,3,BORDER);
popup(color,&quot;кжоз&quot;,4,5,10,BORDER);
popup(apple_type,&quot;кдба&quot;,4,10,18,BORDER); 

<p class=MsoNormal style='11.1pt;margin-right:101.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* вывести исчезающее
меню и вернуть выбор

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>возвращает -2, если
меню не может быть создано

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>возвращает -1, если
пользователь нажал клавишу ESC

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>в остальных случаях
она возвращает номер выбранного

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>режима, начиная с 0 */

<p
none;text-autospace:none'>int
popup(menu,keys,count,x,y,border)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>char
*menu[];<span style='mso-tab-count:1'>               </span>/*<span
style='mso-tab-count:1'>    </span>текст меню */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>char
*keys;<span style='mso-tab-count:1'>                   </span>/*<span
style='mso-tab-count:1'>    </span>горячие клавиши */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>int
count;<span style='mso-tab-count:1'>                       </span>/*<span
style='mso-tab-count:1'>    </span>число режимов */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>int
x,y;<span style='mso-tab-count:1'>                            </span>/*<span
style='mso-tab-count:1'>    </span>координаты левого верхнего угла */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:117.5pt 135.5pt;
mso-layout-grid-align:none;text-autospace:none'>int
border;<span style='mso-tab-count:1'>                     </span>/*<span
style='mso-tab-count:1'>    </span>если 0 то без рамки */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i,len;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int endx endy choice;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>unsigned char *p;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if((x&gt;24)||(x&lt;0)||(y&gt;79)||(y&lt;0))


<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(&quot; выход за
пределы экрана&quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return -2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* вычисление размеров
*/

<p
none;text-autospace:none'>len=0;

<p
none;text-autospace:none'>for(i=0;i&lt;count;i++)

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if(strlen(menu[i])
&gt; len) len=strlen(menu[i]);

<p
none;text-autospace:none'>endy=len+2+y;

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>endx=count+1+x; 

<p
none;text-autospace:none'>if((endx+1&gt;24) ||
(endy+1&gt;79)) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(&quot; выход за
пределы экрана&quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return -2;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>vmode = video_mode();

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if((vmode!=2)
&amp;&amp; (vmode!=3) &amp;&amp; (vmode!=7)) 

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>printf(&quot;
должен быть 80 символьный текстовый режим&quot;);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>exit(1);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* присвоить
соответствующий адрес видео памяти */

<p
none;text-autospace:none'>if(vmode==7)
vid_mem=(char far *)0xB0000000;

<p
none;text-autospace:none'>else<span
style="mso-spacerun: yes">   </span>vid_mem=(char far *)0xB8000000;

<p
none;text-autospace:none'>/* размещение памяти
для видео буфера */

<p
none;text-autospace:none'>p=(unsigned int
*)malloc((endx-x+1)*(endy-y+1));

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>if(!p) exit(1); /* Вы можете здесь сами
обработать ошибку */

<p
none;text-autospace:none'>/* сохранение части
экрана */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>void save_video(x,endx+1,y,endy+1,p);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>if(border) draw_border(x,y,endx,endy);

<p
none;text-autospace:none'>/* высвечивание меню
на своем месте */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>void display_menu(menu,x,y,count);

<p
none;text-autospace:none'>/* ввести выбор
пользователя */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>choice=get_resp(x,y,count,menu,keys)

<p
none;text-autospace:none'>/* восстановление
части экрана */

<p
none;text-autospace:none'>void
restore_video(x,endx+1,y,endy+1,p);

<p
none;text-autospace:none'>free(p);

<p
none;text-autospace:none'>return choice;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* высвечивание меню
на своем месте */

<p
none;text-autospace:none'>void
display_menu(menu,x,y,count)

<p
none;text-autospace:none'>char *menu[];

<p
none;text-autospace:none'>int x,y,count;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>register int i;

<p
none;text-autospace:none'>for(i=0;i&lt;count;i++,x++)


<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>write_string(x,y,menu[i],NORM_VID);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>void
draw_border(startx,starty,endx,endy)

<p
none;text-autospace:none'>int<span
style="mso-spacerun: yes">  </span><span style="mso-spacerun:
yes"> </span>startx,starty,endx,endy;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char far *v,far *t;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=vid_mem;

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>t=v; 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=startx+1;i&lt;endx;i++)


<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (i*160) +
starty*2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ = 179;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=t;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (i*160) + endy*2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ = 179;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=t;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=starty+1;i&lt;endy;i++)


<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (startx*160) +
i*2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ = 196;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=t;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (endx*160) + i*2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ = 196;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=t;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>write_char(startx,starty,218,NORM_VID);

<p
none;text-autospace:none'>write_char(startx,endy<span
style="mso-spacerun: yes">  </span>,191,NORM_VID);

<p
none;text-autospace:none'>write_char(endx<span
style="mso-spacerun: yes">  </span>,starty,192,NORM_VID);

<p
none;text-autospace:none'>write_char(endx<span
style="mso-spacerun: yes">  </span>,endy<span style="mso-spacerun: yes"> 
</span>,217,NORM_VID);

<p
none;text-autospace:none'>goto_xy(startx,endy<span
style="mso-spacerun: yes">  </span>); putchar(191);

<p
none;text-autospace:none'>goto_xy(endx<span
style="mso-spacerun: yes">  </span>,starty); putchar(192);

<p
none;text-autospace:none'>goto_xy(endx<span
style="mso-spacerun: yes">  </span>,endy<span style="mso-spacerun: yes"> 
</span>); putchar(217);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* ввести выбор
пользователя */

<p
none;text-autospace:none'>get_resp(x,y,count,menu,keys)

<p
none;text-autospace:none'>int x,y,count;

<p
none;text-autospace:none'>char *menu[];

<p
none;text-autospace:none'>char *keys;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>union inkey 

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>char ch[2];

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int i;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span
style="mso-spacerun: yes"> </span>c;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>int arrow_choice=0,key_choice;

<p
none;text-autospace:none'>y++;

<p
none;text-autospace:none'>/* осветить первый
выбор */

<p
none;text-autospace:none'>goto_xy(x,y);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>write_string(x,y,menu[0],REV_VID);

<p
none;text-autospace:none'>for(;;) 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>while(!bioskey(1)); /*
ждать нажатия */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>c.i=bioskey(0);

<p
none;text-autospace:none'>/* вернуть выбор в
номальный режим */

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>goto_xy(arrow_choice,y); 

<p
none;text-autospace:none'>write_string(x+arrow_choice,y,

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>menu[arrow_choice],norm_vid);

<p
none;text-autospace:none'>if(c.ch[0])<span
style="mso-spacerun: yes">  </span>/* обычная клавиша */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>key_choice=
is_in(keys,tolower(c.ch[0]));

<p
none;text-autospace:none'>if(key_choice) return
key_choice-1;

<p
none;text-autospace:none'>switch(c.ch[0]) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case '\r' : return
arrow_choice;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case ' '<span
style="mso-spacerun: yes">  </span>: arrow_choice++;

<p class=MsoNormal style='margin-left:104.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>break;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case ESC<span
style="mso-spacerun: yes">   </span>: return -1; /* выйти */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>else<span
style="mso-spacerun: yes">  </span>/* специальная клавиша */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>switch(c.ch[1]) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 72 :
arrow_choice--; /* стрелка вниз */

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>break;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 80 :
arrow_choice++; /* стрелка вверх */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>break;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>if(arrow_choice==count)
arrow_choice=0;

<p
none;text-autospace:none'>if(arrow_choice&lt;0)
arrow_choice=count-1;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* подсветить
выбранную опцию */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>goto_xy(x+arrow_choice,y);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>write_string(x+arrow_choice,y,menu[arrow_choice],REV_VID);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* вывод строки с
определенным атрибутом */

<p
none;text-autospace:none'>void
write_string(x,y,p,attrib)

<p
none;text-autospace:none'>int x,y;

<p
none;text-autospace:none'>char *p;

<p
none;text-autospace:none'>int attrib;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i,j;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char far *v;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=vid_mem;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (x*160) + y*2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=y; *p; i++) 

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ =*p++; /* запись
символа */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ =attrib; /*
запись атрибута */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* запись символа с
определенным аттрибутом */

<p
none;text-autospace:none'>void
write_char(x,y,ch,attrib)

<p
none;text-autospace:none'>int x,y;

<p
none;text-autospace:none'>char ch;

<p
none;text-autospace:none'>int attrib;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i;

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char far *v; 


<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=vid_mem;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (x*160) +y*2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ = ch; /* запись
символа */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v = attrib; /* запись
атрибута */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* сохранение части
экрана с использованием

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>прямого доступа к
видео памяти */

<p
none;text-autospace:none'>void
save_video(startx,endx,starty,endy,buf_ptr)

<p
none;text-autospace:none'>int<span
style="mso-spacerun: yes">   </span>startx,endx,starty,endy;

<p
none;text-autospace:none'>unsigned int *buf_ptr;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i,j;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char far *v, far *t;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=vid_mem;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=starty;i&lt;endy;i++)

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(j=startx;j&lt;endx;j++)


<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>t = v + (j*160) +
i*2;<span style="mso-spacerun: yes">  </span>/* вычисляем адрес */

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;tab-stops:204.5pt;
mso-layout-grid-align:none;text-autospace:none'>*buf_ptr++
= *t++;<span style='mso-tab-count:1'>                              </span>/*
чтение символа */

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;tab-stops:204.5pt;
mso-layout-grid-align:none;text-autospace:none'>*buf_ptr++
= *t;<span style='mso-tab-count:1'>                                  </span>/*
чтение атрибута */

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;tab-stops:204.5pt;
mso-layout-grid-align:none;text-autospace:none'>*(t-1)
= ' ';<span style='mso-tab-count:1'>                                              </span>/*
очистка окна */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* восстановление
части экрана с использованием

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>прямого доступа к
видео памяти */

<p
none;text-autospace:none'>void
restore_video(startx,endx,starty,endy,buf_ptr)

<p
none;text-autospace:none'>int<span
style="mso-spacerun: yes">   </span>startx,endx,starty,endy;

<p
none;text-autospace:none'>unsigned int *buf_ptr;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i,j;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char far *v, far *t;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=vid_mem;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>t=v;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=starty;i&lt;endy;i++)

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(j=startx;j&lt;endx;j++)


<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v = t;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (j*160) +
i*2;<span style="mso-spacerun: yes">   </span>/* вычисляем адрес */

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ =
*buf_ptr++;<span style="mso-spacerun: yes">    </span>/* запись символа */

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:187.0pt;
mso-layout-grid-align:none;text-autospace:none'>*v
= *buf_ptr++;<span style='mso-tab-count:1'>                            </span>/*
запись атрибута */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* очистка экрана */

<p
none;text-autospace:none'>void cls()

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>union REGS r;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.ah=6; /* код
прокрутки экрана */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.al=0; /* код
очистки экрана */

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>r.h.ch=0; /* начальная строка */ 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.cl=0; /* начальная
колонка */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.dh=24; /* конечная
строка */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.dl=79; /* конечная
колонка */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.bh=7; /* очистка
пустой строки */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int86(0x10,&amp;r,&amp;r);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* установка курсора в
x,y */

<p
none;text-autospace:none'>void goto_xy(x,y)

<p
none;text-autospace:none'>int x,y;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>union REGS r;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.ah=2; /* функция
установки курсора */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.dl=y; /*
координата колонки<span style="mso-spacerun: yes">       </span>*/

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.dh=x; /*
координата строки<span style="mso-spacerun: yes">        </span>*/

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.bh=0; /* видео
страница<span style="mso-spacerun: yes">           </span>*/

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int86(0x10,&amp;r,&amp;r);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/*<span
style="mso-spacerun: yes">  </span>запрос текущего видео режима */

<p
none;text-autospace:none'>video_mode()

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>union REGS r;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.ah = 15;<span
style="mso-spacerun: yes">   </span>/* получить режим */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return
int86(0x10,&amp;r,&amp;r) &amp; 255;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>is_in(s,c)

<p
none;text-autospace:none'>char *s,c;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>register int i;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=0; *s; i++)

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if(*s++ == c) return
i+1;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return 0;
<p><div align="center"><b><font size="+1"><i><a name="1-16">Создание иерархических окон
</a></i></font></b></div></p>


<p class=MsoNormal style='0cm;margin-right:0cm;444.0pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>Иерархические
окна фундаментально отличаются от простых исчезающих меню тем, что два или
более исчезающих меню могут быть активными одновременно. Вообще иерархические
меню позволяют пользователю выбирать режимы непосредственно из режимов и
используются для поддержки системы меню. В отличие от функции popup(), которая
сохраняет экран, высвечивает меню, и восстанавливает экран, функция pulldown(),
разработанная в этом разделе только сохраняет экран (если это нужно),
высвечивает меню и возвращает выбор пользователя. Восстановление экрана
обрабатывается как отдельная задача в любом месте программы. Перед тем как вы
сможете создать иерархическое меню, вы должны изменить свое представление о
меню. 
<p><div align="center"><b><font size="+1"><i><a name="1-17">Фреймы меню 
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:247.0pt 325.0pt;
mso-layout-grid-align:none;text-autospace:none'>Центральным
понятием<span style="mso-spacerun: yes">    </span>для<span style='mso-tab-count:
1'>                               </span>создания<span style='mso-tab-count:
1'>                  </span>иерархического,

<p
none;text-autospace:none'>многоуровневого меню
является фрейм меню.<span style="mso-spacerun: yes">  </span>В сущности,<span
style="mso-spacerun: yes">  </span>программы

<p
none;text-autospace:none'>иерархических меню
требуют чтобы каждое<span style="mso-spacerun: yes">  </span>меню<span
style="mso-spacerun: yes">  </span>имело<span style="mso-spacerun: yes"> 
</span>свой<span style="mso-spacerun: yes">  </span>фрейм

<p
none;text-autospace:none'>ссылок,<span
style="mso-spacerun: yes">  </span>определенных до того,<span
style="mso-spacerun: yes">  </span>как программа,<span style="mso-spacerun:
yes">  </span>которая испольует

<p
none;text-autospace:none'>меню, начала
выполняться.<span style="mso-spacerun: yes">  </span>Каждое меню
активизируется<span style="mso-spacerun: yes">  </span>по<span
style="mso-spacerun: yes">  </span>номеру

<p
none;text-autospace:none'>его<span
style="mso-spacerun: yes">   </span>фрейма<span style="mso-spacerun: yes">  
</span>и<span style="mso-spacerun: yes">   </span>необходимая<span
style="mso-spacerun: yes">  </span>информация<span style="mso-spacerun: yes"> 
</span>загружается<span style="mso-spacerun: yes">  </span>по<span
style="mso-spacerun: yes">  </span>мере

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>необходимости для различных функций,
поддерживающих меню.

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Лучший способ для поддержки фреймов меню - создать
массив структур, которые содержат информацию, относящуюся к меню. Эта структура
определяется так, как описано здесь:

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>struct menu_frame 

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int
startx,endx,starty,endy;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;tab-stops:152.0pt 170.0pt;
mso-layout-grid-align:none;text-autospace:none'>unsigned
char *p;<span style='mso-tab-count:1'>                </span>/*<span
style='mso-tab-count:1'>    </span>указатель на информацию экрана */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;tab-stops:152.0pt 170.0pt;
mso-layout-grid-align:none;text-autospace:none'>char
**menu;<span style='mso-tab-count:1'>                        </span>/*<span
style='mso-tab-count:1'>    </span>указатель на строки меню */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;tab-stops:152.0pt 170.0pt;
mso-layout-grid-align:none;text-autospace:none'>int
border;<span style='mso-tab-count:1'>                             </span>/*<span
style='mso-tab-count:1'>    </span>рамка включено/выключено */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;tab-stops:152.0pt 170.0pt;
mso-layout-grid-align:none;text-autospace:none'>int
count;<span style='mso-tab-count:1'>                               </span>/*<span
style='mso-tab-count:1'>    </span>число альтернатив */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;tab-stops:152.0pt 170.0pt;
mso-layout-grid-align:none;text-autospace:none'>int
astive;<span style='mso-tab-count:1'>                              </span>/*<span
style='mso-tab-count:1'>    </span>активно ли меню сейчас */

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span
style="mso-spacerun: yes"> </span>frame[MAX_FRAME];

<p
none;text-autospace:none'>где МAX_FRAME -
макроконстанта, которая определяет как много меню

<p
none;text-autospace:none'>вы можете иметь.<span
style="mso-spacerun: yes">  </span>Только одна дополнительная информация
требуется

<p
none;text-autospace:none'>для<span
style="mso-spacerun: yes">  </span>иерархических<span style="mso-spacerun:
yes">  </span>меню,<span style="mso-spacerun: yes">  </span>которая не нужна
для исчезающих меню -

<p
none;text-autospace:none'>флаг активности.<span
style="mso-spacerun: yes">  </span>Флаг используется в качестве сигнала,<span
style="mso-spacerun: yes">  </span>что меню

<p
none;text-autospace:none'>уже<span
style="mso-spacerun: yes">  </span>на<span style="mso-spacerun: yes"> 
</span>экране<span style="mso-spacerun: yes">  </span>и<span
style="mso-spacerun: yes">  </span>предупреждает<span style="mso-spacerun:
yes">  </span>перезаписывание<span style="mso-spacerun: yes"> 
</span>информации<span style="mso-spacerun: yes">  </span>с

<p class=MsoNormal style='0cm;margin-right:0cm;288.6pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>экрана. 
<p><div align="center"><b><font size="+1"><i><a name="1-18">Создание фрейма меню
</a></i></font></b></div></p>


<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Перед использованием меню для этого должен быть создан
фрейм. Функция make_menu(), показанная здесь, создает фрейм меню.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* создание фрейма
иерархического меню.

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>1 если фрейм может
быть создан

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:27.5pt;.0001pt;text-indent:22.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>в противном случае 0 */ make_menu(num,menu,keys,count,x,y,border) int
num;<span style="mso-spacerun: yes">  </span><span style="mso-spacerun:
yes"> </span>/* номер меню */ char *menu;<span style="mso-spacerun: yes">  
</span>/* текст меню */ char *keys;<span style="mso-spacerun: yes">   </span>/*
горячие клавиши */ int count;<span style="mso-spacerun: yes">    </span>/*
число альтернатив */ int x,y;<span style="mso-spacerun: yes">      </span>/*
левый верхний угол */ int border;<span style="mso-spacerun: yes">   </span>/*
рамка */

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i,len;

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int
endx,endy,choice,vmode;

<p class=MsoNormal style='0cm;margin-right:145.2pt;
11.1pt;margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'>unsigned char *p;

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if(num&gt;MAX_FRAME) 

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(&quot;Слишком
много меню&quot;);

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return 0;

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if((x&gt;24)||(x&lt;0)||(y&gt;79)||(y&lt;0))


<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(&quot; выход за
пределы экрана&quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return 0;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* вычисление размеров
*/

<p
none;text-autospace:none'>len=0;

<p
none;text-autospace:none'>for(i=0;i&lt;count;i++)

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if(strlen(menu[i])
&gt; len) len=strlen(menu[i]);

<p
none;text-autospace:none'>endy=len+2+y;

<p
none;text-autospace:none'>endx=count+1+x;

<p
none;text-autospace:none'>if((endx+1&gt;24) ||
(endy+1&gt;79)) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(&quot; выход за
пределы экрана&quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return 0;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* размещение памяти
для видео буфера */

<p
none;text-autospace:none'>p=(unsigned int
*)malloc((endx-x+1)*(endy-y+1));

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>if(!p) exit(1); /* Вы можете здесь сами
обработать ошибку */

<p
none;text-autospace:none'>/* создание фрейма */

<p
none;text-autospace:none'>frame[num].startx=x;

<p
none;text-autospace:none'>frame[num].endx=endx;

<p
none;text-autospace:none'>frame[num].starty=y;

<p
none;text-autospace:none'>frame[num].endy=endy;

<p
none;text-autospace:none'>frame[num].p = p;

<p
none;text-autospace:none'>frame[num].menu =
(char **) menu;

<p
none;text-autospace:none'>frame[num].border =
border;

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>frame[num].keys = keys; 

<p
none;text-autospace:none'>frame[num].count =
count;

<p
none;text-autospace:none'>frame[num].active =0;

<p
none;text-autospace:none'>return 1;

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;510.6pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>Вы
вызываете make_menu с теми же аргументами, какие используются в popup() кроме
номера меню, который должен быть определен в первом аргументе. Этот номер
используется для идентификации меню. 
<p><div align="center"><b><font size="+1"><i><a name="1-19">Функция pulldown()
</a></i></font></b></div></p>


<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>Функция pulldown() показана здесь:

<p
none;text-autospace:none'>/* Высветить меню и
получить выбор

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>возвращает -1, если
пользователь нажал клавишу ESC

<p class=MsoNormal align=center style='11.1pt;text-align:center;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>в остальных случаях номер альтернативы, начиная с 0 */

<p
none;text-autospace:none'>int pulldown(num)

<p
none;text-autospace:none'>int num; /* номер
фрейма */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>int vmode,choice;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>vmode=video_mode();

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if((vmode!=2)
&amp;&amp; (vmode!=3) &amp;&amp; (vmode!=7)) 

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>printf(&quot;
должен быть 80 символьный текстовый режим&quot;);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>exit(1);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* присвоить
соответствующий адрес видео памяти */

<p
none;text-autospace:none'>if(vmode==7)
vid_mem=(char far *)0xB0000000;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>else<span style="mso-spacerun: yes">  
</span>vid_mem=(char far *)0xB8000000;

<p
none;text-autospace:none'>/* узнать активность
окна */

<p
none;text-autospace:none'>if(!frame[num].active)<span
style="mso-spacerun: yes">  </span>/* не активно */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>save_video(num);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>frame[num].active= 1;
/* установить признак активности */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>if( frame[num].border) draw_worder(num);

<p
none;text-autospace:none'>display_menu(num);<span
style="mso-spacerun: yes">  </span>/* высветить меню */

<p
none;text-autospace:none'>return
get_resp(num);<span style="mso-spacerun: yes">  </span>/* возвратить выбор */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Для использования pulldown() просто передайте номер
того меню, которое вы хотите высветить. Однако вы должны помнить о
восстановлении окна, используя restore_video() везде в своей программе.
Запомните, что основное отличие иерархических меню в том, что они позволяют
двум или более меню оставаться на экране одновременно и быть потенциально
активными, по мере того как пользователь выбирает опции. Тем не менее вам не
следует восстанавливать экран до того, как процесс выбора полностью завершен.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
33.3pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Обратите внимание, что часть экрана, используемая для меню, сохраняется
только если признак активности равен 0. Так как иерархическое меню может быть
вызвано повторно, экран не должен сохраняться много раз. (Другими словами при
повторном вхождении будет сохранено само меню, записанное поверх
первоначального содержимого экрана, которое уже сохранено.) 

<p><div align="center"><b><font size="+1"><i><a name="1-20">Восстановление экрана 
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Как и другие функции поддержки меню, измененная
restore_video показанная здесь, преобразована для работы с фреймами. Поэтому
функции restore_video() теперь передается только номер меню, что делает
интерфейс более очевидным.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* восстановление
части экрана */

<p
none;text-autospace:none'>void restore_video(num)

<p
none;text-autospace:none'>int<span
style="mso-spacerun: yes">   </span>num;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i,j;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>char far *v, far *t;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char *buf_ptr;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>buf_ptr=frame[num].p;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=vid_mem;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>t=v;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=frame[num].starty;i&lt;frame[num].endy;i++)

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(j=frame[num].startx;j&lt;frame[num].endx;j++)


<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v = t;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (j*160) +
i*2;<span style="mso-spacerun: yes">   </span>/* вычисляем адрес */

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ =
*buf_ptr++;<span style="mso-spacerun: yes">    </span>/* запись символа */

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:187.0pt;
mso-layout-grid-align:none;text-autospace:none'>*v
= *buf_ptr++;<span style='mso-tab-count:1'>                            </span>/*
запись атрибута */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>frame[num].active= 0;
<p><div align="center"><b><font size="+1"><i><a name="1-21">Простая программа, использующая процедуру pulldown 
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Все функции для иерархических меню показаны здесь
вместе с простой программой-образцом и их можно прямо вводить в ваш компьютер.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* процедура
иерархического меню для текстового режима

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>и простая
программа-пример */

<p
none;text-autospace:none'>#include
&quot;stdio.h&quot;

<p
none;text-autospace:none'>#include
&quot;dos.h&quot;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>#include &quot;stdlib.h&quot;

<p
none;text-autospace:none'>#define BORDER 1

<p
none;text-autospace:none'>#define ESC 27

<p
none;text-autospace:none'>#define REV_VID 0x70

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>#define NORM_VID<span style="mso-spacerun:
yes">  </span>7

<p
none;text-autospace:none'>void
save_video(),restore_video();

<p
none;text-autospace:none'>void
goto_xy(),cls(),write_video();

<p
none;text-autospace:none'>void
display_menu(),draw_border();

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char far *vid_mem;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>struct menu_frame 

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int
startx,endx,starty,endy;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;tab-stops:152.0pt 170.0pt;
mso-layout-grid-align:none;text-autospace:none'>unsigned
char *p;<span style='mso-tab-count:1'>                </span>/*<span
style='mso-tab-count:1'>    </span>указатель на информацию экрана */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;tab-stops:152.0pt 170.0pt;
mso-layout-grid-align:none;text-autospace:none'>char
**menu;<span style='mso-tab-count:1'>                        </span>/*<span
style='mso-tab-count:1'>    </span>указатель на строки меню */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;tab-stops:152.0pt 170.0pt;
mso-layout-grid-align:none;text-autospace:none'>int
border;<span style='mso-tab-count:1'>                             </span>/*<span
style='mso-tab-count:1'>    </span>рамка включено/выключено */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;tab-stops:152.0pt 170.0pt;
mso-layout-grid-align:none;text-autospace:none'>int
count;<span style='mso-tab-count:1'>                               </span>/*<span
style='mso-tab-count:1'>    </span>число альтернатив */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;tab-stops:152.0pt 170.0pt;
mso-layout-grid-align:none;text-autospace:none'>int
astive;<span style='mso-tab-count:1'>                              </span>/*<span
style='mso-tab-count:1'>    </span>активно ли меню сейчас */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span
style="mso-spacerun: yes"> </span>frame[MAX_FRAME];

<p
none;text-autospace:none'>char *fruit[] = 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Яблоко&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Апельсин&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Груша&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;гРейпфрут&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Малина&quot;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Клубника&quot;

<p
none;text-autospace:none'>;

<p
none;text-autospace:none'>char *color[]=

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Красный&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Желтый&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Оранжевый&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Зеленый&quot;

<p
none;text-autospace:none'>;

<p
none;text-autospace:none'>char *apple_type[] = 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;tab-stops:189.0pt;
mso-layout-grid-align:none;text-autospace:none'>&quot;Красный
деликатес&quot;,<span style='mso-tab-count:1'>                             </span>?

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Джонатан&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Белый
налив&quot;,

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Aнтоновка&quot;

<p
none;text-autospace:none'>char *grape_type[]= 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Конкорд&quot;,

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;кАнадский&quot;,

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;Томпсон&quot;,

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>&quot;кРасное
пламя&quot;

<p
none;text-autospace:none'>;

<p
none;text-autospace:none'>main()

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>int i;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>cls();

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>goto_xy(0,0);

<p
none;text-autospace:none'>/* во-первых создадим
фреймы меню */

<p
none;text-autospace:none'>make_menu(0,fruit,&quot;яагрмк&quot;,6,5,20,BORDER);

<p
none;text-autospace:none'>make_menu(1,color,&quot;кжоз&quot;,4,9,28,BORDER);

<p
none;text-autospace:none'>make_menu(2,apple_type,&quot;кдба&quot;,4,12,32,BORDER);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>make_menu(3,grape_type,&quot;катр&quot;,4,9,10,BORDER);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>printf(&quot;Выберите фрукт:&quot;);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>pd_driver(); /* запуск системы меню */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>void pd_driver()

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>int choice1,choice2,selection;

<p class=MsoNormal style='margin-left:27.5pt;text-indent:5.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>/* активизация окон по мере надобности */ while((choice1=pulldown(0))
!= -1) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>switch ( choice1 ) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 0 :<span
style="mso-spacerun: yes">  </span>/* яблоко */

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>while((choice2=pulldown(1))
!= -1) 

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if(choice2 ==0)
selection=pulldown(2);/*красное яблоко */

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>restore_video(2);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>restore_video(1);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>break;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 1 :

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 2 : goto_xy(1,0);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(&quot;неправильный
выбор&quot;);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>break;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 3 : /* грейпфрут
*/

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>selection=pulldown(3);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>restore_video(3);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>break;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 4 :

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 5 : goto_xy(1,0);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(&quot;неправильный
выбор&quot;);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>break;

<p class=MsoNormal style='margin-left:27.5pt;text-indent:5.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>restore_video(0);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>/* Высветить меню и получить выбор */

<p
none;text-autospace:none'>int pulldown(num)

<p
none;text-autospace:none'>int num; /* номер
фрейма */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>int vmode,choice;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>vmode=video_mode();

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if((vmode!=2)
&amp;&amp; (vmode!=3) &amp;&amp; (vmode!=7)) 

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>printf(&quot;
должен быть 80 символьный текстовый режим&quot;);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>exit(1);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* присвоить
соответствующий адрес видео памяти */

<p
none;text-autospace:none'>if(vmode==7)
vid_mem=(char far *)0xB0000000;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>else<span style="mso-spacerun: yes">  
</span>vid_mem=(char far *)0xB8000000;

<p
none;text-autospace:none'>/* узнать активнсть
окна */

<p
none;text-autospace:none'>if(!frame[num].active)<span
style="mso-spacerun: yes">  </span>/* не активно */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>save_video(num);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>frame[num].active= 1;
/* установить признак активности */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>if( frame[num].border) draw_worder(num);

<p
none;text-autospace:none'>display_menu(num);<span
style="mso-spacerun: yes">  </span>/* высветить меню */

<p
none;text-autospace:none'>return
get_resp(num);<span style="mso-spacerun: yes">  </span>/* возвратить выбор */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* создание фрейма
иерархического меню.

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>1 если фрейм может
быть создан

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:27.5pt;.0001pt;text-indent:22.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>в противном случае 0 */ make_menu(num,menu,keys,count,x,y,border) int
num;<span style="mso-spacerun: yes">   </span>/* номер меню */ char *menu;<span
style="mso-spacerun: yes">   </span>/* текст меню */ char *keys;<span
style="mso-spacerun: yes">   </span>/* горячие клавиши */ int count;<span
style="mso-spacerun: yes">    </span>/* число альтернатив */ int x,y;<span
style="mso-spacerun: yes">      </span>/* левый верхний угол */ int border;<span
style="mso-spacerun: yes">   </span>/* рамка */

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i,len;

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int
endx,endy,choice,vmode;

<p class=MsoNormal style='0cm;margin-right:145.2pt;
11.1pt;margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'>unsigned char *p;

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if(num&gt;MAX_FRAME) 

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(&quot;Слишком
много меню&quot;);

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return 0;

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if((x&gt;24)||(x&lt;0)||(y&gt;79)||(y&lt;0))


<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>printf(&quot; выход за пределы
экрана&quot;); 


<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return 0;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* вычисление размеров
*/

<p
none;text-autospace:none'>len=0;

<p
none;text-autospace:none'>for(i=0;i&lt;count;i++)

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if(strlen(menu[i])
&gt; len) len=strlen(menu[i]);

<p
none;text-autospace:none'>endy=len+2+y;

<p
none;text-autospace:none'>endx=count+1+x;

<p
none;text-autospace:none'>if((endx+1&gt;24) ||
(endy+1&gt;79)) 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>printf(&quot; выход за
пределы экрана&quot;);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return 0;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* размещение памяти
для видео буфера */

<p
none;text-autospace:none'>p=(unsigned int
*)malloc((endx-x+1)*(endy-y+1));

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>if(!p) exit(1); /* Вы можете здесь сами
обработать ошибку */

<p
none;text-autospace:none'>/* создание фрейма */

<p
none;text-autospace:none'>frame[num].startx=x;

<p
none;text-autospace:none'>frame[num].endx=endx;

<p
none;text-autospace:none'>frame[num].starty=y;

<p
none;text-autospace:none'>frame[num].endy=endy;

<p
none;text-autospace:none'>frame[num].p = p;

<p
none;text-autospace:none'>frame[num].menu =
(char **) menu;

<p
none;text-autospace:none'>frame[num].border =
border;

<p
none;text-autospace:none'>frame[num].keys =
keys;

<p
none;text-autospace:none'>frame[num].count =
count;

<p
none;text-autospace:none'>frame[num].active =0;

<p
none;text-autospace:none'>return 1;

<p class=MsoNormal style='0cm;margin-right:145.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* высвечивание меню
на своем месте */

<p
none;text-autospace:none'>void display_menu(num)

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int num;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>char **m;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>register int i, x;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>x =
frame[num].startx+1;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>m = frame[num].menu;

<p
none;text-autospace:none'>for(i=0;i&lt;frame[num].count;i++,x++)


<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>write_string(x,frame[num].starty+1,m[i],NORM_VID);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>void draw_border(num)

<p
none;text-autospace:none'>int<span
style="mso-spacerun: yes">  </span>num ;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char far *v,far *t;

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>v=vid_mem; 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>t=v;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=frame[num].startx+1;i&lt;frame[num].endx;i++)


<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (i*160) +
frame[num].starty*2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ = 179;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=t;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (i*160) +
frame[num].endy*2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ = 179;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=t;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=frame[num].starty+1;i&lt;frame[num].endy;i++)


<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v +=
(frame[num].startx*160) + i*2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ = 196;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=t;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v +=
(frame[num].endx*160) + i*2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ = 196;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=t;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>write_char(frame[num].startx,frame[num].starty,218,NORM_VID);

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>write_char(frame[num].startx,frame[num].endy<span
style="mso-spacerun: yes">  </span>,191,NORM_VID);

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>write_char(frame[num].endx<span
style="mso-spacerun: yes">  </span>,frame[num].starty,192,NORM_VID);

<p
none;text-autospace:none'>write_char(frame[num].endx<span
style="mso-spacerun: yes">  </span>,frame[num].endy<span style="mso-spacerun:
yes">  </span>,217,NORM_VID);

<p
none;text-autospace:none'>goto_xy(frame[num].startx,frame[num].endy<span
style="mso-spacerun: yes">  </span>); putchar(191);

<p
none;text-autospace:none'>goto_xy(frame[num].endx<span
style="mso-spacerun: yes">  </span>,frame[num].starty); putchar(192);

<p
none;text-autospace:none'>goto_xy(frame[num].endx<span
style="mso-spacerun: yes">  </span>,frame[num].endy<span style="mso-spacerun:
yes">  </span>); putchar(217);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* ввести выбор
пользователя */

<p
none;text-autospace:none'>get_resp(num)

<p
none;text-autospace:none'>int num;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>union inkey 

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>char ch[2];

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int i;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span
style="mso-spacerun: yes"> </span>c;

<p
none;text-autospace:none'>int
arrow_choice=0,key_choice;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>int x,y;

<p
none;text-autospace:none'>x=frame[num].startx+1;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>y=frame[num].starty+1;

<p
none;text-autospace:none'>/* осветить первый
выбор */

<p
none;text-autospace:none'>goto_xy(x,y);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>write_string(x,y,frame[num].menu[0],REV_VID);

<p
none;text-autospace:none'>for(;;) 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>while(!bioskey(1)); /*
ждать нажатия */

<p class=MsoNormal style='0cm;margin-right:0cm;33.3pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>c.i=bioskey(0); 

<p
none;text-autospace:none'>/* вернуть выбор в
номальный режим */

<p
none;text-autospace:none'>goto_xy(arrow_choice,y);

<p
none;text-autospace:none'>write_string(x+arrow_choice,y,

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>frame[num].menu[arrow_choice],norm_vid);

<p
none;text-autospace:none'>if(c.ch[0])<span
style="mso-spacerun: yes">  </span>/* обычная клавиша */

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:27.5pt;.0001pt;text-indent:5.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>key_choice= is_in(frame[num].keys,tolower(c.ch[0])); if(key_choice)
return key_choice-1; switch(c.ch[0]) 

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case '\r' : return
arrow_choice;

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case ' '<span
style="mso-spacerun: yes">  </span>: arrow_choice++;

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:104.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>break;

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case ESC<span
style="mso-spacerun: yes">   </span>: return -1; /* выйти */

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:27.5pt;.0001pt;text-indent:5.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>else<span
style="mso-spacerun: yes">  </span>/* специальная клавиша */

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>switch(c.ch[1]) 

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 72 :
arrow_choice--; /* стрелка вниз */

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:93.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>break;

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>case 80 :
arrow_choice++; /* стрелка вверх */

<p class=MsoNormal style='0cm;margin-right:61.6pt;
11.1pt;margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'>break;

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if(arrow_choice==frame[num].count)
arrow_choice=0;

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if(arrow_choice&lt;0)
arrow_choice=frame[num].count-1;

<p class=MsoNormal style='0cm;margin-right:61.6pt;
0cm;margin-left:33.0pt;.0001pt;text-indent:16.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>/* подсветить выбранную опцию */ goto_xy(x+arrow_choice,y);
write_string(x+arrow_choice,y,

<p
none;text-autospace:none'>frame[num].menu[arrow_choice],REV_VID);


<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* вывод строки с
определенным атрибутом */

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>void
write_string(x,y,p,attrib)

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int x,y;

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>char *p;

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int attrib;

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i,j;

<p class=MsoNormal style='0cm;margin-right:44.0pt;
11.1pt;margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'>char far *v;

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=vid_mem;

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (x*160) + y*2;

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=y; *p; i++) 

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ =*p++; /* запись
символа */

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ =attrib; /*
запись атрибута */

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>/* запись символа с
определенным аттрибутом */

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>void
write_char(x,y,ch,attrib)

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int x,y;

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>char ch;

<p class=MsoNormal style='0cm;margin-right:44.0pt;
22.2pt;margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'>int attrib; 

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char far *v;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=vid_mem;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (x*160) +y*2;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ = ch; /* запись
символа */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v = attrib; /* запись
атрибута */

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* сохранение части
экрана с использованием

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>прямого доступа к
видео памяти */

<p
none;text-autospace:none'>void save_video(num)

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int num;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i,j;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>char far *v, far *t;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char *buf_ptr;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>buf_ptr=frame[num].p;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=vid_mem;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=frame[num].starty;i&lt;frame[num].endy;i++)

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(j=frame[num].startx;j&lt;frame[num].endx;j++)


<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>t
= (v + (j*160) + i*2);<span style="mso-spacerun: yes">  </span>/* вычисляем
адрес */

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;tab-stops:204.5pt;
mso-layout-grid-align:none;text-autospace:none'>*buf_ptr++
= *t++;<span style='mso-tab-count:1'>                              </span>/*
чтение символа */

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;tab-stops:204.5pt;
mso-layout-grid-align:none;text-autospace:none'>*buf_ptr++
= *t;<span style='mso-tab-count:1'>                                  </span>/*
чтение атрибута */

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;tab-stops:204.5pt;
mso-layout-grid-align:none;text-autospace:none'>*(t-1)
= ' ';<span style='mso-tab-count:1'>                                              </span>/*
очистка окна */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* восстановление
части экрана */

<p
none;text-autospace:none'>void
restore_video(num)

<p
none;text-autospace:none'>int<span
style="mso-spacerun: yes">   </span>num;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>register int i,j;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>char far *v, far *t;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>char *buf_ptr;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>buf_ptr=frame[num].p;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v=vid_mem;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>t=v;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=frame[num].starty;i&lt;frame[num].endy;i++)

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(j=frame[num].startx;j&lt;frame[num].endx;j++)


<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v = t;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>v += (j*160) +
i*2;<span style="mso-spacerun: yes">   </span>/* вычисляем адрес */

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>*v++ =
*buf_ptr++;<span style="mso-spacerun: yes">    </span>/* запись символа */

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:187.0pt;
mso-layout-grid-align:none;text-autospace:none'>*v
= *buf_ptr++;<span style='mso-tab-count:1'>                            </span>/*
запись атрибута */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>frame[num].active= 0;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* очистка экрана */

<p
none;text-autospace:none'>void cls()

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style="mso-spacerun: yes"> </span>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>union REGS r;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;tab-stops:111.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.ah=6;
/*<span style='mso-tab-count:1'>              </span>код прокрутки экрана */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;tab-stops:111.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.al=0;
/*<span style='mso-tab-count:1'>                </span>код очистки экрана */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;tab-stops:111.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.ch=0;
/*<span style='mso-tab-count:1'>              </span>начальная строка */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;tab-stops:111.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.cl=0;
/*<span style='mso-tab-count:1'>                </span>начальная колонка */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;tab-stops:111.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.dh=24;/*<span
style='mso-tab-count:1'>             </span>конечная строка */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;tab-stops:111.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.dl=79;/*<span
style='mso-tab-count:1'>              </span>конечная колонка */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;tab-stops:111.0pt;
mso-layout-grid-align:none;text-autospace:none'>r.h.bh=7;
/*<span style='mso-tab-count:1'>              </span>очистка пустой строки */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int86(0x10,&amp;r,&amp;r);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/* установка курсора в
x,y */

<p
none;text-autospace:none'>void goto_xy(x,y)

<p
none;text-autospace:none'>int x,y;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>union REGS r;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.ah=2; /* функция
установки курсора */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.dl=y; /*
координата колонки<span style="mso-spacerun: yes">       </span>*/

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.dh=x; /*
координата строки<span style="mso-spacerun: yes">        </span>*/

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.bh=0; /* видео
страница<span style="mso-spacerun: yes">           </span>*/

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>int86(0x10,&amp;r,&amp;r);

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>/*<span
style="mso-spacerun: yes">  </span>запрос текущего видео режима */

<p
none;text-autospace:none'>video_mode()

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>union REGS r;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>r.h.ah = 15;<span
style="mso-spacerun: yes">   </span>/* получить режим */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return
int86(0x10,&amp;r,&amp;r) &amp; 255;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p
none;text-autospace:none'>is_in(s,c)

<p
none;text-autospace:none'>char *s,c;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'>register int i;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>for(i=0; *s; i++)

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>if(*s++ == c) return
i+1;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>return 0;

<p
none;text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;66.6pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>В
этом примере, если пользователь выберет &quot;Яблоко&quot;, то он или она будет
запрошен о цвете яблока; если выбран &quot;Красный&quot; цвет, то будет
высвечен список красных сортов яблок. Если же будет выбран грейпфрут то
пользователь будет запрошен о желаемом типе. Меню для выбора яблок показано на
рисунке. 

<table border=0 cellspacing=0 cellpadding=0 style='margin-left:29.5pt;
 border-collapse:collapse;mso-padding-alt:0cm 2.0pt 0cm 2.0pt'>
 <tr>
  <td width=451 valign=top style='width:338.5pt;border:solid windowtext .75pt;
  padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='5.55pt;margin-right:0cm;
  5.55pt;margin-left:5.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'>выберите фрукт:
  </td>
 </tr>
 <tr>
  <td width=451 valign=top style='width:338.5pt;border:solid windowtext .75pt;
  border-top:none;mso-border-top-alt:solid windowtext .75pt;padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='5.55pt;margin-right:0cm;
  0cm;margin-left:82.5pt;.0001pt;text-align:justify;mso-hyphenate:
  none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
  10.0pt'>|Яблоко |
  <p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>|Апельсин |
  <p class=MsoNormal style='margin-left:82.5pt;text-align:justify;mso-hyphenate:
  none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
  10.0pt'>|Груша |
  <p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>|гРейпфрут|
  <p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>|Малин---------
  <p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>|Клубн|Красный|
  <p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>-------Желтый |
  <p class=MsoNormal style='margin-left:115.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>|Ора-------------------
  <p class=MsoNormal style='margin-left:115.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>|Зел|Красный
  деликатес|
  <p class=MsoNormal style='margin-left:115.5pt;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>----|Д*ж*о*н*а*т*а*н**|
  <p class=MsoNormal style='margin-left:137.5pt;text-align:justify;mso-hyphenate:
  none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
  10.0pt'>|Белый налив |
  <p class=MsoNormal style='0cm;margin-right:0cm;5.55pt;
  margin-left:137.5pt;text-align:justify;mso-hyphenate:none;mso-layout-grid-align:
  none;text-autospace:none'>|Антоновка |
  </td>
 </tr>
 <tr>
  <td width=451 valign=top style='width:338.5pt;border:solid windowtext .75pt;
  border-top:none;mso-border-top-alt:solid windowtext .75pt;padding:0cm 2.0pt 0cm 2.0pt'>
  <p class=MsoNormal style='5.55pt;margin-right:0cm;
  5.55pt;margin-left:0cm;mso-hyphenate:none;mso-layout-grid-align:none;
  text-autospace:none'><![if !supportEmptyParas]>&nbsp;<![endif]><span
  style='font-size:10.0pt'>
  </td>
 </tr>
</table>

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Посмотрите внимательно на функцию pd_driver(), которая
следует за главной функцией main(). При использовании иерархических меню вы
должны создавать функцию, которая управляет системой меню. Основа стратегии
управляющей функции должна быть аналогична функции pd_driver() из этого
примера. Не забывайте, что эта простая программа только иллюстрирует как
активизировать меню. Ваша реальная прикладная программа будет обрабатывать
выбранные режимы более разумным образом. Запомните, что для использования
иерархических меню нужна следующая последовательность действий.

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>1. Создать меню,
используя make_menu().

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'>2. Активизировать
меню, используя pulldown().

<p class=MsoNormal style='0cm;margin-right:0cm;
margin-left:49.5pt;text-align:justify;text-indent:-16.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'>3.
Восстановить экран, используя restore_video(), при выходе из каждого меню. 

<p><div align="center"><b><font size="+1"><i><a name="1-22">Добавочные опции
</a></i></font></b></div></p>

<p class=MsoNormal style='margin-left:27.5pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Процедуры меню, разработанные в этой главе, подходят в
большинстве ситуаций. Однако, вы можете по желанию добавить некоторые из
следующих возможностей:

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'># Высвечивание
заголовка меню

<p
none;text-autospace:none'># Линейное меню (все
опции на одной строке)

<p># Использование разных цветов для разных
меню 

</body>

</html><!--Saved from http://mymanual.narod.ru>
