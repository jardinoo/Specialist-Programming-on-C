<html>

<head>
   <TITLE>C</TITLE>
</head>

<body bgcolor="#00ffff">
<a name="top"></a>
<p><div align="center"><b><font size="+1" face="Arial"><a name="3">Глава 3. Программы, остающиеся резидентными после завершения и формирующие при их вызове всплывающие изображения на экране дисплея.
</a></font></b></div></p>
<div class=Section1>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Простая на первый взгляд идея создания программ,
которые оставались бы резидентными в памяти после их завершения и реагировали
на вызов формированием всплывающих изображений на экране дисплея, на самом деле
является одной из наиболее трудных задач программирования для ПЭВМ. Такие
программы называются ТSR-программами. При чтении данного раздела вы должны
получше пристегнуться ремнями безопасности и одеть защитный шлем, т.к. создание
TSR-программ связано с риском. Но этот риск оправдан возможным вознаграждением
- поистине профессиональными результатами, которыми гордился бы любой
программист мирового класса.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Поскольку ТSR-программы, естественно, должны на низком
уровне взаимодействовать с аппаратурой и операционной системой, то излагаемые в
данном разделе сведения будут применимы только к ПЭВМ линии IBM PC, работающими
под операционной системой DOS. По причинам, которые будут указаны ниже,
приводимые в разделе программы рассчитаны на компилятор Turbo C, но могут быть
модифицированы и для других компиляторов.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Предупреждение. Для разработки и использования
TSR-программ характерна модификация таблицы векторов прерываний. Приведенные в
данном разделе программы транслируются с помощью Турбо Си версии

<p class=MsoNormal style='0cm;margin-right:4.4pt;177.6pt;
margin-left:27.5pt;text-align:justify;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>1.0 и в этом случае
работают корректно и без посторонних эффектов. При использовании другого
компилятора корректность работы не гарантируется. Кроме того, если вы будете
набирать эти программы вручную, то можете внести свои ошибки. И в том, и в
другом случае это может привести к фатальному сбою системы, в результате чего
могут быть уничтожены данные на вашем винчестерском диске. Поэтому
целесообразно делать резервные копии файлов. Я уверен, что приводил к краху мою
модель 60 не менее 100 раз за те два дня, пока отлаживал основную логику своей
программы. (К счастью, я не затирал при этом винчестерского диска). 

<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="3-1">Что такое TSR-программа?
</a></i></font></b></div></p>


<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>ТSR-программы создаются путем вызова функции 49 DOS,
по которой производится возврат из программы в DOS. При этом программа остается
в области памяти, которую DOS в дальнейшем не использует. Таким образом,
программа может быть мгновенно вызвана без повторной загрузки. Одним из многих
широко известных примеров TSR-программ является программа Sidekick фирмы
Вorland.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
421.8pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Большинство TSR-программ вызываются с помощью прерывания, которое может
быть сформировано несколькими способами. Наиболее распространенными являются
прерывания по таймеру, прерывания клавиатуры и печати экрана. Для TSR-программ,
формирующих изображение на экране, обычно используются прерывания от клавиатуры
или печати экрана, поскольку позволяют пользователю вызывать TSR-программу
путем одиночного нажатия клавиши. 
<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="3-2">Прерывания в семействе процессоров 8086.
</a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Процессоры семейства 8086 поддерживают до 256
различных прерываний по вектору. Прерывание по вектору вызывает выполнение
программы обработки прерываний (ISR), адрес которой содержится в таблице
векторов прерываний. Хотя некоторые старшие процессоры семейства требуют, чтобы
программы обработки прерывания располагались в определенных адресах памяти,
механизм прерываний по вектору позволяет определять адреса программ обработки
прерываний.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Таблица векторов начинается с адреса 0000:0000 и ее
размер составляет 1024 байта. Поскольку адрес программы обработки прерывания
может быть любым, то для его определения требуется 32 разряда (4 байта).
Следовательно, размер каждой записи в таблице векторов составляет 4 байта.
Адреса ISR-программ в таблице записываются таким образом, что адрес программы
обработки прерывания 0 находится по адресу 0000:0000, программы обработки
прерывания прерывания 1 - по адресу 0000:0004, прерывания 2 - по адресу
0000:0008 и т.д.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
310.8pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Когда происходит прерывание, то любые другие прерывания запрещаются.
Ваша программа обработки прерывания сразу после того, как она начнет
выполняться, должна разрешить прерывания, чтобы избежать краха системы.
Программа обработки прерывания должна завершаться командой IRET. 

<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="3-3">Прерывания против DOS и BIOS: Tревога в стране DOS.
</a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Программисты часто выражают недовольство тем, что DOS
не является повторно входимой программой. Это означает, что когда одна
программа обращается к DOS, то другая программа этого делать не может. (Этим
объясняется, в частности, почему DOS не является мультизадачной операционной
системой). Таким образом, программа обработки прерывания не может вызывать
никакой функции DOS, такая попытка приводит к краху системы. Поэтому программа
обработки прерывания должна сама выполнять те действия, которые производятся
при обращении к функциям DOS. К счастью, для формирования видеоизображения мы
можем использовать программы непосредственного обращения к видеопамяти из
разделов 1 и 2.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>BIOS допускает некоторую повторную входимость.
Например, прерывание 16, соответствующее вводу с клавиатуры, может быть
использовано в этом режиме без каких-либо побочных эффектов. Некоторые другие
подпрограммы использовать таким образом не столь безопасно. Обнаружить это
можно только экспериментальным путем. О том, что функцию нельзя использовать в
таком режиме, вы узнаете по фатальному сбою системы. Для приведенных в данном
разделе примеров и для многих распространенных в мире программ прерывания 16
вполне достаточно.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Поскольку многие из функций стандартной библиотеки
языка Си обращаются к DOS или к BIOS, то они не должны использовать тех функций
DOS и BIOS, которые не обеспечивают повторной входимости. Следует помнить, что
не только функции ввода-вывода обращаются к DOS и BIOS. Например, функция
распределения памяти malloc() обращается к DOS для определения размера
свободной памяти в системе. К сожалению, программы, которые рассчитаны на один
компилятор, могут не работать с другим компилятором. Этим и объясняется, почему
TSR-программы так трудно создавать и переносить в другую среду и почему
TSR-программ создано столь немного при их очень большой популярности.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
111.0pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>По существу, вы должны воспринимать TSR-программы как
&quot;заблудшие&quot; программы, о существовании которых DOS не подозревает. И
в дальнейшем, чтобы сохранить тайну о своем существовании эти программы должны
избегать любого взаимодействия с DOS. Всего пары обращений к DOS достаточно, и
вашей программе будет устроена кровавая резня. Чтобы этого избежать, вы должны
ощущать себя шпионом и иметь нервы автогонщика. 
<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="3-4">Модификатор функций прерывания Турбо Си.
</a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Хотя стандарт ANSI этого и не требует, Турбо Си
включает специальный модификатор типа функции, который называется interrupt и
позволяет использовать функции Си в качестве TSR-программ. (Большинство
основных разработчиков компиляторов Си по всей вероятности включат это средство
в свои будущие разработки, поскольку это очень важное расширение). Например,
предположим, что функция test() используется для обработки прерываний. В этом
случае вы должны определить ее так, как показано ниже. Параметры, описывающие
значения соответствующих регистров во время прерывания, не нужно определять,
если они не будут использоваться.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void interrupt
test(bp, di, si, ds, es, dx, cx, bx,

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:137.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ax, ip, cs, flags)

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned bp, di, si,
ds, es, dx, cx, bx, ax, ip, cs, flags;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>.

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>.

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>.

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Функция interrupt автоматически сохраняет значения
всех регистров и восстанавливает их перед возвратом управления вызывающей
программе. Эта функция использует для возврата управления команду IRET вместо
обычной в таком случае команды RET.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>В представленных в данной книге примерах модификатор
interrupt применяется только для тех функций, которые используются в качестве
точек входа в программы обработки прерываний TSR-программ.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
133.2pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Если ваш компилятор не поддерживает модификатор interrupt, то вам
необходимо написать на ассемблере небольшой интерфейсный модуль, который будет
сохранять значения регистров, переустанавливать разрешение прерываний, а затем
вызывать соответствующую функцию Си. Для выхода из модуля необходимо
использовать команду IRET. Средства создания функций на языке ассемблера
различны для разных компиляторов, так что читайте имеющееся у вас руководство
пользователя. 
<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="3-5">Общий план TSR-программы
</a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Все TSR-программы обычно состоят из двух разделов.
Первая часть используется для инициализации TSR-программы и возврата управления
DOS путем использования реентерабельного системного вызова. Эта часть не
выполняется до тех пор, пока не возникает необходимость в перезагрузке
программы. При этом производится запись адреса точки входа TSR-программы в
соответствующее место таблицы векторов.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;tab-stops:199.0pt 337.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Вторая,<span
style="mso-spacerun: yes">   </span>прикладная<span style='mso-tab-count:1'>                          </span>часть,<span
style="mso-spacerun: yes">   </span>занимается<span style='mso-tab-count:1'>                          </span>формированием

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>изображений.<span
style="mso-spacerun: yes">   </span>При<span style="mso-spacerun: yes">  
</span>этом<span style="mso-spacerun: yes">   </span>почти<span
style="mso-spacerun: yes">  </span>всегда<span style="mso-spacerun: yes"> 
</span>используются<span style="mso-spacerun: yes">  </span>окна,<span
style="mso-spacerun: yes">  </span>а

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>следовательно,и
программы управления окнами. При этом изображение

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>на<span
style="mso-spacerun: yes">  </span>экране<span style="mso-spacerun: yes"> 
</span>восстанавливается<span style="mso-spacerun: yes">  </span>после
завершения работы прикладной

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>части программы. Следует
помнить, что у большинства<span style="mso-spacerun: yes">  </span>TSR-программ

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>прикладные<span
style="mso-spacerun: yes">   </span>части<span style="mso-spacerun: yes">  
</span>представляют<span style="mso-spacerun: yes">   </span>собой<span
style="mso-spacerun: yes">   </span>утилиты<span style="mso-spacerun: yes"> 
</span>формиривания

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>изображения,<span
style="mso-spacerun: yes">  </span>как<span style="mso-spacerun: yes"> 
</span>у<span style="mso-spacerun: yes">  </span>программы<span
style="mso-spacerun: yes">  </span>типа<span style="mso-spacerun: yes">  
</span>&quot;записной<span style="mso-spacerun: yes">  
</span>книжки&quot;<span style="mso-spacerun: yes">   </span>или

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>&quot;калькулятора&quot;.<span
style="mso-spacerun: yes">   </span>После<span style="mso-spacerun: yes"> 
</span>своего<span style="mso-spacerun: yes">  </span>завершения<span
style="mso-spacerun: yes">  </span>они<span style="mso-spacerun: yes"> 
</span>восстанавливают

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>изображение на
экране<span style="mso-spacerun: yes">  </span>в<span style="mso-spacerun:
yes">  </span>том<span style="mso-spacerun: yes">  </span>же<span
style="mso-spacerun: yes">  </span>виде,<span style="mso-spacerun: yes"> 
</span>каким<span style="mso-spacerun: yes">  </span>оно<span
style="mso-spacerun: yes">  </span>было<span style="mso-spacerun: yes"> 
</span>перед

<p class=MsoNormal style='0cm;margin-right:4.4pt;388.5pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>запуском этих программ. 
<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="3-6">Использование прерывания печати экрана.
</a></i></font></b></div></p>


<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Без сомнений, прерыванием, которое наиболее просто
&quot;украсть&quot; у DOS, является прерывание номер 5. Это прерывание
вызывается при нажатии клавиши PT SCR. Если вы готовы пожертвовать функцией
печати экрана, то можете заменить адрес этой программы в таблице векторов
адресом вашей TSR-программы. Таким образом, при каждом нажатии клавиши PT SCR
будет вызываться ваша TSR-программа.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
466.2pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Примером такой программы является резидентный калькулятор. Программы
для работы с окнами и программа калькулятора из раздела 2 приводятся здесь с
некоторыми небольшими изменениями. 
<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="3-7">Раздел инициализации
</a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Раздел инициализации программы резидентного
калькулятора очень небольшой и целиком помещается в нижеследующей функции
main().

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void interrupt
tsr_ap(); /* вход в прикладную программу */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>main()

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>struct address 

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char far *p;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* адрес прерывания
печати экрана */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>struct address far
*addr = (struct address far *) 20;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>addr-&gt;p = (char far
*) tsr_ap;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>set_vid_mem();

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>tsr(2000);

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>TSR-программа первым делом должна заменить адрес
программы обработки прерывания 5 указателем функции, определенной в самой
TSR-программе. Есть несколько способов изменения адреса в таблице векторных
прерываний. Один из способов состоит в использовании системного вызова DOS.
Однако неудобство использования функции DOS заключается в том, что она требует
задания значения адресного сегмента в регистре ЕS, который недоступен при
использовании функции int86(). Некоторые компиляторы, как например Турбо Си,
включают специальные функции, предназначенные для установки адреса в таблице
прерываний. Однако способ, предлагаемый здесь, будет работать при использовании
практически любого компилятора. Функция tsr_ap() является точкой входа в
прикладную часть TSR-программы. Она использует указатель на содержимое таблицы
векторов, соответствующее прерыванию 5. (Напоминаем, что вектор 5 расположен по
адресу 20(4х5) в таблице, поскольку каждый вектор имеет размер 4 байта.
Некоторые TSR-программы восстанавливают исходное значение адреса. Но при
использовании приводимых здесь программ вы должны будете перезагружать систему,
чтобы восстановить исходные значения векторов прерываний.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>В предыдущих разделах, проверка режима работы
видеосистемы производилась динамически теми программами, которые с ней
работали. Однако в данном случае это неприменимо, поскольку требует
использования системных вызовов DOS. Вместо этого значение глобального
указателя vid_mem устанавливается с помощью функции set_vid_mem, приводимой
ниже.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>set_vid_mem()

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int vmode;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>vmode = video_mode();

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if((vmode!=2)
&amp;&amp; (vmode!=3) &amp;&amp; (vmode!=7)) 

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;video
must be in 80 column text mode&quot;);

<p class=MsoNormal style='0cm;margin-right:4.4pt;22.2pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>exit (1); 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* установить
соответствующий адрес видеопамяти */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(vmode==7) vid_mem =
(char far *) 0xB0000000;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>else vid_mem = (char
far *) 0xB8000000;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Наконец, выход из функции main() ocyществляется путем
обращения к функции tsr(), приведенной ниже.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* завершить
выполнение, но оставить резидентной */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>tsr(size)

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned size;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah = 49; /*
завершить и оставить резидентной */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.al = 0;<span
style="mso-spacerun: yes">  </span>/* код возврата */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = size;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x21, &amp;r,
&amp;r);

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Параметр size, определяемый в регистре DX,
используется для того, чтобы сообщить DOS, сколько памяти требуется для
размещения ТSR-программы. Размер памяти определяется в 16-байтных параграфах.
Иногда бывает трудно определить, сколько памяти необходимо для размещения программы.
И если в этом случае вы разделите размер загрузочного модуля вашей программы
(файла с расширением .EXE) на 16, а полученную величину умножите на 2, то
будете застрахованы от ошибки. Точно определить размер необходимой памяти
трудно, поскольку загрузочные модули частично накладываются друг на друга при
загрузке и необязательно размещаются в непрерывной области. (Если вы
намереватесь продавать свои программы, то наверняка хотели бы знать точно,
сколько потребуется памяти, чтобы не оказаться слишком расточительным. Наиболее
просто это можно определить экспериментальным путем). Код возврата,
устанавливаемый в регистре AL, передается системе.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
144.3pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>После завершения выполнения функции маin() программа остается в памяти,
и никакая другая программа не может быть загружена на ее место. Это значит, что
прикладная часть программы в любой момент времени готова быть запущенной
нажатием клавиши PT SCR. 
<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="3-8">Прикладная часть TSR-программы
</a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Точкой входа в прикладную часть TSR-программы должна
быть функция типа interrupt. В представленном ниже примере запуск прикладной
части выполняется путем вызова функции window_main().

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Точка входа в
прикладную часть TSR-программы */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void interrupt
tsr_ap()

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!busy) 

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>busy = !busy;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_main();

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>busy = !busy;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Глобальная
переменная<span style="mso-spacerun: yes">  </span>busy<span
style="mso-spacerun: yes">  </span>первоначально устанавливается в

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>0.
Прикладная часть TSR-программы не является повторно входимой, следовательно,
она не должна запускаться дважды за время одного использования. Переменная busy
используется как раз для того, чтобы предотвратить это. (Некоторые компиляторы
Си могут создавать реентерабельные программы, но безопаснее для вас не
обсуждать здесь этого вопроса).

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>В программы управления окнами необходимо внести
некоторые изменения для того, чтобы их можно было использовать в
TSR-программах. Во-первых, необходимо статически распределять память,
необходимую для хранения текущего содержимого экрана, путем использования
глобального массива. Вы могли привыкнуть к тому, что эта память распределялась
динамически, но данный способ здесь непригоден, вследствие того, что функции
динамического распределения используют системный вызов, который недопустим в
TSR-программах. По этой же причине функция go_to_xy() не может быть
использована для позиционирования курсора. Наконец, стандартные Си-функции
sscanf() и sprintf() также не могут быть использованы (по крайней мере, в Турбо
Си), потому что также осуществляют обращения к DOS. Вместо них используются
функции атоi() и itoa(). Полный текст программы резидентного калькулятора
представлен ниже.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* TSR-программа,
использующая прерывание печати экрана */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#include
&quot;dos.h&quot;

<p class=MsoNormal style='0cm;margin-right:4.4pt;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>#include &quot;stdlib.h&quot;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#define BORDER 1

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#define ESC 27

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#define MAX_FRAME 1

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#define REV_VID 0x70

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#define NORM_VID 7

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#define BKSP 8

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void interrupt
tsr_ap();

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void save_video(),
restore_video();

<p class=MsoNormal style='0cm;margin-right:4.4pt;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>void write_string(), write_char(); 

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:57.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>void<span
style='mso-tab-count:1'>     </span>display_header(), draw_border();

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:57.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>void<span
style='mso-tab-count:1'>     </span>window_gets();

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:57.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>void<span
style='mso-tab-count:1'>     </span>window_cleol(), window();

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:57.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>void<span
style='mso-tab-count:1'>     </span>calc();

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:57.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>char<span
style='mso-tab-count:1'>      </span>far *vid_mem;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>struct window_frame 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int startx, endx,
starty, endy;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int curx, cury; /*
текущее положение курсора в окне */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned char *p; /*
указатель буфера */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:140.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>char
*header;<span style='mso-tab-count:1'>                     </span>/* сообщение
в верхней части окна */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int border; /*
включение/отключение бордюра */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int active; /*
активация/деактивация окна */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>frame[MAX_FRAME];

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>char wp[4000]; /* буфер для хранения
текущего содержимого экрана

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* busy установлена в
1, если программа активна, иначе - в 0 */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>char busy = 0;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>main()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>struct address 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char far *p;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* адрес прерывания
печати экрана */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>struct address far
*addr = (struct address far *) 20;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>addr-&gt;p = (char far
*) tsr_ap;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>set_vid_mem();

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>tsr(2000);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>set_vid_mem()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int vmode;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>vmode = video_mode();

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if((vmode!=2)
&amp;&amp; (vmode!=3) &amp;&amp; (vmode!=7)) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;video
must be in &amp;0 column text mode&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* установить
соответсвующий адрес видеопамяти */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(vmode==7) vid_mem =
(char far *) 0xB0000000;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>else vid_mem = (char
far *) 0xB8000000;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* точка входа в
прикладную часть TSR-программы */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void interrupt
tsr_ap()

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><span style="mso-spacerun: yes"> </span>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!busy) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>busy = !busy;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_main();

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>busy = !busy;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* завершить, но
оставить резидентной */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>tsr(size)

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned size;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah
= 49;<span style="mso-spacerun: yes">   </span>/* завершить, но оставить
резидентной */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;tab-stops:134.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>r.h.al
= 0;<span style='mso-tab-count:1'>                        </span>/* код
возврата */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.ax = size;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x21, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_main()

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* первым делом,
создать структуру окна */

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>make_window(0,
&quot; Calculator &quot;, 8, 20, 12, 60, BORDER);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* для активации
описанного окна используйте window() */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>calc();

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*************************************************************/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:393.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>/*
Функции управления окнами<span style='mso-tab-count:1'>                                                                                                       </span>*/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>/*************************************************************/

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Вывести на экран
спускающееся меню */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void window(num)

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num; /* номер окна
*/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int vmode, choice;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>int x, y;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* сделать окно
активным */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!frame[num].active)<span
style="mso-spacerun: yes">   </span>/* используется не постоянно */

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;tab-stops:199.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>save_video(num);<span
style='mso-tab-count:1'>                                </span>/* сохранить
текущий экран */

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].active =
1;<span style="mso-spacerun: yes">  </span>/* установить флаг активности */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(frame[num].border)
draw_border(num);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>display_header(num);
/* вывести окно */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Создать спускающееся
окно

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>если окно может быть
создано, возвращается 1;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>иначе возвращается 0.

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>make_window(num,
header, startx, starty, endx, endy, border)

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num; /* номер окна
*/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>char *header;<span style="mso-spacerun:
yes">  </span>/* текст заголовка */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int startx, starty; /*
координаты X,Y левого верхнего угла */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int endx, endy; /*
координаты X,Y правого нижнего угла */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int border;<span
style="mso-spacerun: yes">  </span>/* без бордюра если 0 */


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int choice, vmode;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>unsigned char *p;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(num&gt;MAX_FRAME)<span
style="mso-spacerun: yes">   </span>

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(0,
&quot;Too many windows\n&quot;);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 0;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if((startx&gt;24) ||
(starty&gt;78) || (starty&lt;0))<span style="mso-spacerun: yes">  </span>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(0,
&quot;range error&quot;);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return<span
style="mso-spacerun: yes">  </span>0;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if((endx&gt;24) ||
(endy&gt;79))<span style="mso-spacerun: yes">  </span>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(0,
&quot;window won't fit&quot;);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 0;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* создать структуру
окна */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].startx =
startx; frame[num].endx = endx;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].starty =
starty; frame[num].endy = endy;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].p = wp;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].header =
header;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].border =
border;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].active = 0;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].curx = 0;
frame[num].cury = 0;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Деактивировать окно
и удалить его с экрана */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>deactivate(num)

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* установить курсор в
левый верхний угол */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].curx = 0;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].cury = 0;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>restore_video(num);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Вывести заголовок
окна в соответсвующее поле */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void
display_header(num)

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>register int i, y, len;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>y = frame[num].starty;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Вычислить точное
значение центральной позиции заголовка

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>если отрицательное -
заголовок не может быть выведен

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>len = strlen(frame[num].header);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>len = (frame[num].endy - y - len) / 2; 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(len&lt;0) return;
/* don't display it */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>y = y +len;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>write_string(frame[num].startx,
y,

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].header,
NORM_VID);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void draw_border(num)

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>char far *v, far *t;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = vid_mem;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>t = v;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(i=frame[num].startx+1;
i&lt;frame[num].endx; i++) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (i*160) +
frame[num].starty*2;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = 179;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = t;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (i*160) +
frame[num].endy*2;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = 179;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = t;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(i=frame[num].starty+1;
i&lt;frame[num].endy; i++) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (frame[num].startx*160)
+ i*2;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = 196;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = t;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v +=
(frame[num].endx*160) + i*2;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = 190;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = t;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>write_char(frame[num].startx,
frame[num].starty, 218, NORM_VID);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>write_char(frame[num].startx,
frame[num].endy, 191, NORM_VID);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>write_char(frame[num].endx,
frame[num].starty, 192, NORM_VID);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>write_char(frame[num].endx,
frame[num].endy, 217, NORM_VID);

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/**************************************************************/

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;tab-stops:405.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>/*<span
style="mso-spacerun: yes">  </span>Оконные функции ввода/вывода<span
style='mso-tab-count:1'>                                                                                                   </span>*/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>/**************************************************************/

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Вывести строку
начиная с текущей позиции курсора

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>описанного окна.

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Возвратить 0 если окно
не активное; и 1 в противном случае.

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(num, str)

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *str;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* убедиться, что окно
активное */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>if(!frame[num].active) return 0;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for( ; *str; str++)

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_putchar(num,
*str);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='0cm;margin-right:118.8pt;
22.2pt;margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Вывести символ в
текущую позицию курсора

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>описанного окна.

<p class=MsoNormal style='0cm;margin-right:101.2pt;
0cm;margin-left:71.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Возвратить 0 если окно
не активное, и 1 в противном случае.

<p class=MsoNormal style='0cm;margin-right:101.2pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:101.2pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_putchar(num,
ch)

<p class=MsoNormal style='0cm;margin-right:101.2pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='0cm;margin-right:101.2pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char ch;

<p class=MsoNormal style='0cm;margin-right:101.2pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:101.2pt;
0cm;margin-left:66.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int x, y;

<p class=MsoNormal style='0cm;margin-right:101.2pt;
11.1pt;margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>char far *v;

<p class=MsoNormal style='0cm;margin-right:101.2pt;
0cm;margin-left:66.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* убедиться, что окно
активное */ if(!frame[num].active) return 0;

<p class=MsoNormal style='11.1pt;margin-right:57.2pt;
0cm;margin-left:66.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>x = frame[num].curx +
frame[num].startx + 1; y = frame[num].cury + frame[num].starty + 1;

<p class=MsoNormal style='11.1pt;margin-right:57.2pt;
0cm;margin-left:66.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = vid_mem;

<p class=MsoNormal style='0cm;margin-right:57.2pt;
0cm;margin-left:66.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (x*160) + y*2; /*
вычислить адрес */ if(y&gt;=frame[num].endy) 

<p class=MsoNormal style='0cm;margin-right:57.2pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='0cm;margin-right:57.2pt;
0cm;margin-left:66.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:57.2pt;
0cm;margin-left:60.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(x&gt;=frame[num].endx)


<p class=MsoNormal style='0cm;margin-right:57.2pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='0cm;margin-right:57.2pt;
0cm;margin-left:60.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(ch=='\n')<span
style="mso-spacerun: yes">  </span>/* символ перехода на новую строку */ x++;

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>y =
frame[num].startx+1;

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = vid_mem;

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (x+160) + y*2; /*
вычислить адрес */ frame[num].curx++;<span style="mso-spacerun: yes"> 
</span>/* инкрементировать X */ frame[num].cury = 0; /* сбросить Y */

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>else 

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].cury++;

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = ch;<span
style="mso-spacerun: yes">  </span>/* вывести символ */

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = NORM_VID; /*
нормальные атрибуты символа */

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
frame[num].curx, frame[num].cury);

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='0cm;margin-right:101.2pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Установка курсора в
заданную позицию окна.

<p class=MsoNormal style='0cm;margin-right:114.4pt;
11.1pt;margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>Возвращает 0 при выходе за
границу; не ноль в противном случае.

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num, x, y)

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num, x, y;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>if(x&lt;0
|| x+frame[num].startx&gt;=frame[num].endx-1)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 0;

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>if(y&lt;0
|| y+frame[num].starty&gt;=frame[num].endy-1)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 0;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].curx = x;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].cury = y;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Считать строку из
окна. */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void window_gets(num,
s)

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *s;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>char ch, *temp;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>temp = s;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(;;) 

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ch =
window_getche(num);

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>switch(ch) 

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case '\r':<span
style="mso-spacerun: yes">  </span>/* нажата клавиша ENTER */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*s='\0';

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case BKSP: /* возврат
*/

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(s&gt;temp) 

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>s--;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].cury--;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(frame[num].cury&lt;0)
frame[num].cury = 0;

<p class=MsoNormal style='margin-left:33.0pt;text-indent:33.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>window_xy(num, frame[num].curx, frame[num].cury);
write_char(frame[num].startx+ frame[num].curx+1,

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].starty+frame[num].cury+1,
' ', NORM_VID);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>default:<span
style="mso-spacerun: yes">  </span>*s = ch;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>s++;

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Ввод символа с
клавиатуры в окно.

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Возвращает полный
16-разрядный скан-код.

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_getche(num)

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union inkey 

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char ch[2];

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int i;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>c; 

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!frame[num].active)
return 0; /* window not active */

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
frame[num].curx, frame[num].cury);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:55.0pt;mso-hyphenate:none;tab-stops:181.0pt;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>c.i = bioskey(0);<span
style='mso-tab-count:1'>                            </span>/* обработать
нажатие клавиши */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(c.ch[0]) 

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>switch(c.ch[0]) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case '\r': /* нажата
клавиша ENTER */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case BKSP: /* возврат
*/

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>default:

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(frame[num].cury+frame[num].starty
&lt; frame[num].endy-1) 

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>write
char(frame[num].startx+ frame[num].curx+1,

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].curx--;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
frame[num].curx, frame[num].cury);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return c.i;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Очистить до конца
строки */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void window_cleol(num)

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i, x, y;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>x = frame[num].curx;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>y = frame[num].cury;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>window_xy(num, frame[num].curx,
frame[num].cury);

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(i=frame[num].cury;
i&lt;frame[num].endy-1; i++)

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>window_putchar(num,' ');

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num, x, y);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Переместить курсор
на одну строку вверх.

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>При успешном
завершении вернуть ненулевое значение; в противном случае - 0.

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_upline(num)

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(frame[num].curx&gt;0)


<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:60.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].curx--;

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:60.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
frame[num].curx, frame[num].cury); return 1;

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 0;

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Переместить курсор
на одну строку вниз.

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>При успешном
завершении вернуть ненулевое значение; в противном случае - 0.

<p class=MsoNormal style='0cm;margin-right:44.0pt;
0cm;margin-left:33.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:44.0pt;
22.2pt;margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>window_downline(num) 

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(frame[num].curx&lt;frame[num].endx-frame[num].startx-1<span
style="mso-spacerun: yes">  </span>frame[num].curx++;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
frame[num].curx, frame[num].cury);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* вернуться на одну
позицию назад */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_bksp(num)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(frame[num].cury&gt;0)


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].cury--;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
frame[num].curx, frame[num].cury);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_putchar(num, '
');

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].cury--;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
framenum.curx, frame[num].cury);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/********************************************************/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:363.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>/*
Дополнительные функции<span style='mso-tab-count:1'>                                                                                               </span>*/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>/********************************************************/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Вывести строку с
установленными атрибутами */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void write_string(x,
y, p, attrib)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int x, y;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *p;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int attrib;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char far *v;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = vid_mem;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (x*160) + y*2; /*
вычислить адрес */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(i+y; *p; i++)<span
style="mso-spacerun: yes">  </span>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = *p++;<span
style="mso-spacerun: yes">  </span>/* вывести символ */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;tab-stops:157.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>*v++
= attrib;<span style='mso-tab-count:1'>                        </span>/*
вывести атрибуты */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Вывести символ с
утановленными атрибутами */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void write_char(x, y,
ch, attrib)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int x, y;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char ch;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int attrib;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>char far *v;

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>v = vid_mem; 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (x*160) +y*2;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = ch;<span
style="mso-spacerun: yes">  </span>/* вывести символ */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:134.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>*v
= attrib;<span style='mso-tab-count:1'>                       </span>/* вывести
атрибуты */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Сохранить
содержимое области экрана */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void save_video(num)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i,j;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char far *v, far *t;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>char *but_ptr;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>but_ptr =
frame[num].p;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = vid_mem;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>t=v;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(i=frame[num].starty;
i&lt;frame[num].endy+1; i++)

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>for(j=frame[num].startx;
j&lt;frame[num].endx+1; j++) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>t = (v + (j*160) +
i*2);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*buf_ptr++ = *t++;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*buf_ptr++ = *t;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*(t-1) = ' ';<span
style="mso-spacerun: yes">  </span>/* очистить окно */

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Восстановить
содержимое области экрана */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void save_video(num)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i,j;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char far *v, far *t;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>char *but_ptr;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>but_ptr =
frame[num].p;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = vid_mem;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>t=v;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(i=frame[num].starty;
i&lt;frame[num].endy+1; i++)

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>for(j=frame[num].startx;
j&lt;frame[num].endx+1; j++) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = t;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (j*160) + i*2;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ =
*but_ptr++;<span style="mso-spacerun: yes">   </span>/* вывести символ */

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v = *but_ptr++;<span
style="mso-spacerun: yes">   </span>/* вывести атрибуты */

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].active = 0;
/* восстановить изображение */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Возвращает код
текущего видеорежима */

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>video_mode()

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah =15;<span
style="mso-spacerun: yes">  </span>/* получить код видеорежима */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return int86(0x10,
&amp;r, &amp;r) &amp; 255;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/**********************************************************

<p class=MsoNormal style='margin-left:27.5pt;text-indent:49.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>калькулятор **********************************************************/

<p class=MsoNormal style='11.1pt;margin-right:0cm;
11.1pt;margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>#define MAX 100

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int *p;<span
style="mso-spacerun: yes">   </span>/* указатель стека */

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int *tos; /* указатель
вершины стека<span style="mso-spacerun: yes">  </span>*/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>int *bos; /* указатель дна стека */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char in[80], out[80];

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>int stack[MAX];

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Стековый, с
постфиксной записью калькулятор

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>на четыре функции */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void calc()

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;tab-stops:84.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>int<span
style='mso-tab-count:1'>      </span>answer;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;tab-stops:84.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>int<span
style='mso-tab-count:1'>      </span>a, b;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;tab-stops:84.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>p
=<span style='mso-tab-count:1'>     </span>stack;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;tab-stops:84.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>tos<span
style='mso-tab-count:1'>     </span>= p;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;tab-stops:84.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>bos<span
style='mso-tab-count:1'>    </span>= p + MAX - 1;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window(0);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(0, 0, 0);

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_cleol(0);

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(0, &quot;
: &quot;); /* промптер калькулятора */

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_gets(0, in);

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(0, &quot;
\n &quot;);

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_cleol(0);

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>switch(*in) 

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case '+ ':

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>a = pop();

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>b = pop();

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>answer = a + b;

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>push(a+b);

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case '-':

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>a = pop();

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>b = pop();

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>answer = b-a;

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>push(b-a);

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case '- ':

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>a = pop();

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>b = pop();

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>answer = b*a;

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>push(b*a);

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case '/ ':

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>a = pop();

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>b = pop(); 

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(a==0) 

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(0,
&quot;divide by 0\n&quot;);

<p class=MsoNormal style='margin-left:104.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>answer = b/a;

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>push(b/a);

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>default:

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>push(atoi(in));

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>continue;

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>itoa(answer, out, 10);

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(0, out);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes">   </span>while(*in);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>deactivate(0);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Поместить число в
стек.

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Возвратить 1 при
успешном завершении; и 0, если стек переполнен

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>push(i)

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int i;

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(p&gt;bos) return 0;

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*p = i;

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>p++;

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:44.0pt;.0001pt;text-indent:-16.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>/* Извлечь верхний элемент стека Возвратить 0, если стек пуст.

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>pop()

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>p--;

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(p&lt;tos) 

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>p++;

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 0;

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return *p;

<p class=MsoNormal style='0cm;margin-right:114.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;99.9pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Вы
можете сразу вводить эту программу в ЭВМ. Для того, чтобы установить прикладную
часть, запустите ее на выполнение. Для вызова калькулятора нажмите клавишу PT
SCR. 
<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="3-9">Использование прерывания по нажатию клавиши. </a></i></font></b></div></p>


<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Прерывание печати экрана очень просто использовать, но
у него есть три крупных недостатка. Во-первых, оно позволяет быть резидентным в
системе только прикладной части TSR-программы. Во-вторых, вы не можете при этом
пользоваться печатью экрана. В-третьих, это решение проблемы &quot;в лоб&quot;,
и потому оно не очень хорошее. Лучшим способом запуска TSR-программы является
использование прерывания 9 по нажатию клавиши. Прерывание 9 выполняется при
каждом нажатии клавиши на клавиатуре.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>При использовании прерывания 9 для запуска
TSR-программ должны соблюдаться следующие основные положения. Во-первых, Вы
должны переписать адрес из таблицы векторов, соответствующий прерыванию 9, в
такое место таблицы, которое соответствует неиспользуемому DOS прерыванию. Мы
будем использовать прерывание

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>60.
Затем, занесите адрес точки входа в вашу TSR-программу по адресу прерывания 9 в
таблице векторов. После запуска ваша TSR-программа первым делом вызовет через
прерывание драйвер ввода с клавиатуры. Затем проверяется, не соответствует ли
введенный символ &quot;горячей клавише&quot;, которая используется для запуска
прикладной части TSR-программы. Если соответствует, то прикладная часть
начинает выполняться, в противном случае никакого действия не производится и
TSR-программа деактивируется. Таким образом, при каждом нажатии происходит
обращение к функции, реагирующей на нажатие клавиш, но прикладная часть
TSR-программы запускается только при нажатии определенной клавиши.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Использование прерывания по нажатию клавиши имеет два
преимущества. Во-первых, при этом нет никакой потери функциональных
возможностей. Во-вторых, появляется возможность использовать одновременно
несколько различных прикладных частей TSR-программы, вызов которых
осуществляется нажатием соответствующих им различных &quot;горячих
клавиш&quot;. Представленная в данном разделе TSR-программа использует эту
возможность и включает в свой состав и &quot;калькулятор&quot;, и
&quot;записную книжку&quot; (из раздела 2), которые вызываются отдельно друг от
друга.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
155.4pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Прежде, чем использовать эту возможность, вы должны узнать кое-что об
обработке BIOS нажатий клавиш. 
<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="3-10">Буфер символов, введенных с клавиатуры. </a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:4.4pt;11.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Как
вы знаете, стандартные версии DOS буферизуют до 15 символов, введенных с
клавиатуры, что позволяет выполнить ввод с опережением. При каждом нажатии
клавиши наступает прерывание 9. Программа ISR реакции на нажатие клавиши принимает
код символа из порта и помещает его в буфер. Когда вы обращаетесь к функциям
DOS или BIOS ввода с клавиатуры, обрабатывается только содержимое буфера, а не
текущее содержимое порта. Это позволяет вашим программам непосредственно
обрабатывать содержимое буфера символов, так же, как это делают программы BIOS
и DOS. Таким образом, это позволяет функции реагирования на нажатие клавиш
вашей TSR-программы определять, была ли нажата &quot;горячая клавиша&quot;, не
уничтожая при этом содержимого буфера символов.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
244.2pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Буфер ввода с клавиатуры расположен по адресу 0000:041 (1054 в
десятичной системе счисления ). Поскольку при каждом нажатии клавиши
формируется 16-битный скан-код, то для ввода 15 символов требуется 30 байт.
Однако обычно используются 32 байта, т.к. скан -код клавиши RETURN
автоматически добавляется к концу буфера. Буфер организован в виде циклической
очереди, доступ к которой осуществляется через указатели начала и конца
очереди. Указатель начала указывает на символ, который был введен последним.
Указатель конца указывает на следующий символ, который будет передан по запросу
на ввод символа от DOS или BIOS. Указатель начала хранится по адресу 0000:041C
(1052 в десятичной с.с.). Значения указателей начала и конца фактически
используются для индексной адресации очереди, и соответствует индексу текущей
позиции +30. (Это связано с особенностями выполнения косвенной адресации
процессором 8086). Значения указателей начала и конца очереди совпадают в том
случае, если очередь пуста. 
<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="3-11">Функция инициализации.
</a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Для прикладной TSR-программы, представленной в данном
разделе, требуется небольшая по объему программа инициализации. Она оформлена в
виде функции main(), которая приводится ниже.

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>main()

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>struct address 

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char far *p;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>temp;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* указатель вектора
прерывания 9 */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>struct address far
*addr = (struct address far *) 36;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* указатель вектора
прерывания 60 */

<p class=MsoNormal style='0cm;margin-right:4.4pt;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>struct address far *int9 = (struct address
far *) 240;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Поместить адрес
обработки прерывания от клавиатуры

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>в вектор прерывания
60. Если вектора прерываний 60 и

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>61 содержат одинаковые
адреса, то TSR-программа не

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>была запущена.

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(int9-&gt;p ==
(int9+1)-&gt;p) 

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int9-&gt;p =
addr-&gt;p;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>addr-&gt;p = (char far
*) tsr_ap;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;tsr
installed - F2 for note pad, F3 for calculator &quot;);

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>else 

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf (&quot;tsr
application already initialized\n &quot;);

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes">  </span>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>set_vid_mem();

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>tsr(2000);

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;122.1pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>Следует
отметить, что данная версия программы не допускает, чтобы ее запускали более
одного раза в течение одного сеанса работы. Это связано с тем, что повторный
запуск программы приведет к записи адреса точки входа в TSR-программу в таблицу
векторов по адресу 60-го прерывания, а содержавшийся там адрес программы
реакции на нажатие клавиши будет запорчен. Во время работы функции проверяется,
совпадает ли содержимое таблицы векторов, соответствующее прерываниям 60 и 61.
(Прерывание 61 также не используется DOS). DOS обрабатывает все неиспользуемые
ею прерывания одной и той же программой обработки недопустимого прерывания.
Следовательно, перед запуском TSR-программы эти адреса будут совпадать, а после
запуска они будут различны. 
<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="3-12">Прикладная часть TSR-программы. </a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Применяемая здесь функция входа в TSR-программу
является более сложной, чем при использовании прерывания по печати экрана. Первым
делом она должна сформировать прерывание 60, для того чтобы ввод с клавиатуры
осуществлялся стандартной программой ввода. Большинство компиляторов Си имеют
функцию генерации прерывания. В Турбо Си это функция geninterrupt(), параметром
которой является номер того прерывания, которое вы хотите вызвать. После
возврата из прерывания 60 ваша функция должна проверить содержимое очереди,
адресуемое с помощью указателя начала, на предмет того, не была ли нажата
&quot;горячая клавиша&quot;. Для представленной здесь программы
&quot;горячими&quot; являются клавиши F2 и F3 с позиционными кодами 60 и 61
соответственно. Нажатие &quot;горячей клавиши&quot; должно быть обнаружено
прежде, чем управление будет передано прикладной части программы. Глобальная
переменная busy используется для того, чтобы предотвратить одновременное
использование обеих прикладных частей программы, поскольку большинство
компиляторов Си не позволяют создавать повторно-входимые программы. Если одна
из прикладных частей активна, то другой части активация в этот момент запрещена.
Функция tsr_ap() приводится ниже.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Точка входа в
прикладную часть TSR-программы */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void interrupt
tsr_ap()

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char far *t = (char
far *) 1050; /* адрес указателя заголовка *

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>geninterrupt(60);

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(*t != *(t+2))<span
style="mso-spacerun: yes">  </span>/* если не пустой */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>t += *t - 30 + 5; /*
перейти к позиции символа */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(*t == 60 || *t ==
61) 

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:60.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>bioskey(0); /*
сбросить клавиши F2/F5 */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:60.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!busy) 

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:71.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>busy = !busy;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:60.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Следует отметить, что параметром функции window_main()
является позиционный код &quot;горячей клавиши&quot;, для того, чтобы она могла
осуществить выбор соответствующей прикладной части.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* создать окно */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_main(which)

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int which;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union inkey 

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char ch[2];

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int i;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>c;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int i;

<p class=MsoNormal style='0cm;margin-right:4.4pt;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>char ch; 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* во-первых, создать
рамку окна */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>make_window(0,&quot;
Notepad [F1 to exit] &quot;, 5, 20, 17, 60, BORDER);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>make_window(1, &quot; Colculator &quot;,
8, 20, 12, 60, BORDER);

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>/*
использовать window() для активации созданного окна */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>switch(which) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 60:

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>notepad();

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 61:

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>calc();

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Вы можете сразу вводить в ЭВМ представленную здесь
программу. После того, как вы ее запустите, клавишей F2 будет выбираться
программа &quot;записная книжка&quot;, а клавишей F3 - &quot;калькулятор&quot;.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Программа,
остающаяся резидентной после завершения и

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>использующая
прерывание 9 от клавиатуры.

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#include &quot;dos.h
&quot;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#include
&quot;stdlib.h &quot;

<p class=MsoNormal style='0cm;margin-right:4.4pt;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>#include &quot;ctype.h &quot;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#define BORDER 1

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#define ESC 27

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#define MAX_FRAME 2

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#define REV_VID 0x70

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#define NORM_VID 7

<p class=MsoNormal style='0cm;margin-right:4.4pt;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>#define BKSP 8

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void interrupt
tsr_ap();

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void save_video(),
restore_video();

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void write_string(),
write_char();

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void display_header(),
draw_border();

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void window_gets();

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void window_cleol(),
window();

<p class=MsoNormal style='0cm;margin-right:4.4pt;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>void notepad(), calc();

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char far *vid_mem;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char wp[4000]; /*
буфер для хранения текущего

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:126.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>содержимого экрана */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>struct window_trame 

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int startx, endx,
starty, endy;

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int curx, cury; /*
текущее положение курсора в окне */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned char *p; /*
указатель в буфере */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *header; /*
сообщение заголовка */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int border; /*
включение/отключение бордюра */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int active; /*
выводить/не выводить на экран */

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>frame [MAX_FRAME]; 

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>char in[80], out[80];

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* busy установлена в
1,когда программа активна, иначе - в 0 */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char busy = 0;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>main()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>struct adaress 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char far *p;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>temp;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* указатель на вектор
прерывания 9 */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>struct address far
*addr = (struct address far *) 36;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* указатель на вектор
прерывания 60 */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>struct address far *int9 = (struct address
far *) 240;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Поместить адрес
программы обработки прерывания от клавиатуры

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>по
адресу прерывания 60. Если вектора прерываний 60 и 61

<p class=MsoNormal style='margin-left:27.5pt;text-indent:16.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>содержат одинаковые адреса, то TSR-программа не была запущена. */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if (int9-&gt;p ==
(int9+1)-&gt;p) 

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int9-&gt;p =
addr-&gt;p;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>addr-&gt;p = (char far
*) tsr_ap;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf (&quot;tsr
installed - F2 for note pad, F3 for calculator&quot;);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>else 

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf (&quot;tsr
application already initialized\n&quot;);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit (1);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>set_vid_mem();

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>tsr (800);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>set_vid_mem()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int vmode;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>vmode = video_mode();

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(( vmode != 2)
&amp;&amp; ( vmode != 3) &amp;&amp; ( vmode != 7))<span style="mso-spacerun:
yes">  </span>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>printf(&quot;video
must be in 80 column text mode&quot;);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>exit(1);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* установить
соответствующий адрес видеопамяти */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(vmode==7) vid_mem =
(char far *) 0xB0000000;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>else vid_mem = (char
far *) 0xB8000000;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Точка входа в
прикладную часть TSR-программы */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void interrupt
tsr_ap()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char far *t = (char
far *) 1050; /* адрес указателя заголовка *

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>geninterrupt(60);/*
читать символ */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(*t != *(t+2))<span
style="mso-spacerun: yes">  </span>/* если не пусто */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>t += *t-30+5; /*
перейти к позиции символа */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(*t == 60 || *t ==
61)<span style="mso-spacerun: yes">  </span>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>bioskey(0); /*
сбросить клавиши F2/F3 */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!busy) 

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>busy = !busy; 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_main(*t);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>busy = !busy;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* завершить но
оставить резидентной */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>tsr(size)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>unsigned size;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah = 49;<span
style="mso-spacerun: yes">  </span>/* завершить и оставить резидентной */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.al = 0;<span
style="mso-spacerun: yes">  </span>/* код возврата */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.x.dx = size;<span
style="mso-spacerun: yes">  </span>/* размер программы/16 */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int86(0x21, &amp;r,
&amp;r);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* создать окно */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_main(which)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int which;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union inkey<span
style="mso-spacerun: yes">  </span>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char ch[2];

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int i;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>c;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int i;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>char ch;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* во-первых, создать
рамку окна */

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>make_window(0, &quot;
Notepad [F1 to exit] &quot;, 5, 20, 17, 60, BORDER);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>make_window(1, &quot; Calculator &quot;,
8, 20, 12, 60, BORDER);

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>/*
использовать window() для активации созданного окна */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>switch(which)<span
style="mso-spacerun: yes">  </span>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 60:

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>notepad();

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 61:

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>calc();

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/***************************************************************/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:405.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>/*
Функции управления окнами<span style='mso-tab-count:1'>                                                                                                             </span>*/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>/***************************************************************/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Вывести
спускающееся окно */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void window(num)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num; /* номер окна
*/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>/* сделать окно активным */ 

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>if(!frame[num].active)<span
style="mso-spacerun: yes">    </span>/* используется не постоянно */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;tab-stops:199.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>save_video(num);<span
style='mso-tab-count:1'>                                  </span>/* сохранить
текущий экран */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].active =
1;<span style="mso-spacerun: yes">  </span>/* установить флаг активности */

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(frame[num].border)
draw_border(num);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>display_header(num);
/* вывести окно */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Создать рамку
спускающегося окна.

<p class=MsoNormal style='0cm;margin-right:74.8pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Если рамка может быть
создана, возвращается 1, в противном случае возвращается 0.

<p class=MsoNormal style='0cm;margin-right:74.8pt;
11.1pt;margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:8.8pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>make_window(num,
header, startx, starty, endx, endy, border) int num;<span style="mso-spacerun:
yes">     </span>/* номер окна */

<p class=MsoNormal style='0cm;margin-right:8.8pt;0cm;
margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *header;<span
style="mso-spacerun: yes">   </span>/* текст заголовка */

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>int startx, starty; /* координаты X,Y верхнего левого угла */ int endx,
endy; /* координаты X,Y нижнего правого угла */

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;tab-stops:123.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>int
border;<span style='mso-tab-count:1'>                        </span>/* без
бордюра если 0 */

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i;

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int choice, vmode;

<p class=MsoNormal style='0cm;margin-right:17.6pt;
11.1pt;margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>unsigned char *p;

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(num&gt;MAX_FRAME)<span
style="mso-spacerun: yes">  </span>

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(0,
&quot;Too many windows\n&quot;);

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 0;

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:49.5pt;.0001pt;text-indent:-11.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>if((startx&gt;24) || (startx&lt;0) || (starty&gt;78) ||
(starty&lt;0))<span style="mso-spacerun: yes">  </span>window_puts(0,
&quot;range error&quot;);

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 0;

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:49.5pt;.0001pt;text-indent:-11.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if((endx&gt;24) ||
(endy&gt;79)) 

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(0,
&quot;window won't fit&quot;);

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 0;

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>

<p class=MsoNormal style='0cm;margin-right:17.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Отвести достаточное
количество памяти */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>p= (unsigned char *)
malloc(2*(endx-startx+1)*(endy-starty+1));

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!p) exit(1); /*
поместите здесь ваш собственный

<p class=MsoNormal align=center style='11.1pt;text-align:center;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>обработчик ошибок */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* создать рамку */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].startx =
startx; frame[num].endx = endx;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].starty =
starty; frame[num].endy = endy;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].p = wp;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].header =
header;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].border =
border;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].active = 0;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].curx =
0;<span style="mso-spacerun: yes">  </span>frame[num].cury = 0;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Деактивировать окно
и удалить его с экрана */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>deactivate(num)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* установить курсор в
левый верхний угол */

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].curx = 0;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].cury = 0;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>restore_video(num);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Вывести текст
заголовка в соответствующее поле */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void
display_header(num)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i, y,
len;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>y = frame[num].starty;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Вычислить начальную
позицию относительно

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>центра заголовка, если
отрицательная, то

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>сообщение не подходит.

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>len =
strlen(frame[num].header);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>len = (frame[num].endy
- y - len) / 2;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(len&lt;0) return;
/* не выводить его */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>y = y +len;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>write_string(frame[num].startx,
y,

<p class=MsoNormal style='margin-left:99.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].header,
NORM_VID);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void draw_border(num)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char far *v, far *t;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = vid_mem;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>t = v;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(i=frame[num].startx+1;
i&lt;frame[num].endx; i++) 

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (i*160) +
frame[num].starty*2;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>*v++ = 179;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = t;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (i*160) +
frame[num].endy*2;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = 179;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = t;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(i=frame[num].starty+1;
i&lt;frame[num].endy; i++) 

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v +=
(frame[num].startx*160) + i*2;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = 196;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v = NORM_VID;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = t;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v +=
(frame[num].endx*160) + i*2;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = 196;

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>*v = NORM_VID; 

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = t;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>write_char(frame[num].startx,
frame[num].starty, 218, NORM_VID);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>write_char(frame[num].startx,
frame[num].endy, 191, NORM_VID);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>write_char(frame[num].endx,
frame[num].starty, 192, NORM_VID);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>write_char(frame[num].endx,
frame[num].endy, 217, NORM_VID);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/*************************************************************/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:393.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>/*
Оконные функции ввода/вывода<span style='mso-tab-count:1'>                                                                                                 </span>*/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>/*************************************************************/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Вывести строку
начиная с текущей позиции

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>в созданном окне.

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Возвратить 0, если
окно не активное, и 1 - в противном случае.

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(num, str)

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *str;

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:38.5pt;.0001pt;text-indent:5.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>/* убедитесь, что окно активное */ if(!frame[num].active) return 0;
for( ; *str; str++)

<p class=MsoNormal align=center style='margin-right:118.8pt;text-align:center;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>window_putchar(num, *str);

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Вывести символ в
текущую позицию курсора

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>в созданном окне

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Возвратить 0, если
окно не активное, и 1 - в противном случае.

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_putchar(num,
ch)

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char ch;

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int x, y;

<p class=MsoNormal style='0cm;margin-right:118.8pt;
11.1pt;margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>char far *v;

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:38.5pt;.0001pt;text-indent:5.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>/* убедитесь, что окно активное */ if(!frame[num].active) return 0;

<p class=MsoNormal style='11.1pt;margin-right:0cm;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>x = frame[num].curx +
frame[num].startx + 1;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>y = frame[num].cury + frame[num].starty +
1;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = vid_mem;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (x*160) + y*2; /*
вычислить адрес */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(y&gt;=frame[num].endy)


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(x&gt;=frame[num].endx)


<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(ch=='\n')<span
style="mso-spacerun: yes">  </span>/* символ перехода к новой строке */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>x++;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>y =
frame[num].startx+1;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = vid_mem;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (x*160) + y*2; /*
вычислить адрес */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].curx++; /*
нарастить X */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].cury = 0;
/* сбросить Y */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>else 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].cury++;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = ch; /* вывести
символ */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = NORM_VID; /*
нормальные атрибуты символа */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
frame[num].curx, frame[num].cury);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='0cm;margin-right:118.8pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Установить курсор в
определенной позиции окна.

<p class=MsoNormal style='0cm;margin-right:123.2pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Возвратить 0 при
выходе за границу; и не ноль в противном случае.

<p class=MsoNormal style='0cm;margin-right:123.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:123.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num, x, y)

<p class=MsoNormal style='0cm;margin-right:123.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num, x, y;

<p class=MsoNormal style='0cm;margin-right:123.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:49.5pt;.0001pt;text-indent:-11.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>if(x&lt;0 || x+frame[num].startx&gt;=frame[num].endx-1) return 0;

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(y&lt;0 ||
y+frame[num].starty&gt;=frame[num].endy-1)

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:49.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 0;

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].curx = x;

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].cury = y;

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='0cm;margin-right:123.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Считать строку из
окна */

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void window_gets(num,
s)

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *s;

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char ch, *temp;

<p class=MsoNormal style='0cm;margin-right:35.2pt;
11.1pt;margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>char out[10];

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>temp = s;

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(;;) 

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:66.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ch =
window_getche(num);

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:66.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>switch(ch) 

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:77.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case '\r': /* нажата
клавиша ENTER */

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:88.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*s='\0';

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:88.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return;

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:77.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case BKSP: /* возврат
на шаг */

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:88.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(s&gt;temp) 

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:88.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>s--;

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:88.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].cury--;

<p class=MsoNormal style='0cm;margin-right:35.2pt;
22.2pt;margin-left:88.0pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>if(frame[num].cury&lt;0)
frame[num].cury = 0; 

<p class=MsoNormal style='margin-left:99.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
frame[num].curx, frame[num].cury);

<p class=MsoNormal style='margin-left:99.0pt;text-indent:11.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>write_char(frame[num].startx+ frame[num].curx+1,
frame[num].starty+frame[num].cury+1,' ',NORM_VID);

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:88.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:88.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:77.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>default: *s = ch;

<p class=MsoNormal style='margin-left:88.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>s++;

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:66.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:55.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:35.2pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Ввести символ в
окно.

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Возвратить полный
16-разрядный скан-код

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_getche(num)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union inkey 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char ch[2];

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int i;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>c;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(!frame[num].active)
return 0; /* окно не активное */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
frame[num].curx, frame[num].cury);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>c.i = bioskey(0);<span
style="mso-spacerun: yes">  </span>/* обработать нажатие клавиши */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(c.ch[0]) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>switch(c.ch[0]) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case'\r': /* нажата
клавиша ENTER */

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case BKSP: /* возврат
на шаг */

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>default:

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(frame[num].cury+frame[num].starty
&lt; frame[num].endy-1) 

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>write_char(frame[num].startx+
frame[num].curx+1,

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].starty+frame[num].cury+1,
c.ch[0], NORM_VID);

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].cury++;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(frame[num].curx
&lt; 0) frame[num].curx = 0;

<p class=MsoNormal style='margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(frame[num].curx+frame[num].startx
&gt; frame[num].endx-2)

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:44.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>frame[num].curx--;

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
frame[num].curx, frame[num].cury);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return c.i;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Очистить до конца
строки */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void window_cleol(num)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i, x, y;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>x = frame[num].curx;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>y = frame[num].cury;

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>window_xy(num, frame[num].curx,
frame[num].cury); 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(i=frame[num].cury;
i&lt;frame[num].endy-1; i++)

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_putchar(num,'
');

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num, x, y);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Переместить курсор
вверх на одну строку.

<p class=MsoNormal style='0cm;margin-right:127.6pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Возвратить не ноль в
случае успеха и 0 в противном случае.

<p class=MsoNormal style='0cm;margin-right:127.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:127.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_upline(num)

<p class=MsoNormal style='0cm;margin-right:127.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='0cm;margin-right:127.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:127.6pt;
0cm;margin-left:49.5pt;.0001pt;text-indent:-11.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>if(frame[num].curx&gt;0) <span style="mso-spacerun:
yes"> </span>frame[num].curx--;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
frame[num].curx, frame[num].cury);

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='0cm;margin-right:127.6pt;
0cm;margin-left:49.5pt;.0001pt;text-indent:-11.0pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 0;

<p class=MsoNormal style='0cm;margin-right:127.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Переместить курсор
вниз на одну строку.

<p class=MsoNormal style='0cm;margin-right:127.6pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Возвратить не ноль в
случае успеха и 0 в противном случае.

<p class=MsoNormal style='0cm;margin-right:127.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:127.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_downline(num)

<p class=MsoNormal style='0cm;margin-right:127.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='0cm;margin-right:127.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:127.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(frame[num].curx&lt;frame[num].endx-frame[num].startx-1)<span
style="mso-spacerun: yes">  </span>frame[num].curx++;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
frame[num].curx, frame[num].cury);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:33.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* назад на один
символ */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_bksp(num)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(frame[num].cury&gt;0)


<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].cury--;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
frame[num].curx, frame[num].cury);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>window_putchar(num, ' ');

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].cury--;

<p class=MsoNormal style='margin-left:55.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(num,
frame[num].curx, frame[num].cury);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/***************************************************************/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:405.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>/*
Дополнительные функции<span style='mso-tab-count:1'>                                                                                                                  </span>*/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>/***************************************************************/

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>/* Вывести строку с указанными атрибутами
*/ 

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void write_string(x,
y, p, attrib)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int x, y;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *p;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int attrib;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>char far *v;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v=vid_mem;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (x*160) + y*2; /*
вычислить адрес */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(i=y; *p; i++) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = *p++;<span
style="mso-spacerun: yes">  </span>/* записать символ */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = attrib;<span
style="mso-spacerun: yes">  </span>/* записать атрибуты */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Вывести символ с
указанными атрибутами */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void write_char(x, y,
ch, attrib)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int x, y;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char ch;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int attrib;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char far *v;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = vid_mem;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (x*160) + y*2;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = ch;<span
style="mso-spacerun: yes">  </span>/* записать символ */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v = attrib;<span
style="mso-spacerun: yes">  </span>/* записать атрибуты */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Сохранить область
экрана */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void save_video(num)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i, j;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *buf_ptr;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char far *v, far *t;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>buf_ptr =
frame[num].p;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = vid_mem;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(i=frame[num].starty;
i&lt;frame[num].endy+1; i++)

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>for(j=frame[num].startx;
j&lt;frame[num].endx+1; j++) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>t = (v + (j*160) +
i*2);

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>*buf_ptr++ = *t++;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*buf_ptr++ = *t;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*(t-1) = ' '; /*
очистить окно */

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Восстановить
область экрана */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void
restore_video(num)

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int num;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>register int i,j; 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char far *v, far *t;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char *buf_ptr;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>buf_ptr =
frame[num].p;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = vid_mem;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>t = v;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(i=frame[num].starty;
i&lt;frame[num].endy+1; i++)

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>for(j=frame[num].startx;
j&lt;frame[num].endx+1; j++) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v = t;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>v += (j*160) + i*2;

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v++ = *buf_ptr++; /*
записать симпол */

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*v = *buf_ptr++;<span
style="mso-spacerun: yes">  </span>/* записать атрибуты */

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>frame[num].active =
0;/* восстановить изображение */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Возвратить код
текущего видеорежима */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>video_mode()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union REGS r;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>r.h.ah = 15;<span
style="mso-spacerun: yes">  </span>/* получить код видеорежима */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return int86(0x10,
&amp;r, &amp;r) &amp; 255;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/****************************************************/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:339.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>/*
Функции всплывающих окон<span style='mso-tab-count:1'>                                                                                </span>*/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>/****************************************************/

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>#define MAX 100

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int *p; /* указатель
стека */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int *tos; /* указатель
вершины стека */

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int *bos; /* указатель
дна стека */

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>int stack[MAX];

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Стековый, с
постфиксной записью калькулятор

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>с четырьмя функциями

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void calc()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:62.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>int<span
style='mso-tab-count:1'>      </span>answer;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:62.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>int<span
style='mso-tab-count:1'>      </span>a,b;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:62.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>p
=<span style='mso-tab-count:1'>     </span>stack;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;tab-stops:62.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>tos<span
style='mso-tab-count:1'>     </span>= p;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;tab-stops:62.5pt;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>bos<span
style='mso-tab-count:1'>    </span>= p+MAX-1;

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window(1);

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>do 

<p class=MsoNormal style='margin-left:77.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_xy(1, 0, 0);

<p class=MsoNormal style='margin-left:77.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_cleol(1);

<p class=MsoNormal style='margin-left:77.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(1, &quot;:
&quot;); /* промптер калькулятора */

<p class=MsoNormal style='margin-left:77.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_gets(1, in);

<p class=MsoNormal style='margin-left:77.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(1,
&quot;\n &quot;);

<p class=MsoNormal style='margin-left:77.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_cleol(1);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:77.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>switch(*in)<span style="mso-spacerun:
yes">  </span>

<p class=MsoNormal style='margin-left:88.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case '+':

<p class=MsoNormal style='margin-left:99.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>a = pop();

<p class=MsoNormal style='margin-left:99.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>b = pop();

<p class=MsoNormal style='margin-left:99.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>answer = a+b;

<p class=MsoNormal style='margin-left:99.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>push(a+b);

<p class=MsoNormal style='margin-left:99.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:99.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case '-':

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>a = pop();

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>b = pop();

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>answer = b-a;

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>push(b-a);

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:99.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case '* ':

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>a = pop();

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>b = pop();

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>answer = b*a;

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>push(b*a);

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:99.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case '/ ':

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>a = pop();

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>b = pop();

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(a==0) 

<p class=MsoNormal style='margin-left:132.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(0,
&quot;divide by 0\n&quot;);

<p class=MsoNormal style='margin-left:132.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>answer = b/a;

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>push(b/a);

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:99.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>default:

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>push(atoi(in));

<p class=MsoNormal style='margin-left:110.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>continue;

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:77.0pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>itoa(answer, out, 10);

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_puts(1, out);

<p class=MsoNormal style='margin-left:66.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes">   </span>while(*in);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>deactivate(1);

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* Поместить число в
стек.

<p class=MsoNormal style='0cm;margin-right:154.0pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>Возвратить 1 в случае
успеха и 0 если стек переполнен

<p class=MsoNormal style='0cm;margin-right:154.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:154.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>push(i)

<p class=MsoNormal style='0cm;margin-right:154.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int i;

<p class=MsoNormal style='0cm;margin-right:154.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:154.0pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(p&gt;bos) return 0;

<p class=MsoNormal style='0cm;margin-right:154.0pt;
0cm;margin-left:38.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*p = i;

<p class=MsoNormal style='0cm;margin-right:154.0pt;
11.1pt;margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>p++;

<p class=MsoNormal style='0cm;margin-right:154.0pt;
0cm;margin-left:44.0pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 1;

<p class=MsoNormal style='0cm;margin-right:154.0pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:83.6pt;
0cm;margin-left:44.0pt;.0001pt;text-indent:-16.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>/* Извлечь верхний элемент из стека. Возвратить 0 если стек пуст.

<p class=MsoNormal style='0cm;margin-right:83.6pt;
0cm;margin-left:27.5pt;.0001pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*/

<p class=MsoNormal style='0cm;margin-right:83.6pt;
22.2pt;margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt'>pop() 

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>p--;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(p&lt;tos) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>p++;

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return 0;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>return *p;

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/**********************************************************/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;tab-stops:135.5pt 375.5pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>/*<span
style='mso-tab-count:1'>                                            </span>Всплывающая
записная книжка<span style='mso-tab-count:1'>                                                </span>*/

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#define MAX_NOTE 10

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>#define BKSP 8

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char notes[MAX_NOTE]
[80];

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>void notepad()

<p class=MsoNormal style='margin-left:27.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>static first = 1;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>register int i, j;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>union inkey 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>char ch[2];

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>int i;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><span
style="mso-spacerun: yes"> </span>c;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>char ch;

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>/*
инициализировать массив записей если это необходимо */

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(first) 

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(i=0;
i&lt;MAX_NOTE; i++)

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>*notes[i] = '\0 ';

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>first = !first;

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>window(0);

<p class=MsoNormal style='margin-left:38.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* вывести
существующие записи */

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(i=0;
i&lt;MAX_NOTE; i++) 

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(*notes[i])
window_puts(0, notes[i]);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_putchar(0, '\n
');

<p class=MsoNormal style='margin-left:49.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>i = 0;

<p class=MsoNormal style='0cm;margin-right:0cm;11.1pt;
margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>window_xy(0, 0, 0);

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>for(;;) 

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>c.i = bioskey(0);<span
style="mso-spacerun: yes">  </span>/* обработать нажатие клавиши */

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>if(tolower(c.ch[1])==59)<span
style="mso-spacerun: yes">  </span>/* F1 для выхода */

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>deactivate(0);

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal align=center style='text-align:center;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>/* если обычная
клавиша */

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(isprint(c.ch[0]) ||
c.ch[0]==BKSP) 

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_cleol(0);

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>notes[i][0] = c.ch[0];

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>j = 1;

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_putchar(0,
notes[i][0]);

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'>do<span style="mso-spacerun: yes"> 
</span>

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>ch = window_getche(0);

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(ch == BKSP) 

<p class=MsoNormal style='margin-left:104.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if( j&gt;0 ) 

<p class=MsoNormal style='margin-left:104.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>j--;

<p class=MsoNormal style='margin-left:104.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_bksp(0);

<p class=MsoNormal style='margin-left:104.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>else 

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>notes[i][j] = ch;

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>j++;

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='0cm;margin-right:0cm;22.2pt;
margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:
none'><span style='font-size:10.0pt'><span style="mso-spacerun:
yes"> </span>while(notes[i][j-1]! = '\r ');

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>notes[i][j-1] = '\0 ';

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>i++;

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_putchar(0, '\n
');

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:60.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>else<span
style="mso-spacerun: yes">  </span>/* если специальная клавиша */

<p class=MsoNormal style='margin-left:71.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>switch(c.ch[1]) 

<p class=MsoNormal style='margin-left:82.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 72: /* стрелка
вверх */

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(i&gt;0) 

<p class=MsoNormal style='margin-left:104.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>i--;

<p class=MsoNormal style='margin-left:104.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_upline(0);

<p class=MsoNormal style='margin-left:93.5pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:88.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<p class=MsoNormal style='margin-left:77.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>case 80: /* стрелка
вниз */

<p class=MsoNormal style='margin-left:88.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>if(i&lt;MAX_NOTE-1) 

<p class=MsoNormal style='margin-left:99.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>i++;

<p class=MsoNormal style='margin-left:99.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>window_downline(0);

<p class=MsoNormal style='margin-left:88.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'><![if !supportEmptyParas]>&nbsp;<![endif]>

<p class=MsoNormal style='margin-left:88.0pt;mso-hyphenate:none;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt'>break;

<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="3-13">Тайна 28-го прерывания </a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:4.4pt;0cm;
margin-left:27.5pt;.0001pt;text-align:justify;text-indent:27.5pt;
mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Есть одно средство DOS, которое не описывается в
документации, и которое может сделать TSR-программы более надежными в тот
период времени, когда они используют много системных ресурсов. Вообще говоря,
если прикладная часть вашей TSR-программы занимается обменом только с консолью,
то вы застрахованы от неприятностей. Неприятности могут возникнуть при
использовании таких объектов, как дисковые файлы или порты ввода­вывода. Хотя
это и не описано в технических руководствах по операционной системе, но DOS
вызывает прерывание 28Н, когда она находится в &quot;безопасном&quot;, т.е.
холостом состоянии. Как вам наверное известно, при выполнении определенных
функций DOS, которые относятся к критическим участкам, после начала их
выполнения прерывания должны быть запрещены. Прерывание 28Н никогда не
вызывается DOS во время выполнения критического участка. Вы можете использовать
это средство для защиты от сбоев вашей TSR-программы. Хотя здесь не
представлено никаких примеров программ, но предлагаются следующие общие
соображения по этому вопросу.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
0cm;margin-left:27.5pt;.0001pt;text-align:justify;text-indent:
27.5pt;mso-hyphenate:none;mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt'>Главное отличие, которое вы должны иметь ввиду при
использовании прерывания 28Н, заключается в способе активации прикладной части
вашей TSR-программы. Когда вызывается прерывание 28Н, прикладная часть
TSR-программы не может больше активироваться через программу обработки нажатий
клавиш. Вместо этого программа обработки нажатий клавиш при нажатии
&quot;горячей клавиши&quot; просто устанавливает флаг (в дальнейшем именуемый
is-hotkey). Перед тем, как прикладная часть вашей TSR-программы может быть
вызвана, вы должны создать новый обработчик прерывания 28Н, который будет
проверять, установлен флаг is-hotkey или нет. Если установлен, то прикладная
часть активируется, сбрасывая при этом флаг is-hotkey. При этом вы обязательно
должны не просто изменить первоначальное содержимое вектора прерывания 28Н, а
напротив, сохранить его и вызывать исходное прерывание 28Н из вашего
обработчика 28-го прерывания.

<p class=MsoNormal style='11.1pt;margin-right:4.4pt;
144.3pt;margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:
none;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt'>Если вы собираетесь продавать ваши TSR-программы, то должны обязательно
использовать прерывание 28Н (хотя по нему и нет документации), поскольку оно
позволяет избежать случайных прерываний DOS во время выполнения критических
участков. 
<!--<br><br><a href="#top">наверх</a>-->
<p><div align="center"><b><font size="+1"><i><a name="3-14">Проблемы при создании TSR-программ
</a></i></font></b></div></p>

<p class=MsoNormal style='0cm;margin-right:4.4pt;
margin-left:27.5pt;text-align:justify;text-indent:27.5pt;mso-hyphenate:none;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt'>TSR-программы
по своей природе очень склонны к сбоям. Например, использование TSR-программы,
разработанной одним программистом, часто делает невозможным одновременное
использование другой TSR-программы, разработанной другим программистом, поскольку
обе программы будут пытаться переназначить адрес программы обработки прерывания
9 в таблице векторов на себя. Несомненно, при использовании своих TSR-программ
вы можете избежать такого рода проблем, но будьте внимательны, если в вашей
системе присутствует чужая TSR-программа. 

</body>

</html><!--Saved from http://mymanual.narod.ru>
