<HTML><HEAD>
<TITLE>Индексация указателей</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=Windows-1251"> 
<LINK REL=STYLESHEET TYPE="text/css" HREF="../work/css.css">
</HEAD><BODY>
<A href="../main.htm#04">Содержание</A> | <A href="0406.htm">&lt;&lt;&lt;</A> | <A href="0408.htm">&gt;&gt;&gt;</A><HR>
<H1>Индексация указателей</H1>
<P class="tj">Указатели и массивы тесно связаны друг с другом. Имя массива без индекса — это указатель на первый (начальный) элемент массива. Рассмотрим, например, следующий массив:
<PRE>char p[10];</PRE>
<P class="tj">Следующие два выражения идентичны:
<PRE>p
&p[0]</PRE>
<P class="tj">Выражение
<PRE>p == &p[0]</PRE>
<P class="t">принимает значение ИСТИНА, потому что адрес 1-го элемента массива — это то же самое, что и адрес массива.
<P class="tj">Как уже указывалось, имя массива без индекса представляет собой указатель. И наоборот, указатель можно индексировать как массив. Рассмотрим следующий фрагмент программы:
<PRE>
int *p, i[10];
p = i;
p[5] = 100;  /* в присваении используется индекс */
*(p+5) = 100; /* в присвоении используется адресная арифметика */
</PRE>
<P class="tj">Оба оператора присваивания заносят число 100 в 6-й элемент массива <KBD>i</KBD>. Первый из них индексирует указатель <KBD>p</KBD>, во втором применяются правила адресной арифметики. В обоих случаях получается один и тот же результат. (Подробно указатели и адресная арифметика рассматриваются в <A href="../05/05.htm">главе 5</A>.)
<P class="tj">Можно также индексировать указатели на многомерные массивы. Например, если <KBD>а</KBD> — это указатель на двухмерный массив целых размерностью 10&#215;10, то следующие два выражения эквивалентны:
<PRE>a
&a[0][0]</PRE>
<P class="tj">Более того, к элементу (0,4)<SUP><A href="#11" name="1">[1]</A></SUP> можно обратиться двумя способами: либо указав индексы массива: <KBD>а[0][4]</KBD>, либо с помощью указателя: <KBD>*((int*)а+4)</KBD>. Аналогично для элемента (1,2): <KBD>а[1][2]</KBD> или <KBD>*((int*)а+12)</KBD>. В общем виде для двухмерного массива справедлива следующая формула:
<PRE>a[j][k] эквивалентно *((<I>базовый_тип</I>*)а+(j*<I>длина_строки</I>)+k)</PRE>
<P class="tj">Правила адресной арифметики требуют явного преобразования указателя на массив в указатель на базовый тип (см. <A href="../05/05.htm">главу 5</A>). Указатели используются для обращения к элементам массива потому, что часто операции адресной арифметики выполняются быстрее, чем индексация массива.
<P class="tj">Двухмерный массив может быть представлен как указатель на массив одномерных массивов. Добавив еще один указатель, можно с его помощью обращаться к элементам отдельной строки массива. Этот прием демонстрируется в функции <KBD>pr_row()</KBD>, которая печатает содержимое конкретной строки двухмерного глобального массива <KBD>num</KBD>:
<PRE>
int num[10][10];

/* ... */

void  pr_row(int j)
{
  int *p, t;

  p = (int *) &num[j][0]; /* вычисление адреса 1-го
                             элемента строки номер j */

  for(t=0; t&lt;10; ++t) printf("%d ", *(p+t));
}
</PRE>
<P class="tj">Эту функцию можно обобщить, включив в список аргументов номер строки, длину строки и указатель на 1-й элемент:
<PRE>
void pr_row(int j, int row_dimension, int *p)
{
  int t; 

  p = p + (j * row_dimension);

  for(t=0; t&lt;row_dimension; ++t)
    printf("%d ", *(p+t));
} 

/* ... */

void f(void)
{
  int num[10][10];

  pr_row(0, 10, (int *) num); /* печать 1-й строки */
}
</PRE>
<P class="tj">Такой прием "понижения размерности" годится не только для двухмерных массивов, но и для любых многомерных. Например, вместо того, чтобы работать с трехмерным массивом, можно использовать указатель на двухмерный массив, причем вместо него в свою очередь можно использовать указатель на одномерный массив. В общем случае вместо того, чтобы обращаться к <I>n</I>-мерному массиву, можно работать с указателем на (<I>n-1</I>)-мерный массив. Причем этот процесс понижения размерности кончается на одномерном массиве.
<P><IMG src="../work/sup.bmp" alt="----------">
<BLOCKQUOTE>
<P class="tj"><SUP><A href="#1" name="11">[1]</A></SUP>Так обозначается элемент, у которого первая координата равна 0, а вторая — 4.
</BLOCKQUOTE>
<HR><A href="../main.htm#04">Содержание</A> | <A href="0406.htm">&lt;&lt;&lt;</A> | <A href="0408.htm">&gt;&gt;&gt;</A>
</BODY></HTML>