
                         ПО КНИГЕ ГЕРБЕРТА ШИЛДТА













                           +---------------+
                           |               |
                           |    +------+   |
                           |    |      +---+
                           |    |
                           |    |
                           |    |
                           |    |
                           |    |
                           |    |      +---+
                           |    +------+   |
                           |               |
                           +---------------+



                    ДЛЯ ПРОФЕССИОНАЛЬНЫХ ПРОГРАММИСТОВ






                                ЧАСТЬ 1.













                             Москва, 1989 г.













                         С О Д Е Р Ж А Н И Е


Предисловие ......................................................  7

ГЛАВА 1. ИСЧЕЗАЮЩИЕ И ИЕРАРХИЧЕСКИЕ МЕНЮ .........................  9
Что такое исчезающие и иерархические меню? ....................... 11
Работа видеоадаптеров ............................................ 13
Доступ к экрану через BIOS ....................................... 18
Использование int86() ............................................ 19
Сохранение части экрана .......................................... 21
Восстановление экрана ............................................ 24
Создание исчезающих меню ......................................... 26
Высвечивание меню ................................................ 28
Высвечивание рамки ............................................... 31
Ввод выбора пользователя ......................................... 32
Функция popup() .................................................. 39
Общий обзор ...................................................... 42
Прямой доступ к видео памяти ..................................... 55
Определение расположения видео памяти ............................ 56
Изменение save_video() и restore_video() ......................... 58
Создание иерархических окон ...................................... 77
Фреймы меню ...................................................... 78
Создание фрейма меню ............................................. 79
Функция pulldown() ............................................... 82
Восстановление экрана ............................................ 85
Простая программа, использующая процедуру pulldown ............... 86


ГЛАВА 2. ВСПЛЫВАЮЩИЕ ОКНА ....................................... 108
Теория всплывающих окон ......................................... 109
Оконные структуры ................................................112
Создание структуры окна ..........................................114
Активирование и деактивирование окна .............................117
Оконные функции ввода/вывода .....................................121
Функция позиционирования курсора в окне ..........................122
Функция window_getche() ..........................................124
Функция window_gets() ............................................128
Функция window_putchar() .........................................130
Функция window_puts ..............................................133
Дополнительные функции управления экраном ........................134
Изменение размера и положения окна во время выполнения программы .139
Создание прикладных программ, использующих всплывающие окна ......147
Программа преобразов. из десят. в шестнадц. систему счисления ....148
Калькулятор с четырьмя функциями .................................150
Всплывающая записная книжка ......................................155
Совместное использование всех программ ...........................159
Модификации программ управления окнами ...........................204


ГЛАВА 3. ПРОГРАММЫ, ОСТАЮЩИЕСЯ РЕЗИДЕНТНЫМИ ......................210
Что такое TSR-программа? .........................................212
Прерывания в семействе процессоров 8086 ..........................213
Прерывания против DOS и BIOS: Tревога в стране DOS ...............214
Модификатор функций прерывания Турбо Си ..........................216
Общий план TSR-программы .........................................218
Использование прерывания печати экрана ...........................219
Раздел инициализации .............................................220
Прикладная часть TSR-программы ...................................225
Использование прерывания по нажатию клавиши ......................254
Буфер символов, введенных с клавиатуры ...........................256
Функция инициализации ............................................258
Прикладная часть TSR-программы ...................................260
Тайна 28-го прерывания ...........................................296
Проблемы при создании TSR-программ ...............................298


ГЛАВА 4. ГРАФИКА .................................................299
Видеорежимы и цветовая палитра ...................................301
Запись точки растра ..............................................305
Работа адаптеров CGA/EGA в графическеом режиме ...................306
Вычерчивание линий ...............................................311
Изображение и закрашивание прямоугольников .......................316
Вычерчивание окружностей .........................................318
Простейшая тестовая программы ....................................322
Сохранение и загрузка графических изображений ....................333
Дублирование части экрана ........................................338
Вращение точки в плоскости экрана ................................341
Вращение обьекта .................................................345
Сборка подпрограмм ...............................................364


ГЛАВА 5. ВИДЕОИГРЫ ...............................................410
Спрайты ..........................................................411
Поле игры ........................................................413
Мультипликация на экране .........................................413
Мультипликация спрайта ...........................................429
Организация данных в видеоиграх ..................................434
Контроль границ ..................................................434
Изменение цвета ..................................................435
Табло счета активного противника .................................436
Разработка видеоигры .............................................437
Тело главной программы ...........................................443
Программа генерации движения спрайта компьютера ..................452
Программа контроля касания спрайтов ..............................460
Полный текст программы игры TAG ..................................461
Некоторые соображения по возможной модификации программы .........490



                                ЧАСТЬ 2.


ГЛАВА 6. ИСПОЛЬЗОВАНИЕ ПОСЛЕДОВАТЕЛЬНОГО ПОРТА... ................  5
Асинхронная последовательная передача данных .....................  7
Стандарт RS-232 .................................................. 10
Аппаратное подтверждение связи ................................... 13
Проблемы передачи данных ......................................... 14
Переполнение регистра-приемника .................................. 15
Доступ к последовательному порту компьютера через BIOS ........... 16
Инициализация порта .............................................. 17
Передача байтов .................................................. 23
Контроль состояния порта ......................................... 24
Прием байтов ..................................................... 27
Передача файлов между компьютерами ............................... 30
Программное подтверждение связи .................................. 32
Семь и восемь бит данных ......................................... 34
Перекачка файла .................................................. 35
Прием файла ...................................................... 41
Перекачка программы .............................................. 44
Использование средств перекачки программ ......................... 56
Дальнейшее совершенствование программы ........................... 57
Простейшая ЛВС ................................................... 59
Файловый сервер .................................................. 61
Загрузка удаленных файлов в узел сети ............................ 84
Хранение файлов .................................................. 93
Использование ЛВС ................................................103
Совершенствование ЛВС ............................................103

ГЛАВА 7. ИНТЕРПРЕТАТОРЫ ЯЗЫКА ....................................105
Синтаксический разбор выражений ..................................107
Выражения ........................................................108
Лексемы ..........................................................111
Порядок построения выражений .....................................121
Синтаксический анализатор выражений ..............................125
Как анализатор обрабатывает переменные ...........................142
Интерпретатор языка SMALL BASIC ..................................144
Основной цикл работы анализатора .................................149
Команда присваивания значений ....................................152
Команда PRINT ....................................................154
Команда INPUT ....................................................158
Команда GOTO .....................................................160
Оператор IF ......................................................166
Цикл FOR .........................................................169
Оператор GOSUB ...................................................176
Полный файл интерпретатора .......................................180
Пример использования интерпретатора SMALL BASIC ..................203
Расширение возможностей интерпретатора ...........................206

ГЛАВА 8. О МАНИПУЛИРОВАНИИ ЭКРАНОМ И ГЕНЕРАЦИИ ЗВУКА .............207
Использование цвета в текстовом режиме ...........................209
Атрибутный байт текстового режима ................................210
Отображение строки в определенном цвете ..........................213
Использование цвета ..............................................219
Изменение размера курсора ........................................220
Скроллинг части экрана ...........................................224
Простейшая демонстрационная программа ............................227
Сохранение копии экрана в дисковом файле .........................237
А теперь добавим звук ............................................241
Программируемый таймер 8253 ......................................241
Простейший способ проверки слуха .................................245
Имитация звука сирены и взврывы ..................................249
Создание "космической музыки" ....................................254

ГЛАВА 9. ИНТЕРФЕЙС С "МЫШЬЮ" .....................................257
Некоторые начальные сведения о "мыши" ............................260
Виртуализация и реальный экран ...................................263
Библиотека поддержки "мыши" ......................................264
Функции поддержки "мыши" верхнего уровня .........................269
Простейшая демонстрационная программа ............................277
Ввод информации с помощью "мыши" в программе рисования ...........287
Основной цикл работы программы ...................................292
Определение объектов с помощью "мыши" ............................307
Полный текст модифицированной программы рисования ................314
Некоторые возможности расширения выполняемых функций программы ...363

ГЛАВА 10. СОЗДАНИЕ КОММЕРЧЕСКИХ ДИАГРАММ .........................364
Нормализация данных ..............................................365
Разработка функций построения диаграмм ...........................367
Программа вычерчивания диаграмм ..................................390
Отображение диаграмм на экране дисплея ...........................421
Некоторые интересные идеи по модификации программ ................426






               Предисловие
     -----------------------------------------------------------------

          Если вы  хотите   создавать   программы   мирового   уровня,
     написанные на Си, то эта книга - для вас!

          Меня зовут Герб Шилдт.  Я ветеран программирования во многих
     компаниях и программирую на Си более десяти лет.  Перед тем,  как
     начать  писать  эту  книгу,  я изучил большое количество удачного
     программного обеспечения,  пытаясь определить,  какие  черты  они
     имеют  в отличие от менее удачных программ. Я  хотел понять,  что
     делает одни программы более удачными, чем другие, аналогичные им.
     После  этого  прояснились  общие  черты.  Удачные  программы были
     написаны  людьми,  которые  не  только  имели  крепкую  хватку  в
     специальной  области,  но  и  в совершенстве освоили оборудование
     компьютера,   включая   операционную   систему    и    аппаратное
     обеспечение.  Только программист,  осуществляющий полный контроль
     над  ними  может  писать  программы  с  дружелюбным   интерфейсом
     пользователя  которые эффективно выполняются и дают пользователям
     большую гибкость.

          Эта книга открывает многие секреты,  используемые  мастерами
     программирования  для достижения профессиональных результатов.  С
     ее  помощью  вы  расширите  подходы  и  методы,  которые   делают
     программы  интересными.  После прочтения книги вы будете способны
     писать  программы,    которые     заслужат     внимание.    Здесь
     рассматриваются следующие вопросы:

     # Прямой доступ к памяти экрана для быстрого отображения
     # Исчезающие и иерархические (popup и pulldown) меню
     # Процедуры работы с окнами
     # Завершение программ и оставление их в памяти
     # Интерфейс с мышью
     # Графические функции, включая вращение объектов
     # Языковые интерпретаторы
     # Передача файлов через последовательный порт

          Эта книга для  любого  и  каждого  программиста  на  Си,  от
     новичка  до  профессионала.  Даже  если вы начинающий,  вы можете
     использовать функции и программы  из  этой  книги  без  понимания
     отдельных деталей их работы.  Более подготовленные читатели могут
     использовать эти программы как основу для своих приложений.

          Исходные тексты этой  книги  соответствуют  стандарту  ANSI,
     кроме  некоторых функций,  специфичных для ПК.  Таким образом все
     эти программы можно компилировать на любом  компиляторе,  который
     поддерживает стандарт. Я использовал для их разработки Турбо Си и
     Microsoft Си.

          Некоторые из  многих  полезных  и   интересных   функций   и
     программ, содержащихся в книги достаточно длинны.  Если вы, как и
     я,  возможно хотите использовать их,  но вам лень набивать их  на
     компьютере и потом выискивать неизбежные опечатки,  то для такого
     случая я предоставляю исходные коды,  содержащиеся в этой  книге,
     на дискете.  Цена услуги - 24.95$.  Заполните приложенную форму и
     пошлите  ее  по  указанному  адресу  вместе  с   оплатой.   Можно
     использовать карточки MasterCard и Visa.