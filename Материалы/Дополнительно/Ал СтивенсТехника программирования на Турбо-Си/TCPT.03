
                             ГЛАВА 3
                             -------

                        Компилятор Турбо Си
     -----------------------------------------------------------------

          В декабре 1986 г.  небольшая компания под  названием  Wigard
     Software   Systems,   Inc.   объявила о своем  переезде из гopoда
     Армингтон,   штат   Массачусетс,   в  город  Монте  Серено,  штат
     Калифорния.  Эта   компания  создала и начала продажу компилятора
     Си стоимостью 450 долларов под названием Wizard C.

          Wizard C был компилятором,  заслуживающим  уважения,  всегда
     получающим хорошие отзывы в обзорах и даже названный,  по крайней
     мере  одним  из  обозревателей,  "лучшим"  компилятором  Си.  Его
     достоинства   заключались   в    высокой   скорости   компиляции,
     эффективной    оптимизации   получаемого    кода,    соответствии
     предложениям   стандарта АNSI  и большом числе  расширений языка,
     позволяющих разрабатывать  программы  обработки  прерываний.  Эти
     расширения  заключали в   себе  функцию   прерывания специального
     типа,   возможность встраивания в  тело  программы  фрагментов на
     языке   ассемблера,  псевдопеременные,  с   помощью   которых  из
     языка Си выполняется доступ к регистрам микропроцессора.

          В феврале   1987   г.   фирма   Borland   International   из
     Скоттс-Веллей,  штат Калифорния,  объявила о создании компилятора
     Турбо Си,  который ожидался с  нетерпением  после  появления  его
     предшественника,   очень   удачного   компилятора   ТурбоПаскаль.
     Объявление содержало оценку эффективности, заверенную несколькими
     экспертами.  Они  утверждали,  что  скорость  компиляции Турбо Си
     будет достигать 7000  строк  в  минуту,  что  превышало  скорость
     самого  быстрого на то время компилятора Си.  По мнению экспертов
     было  достигнуто  предельное  значение   производительности   для
     компиляторов  Си  и  не ожидалось появление компилятора,  который
     превзошел бы это значение.

          В том  же месяце Wizard сделала своe последнee объявление. В
     мае 1987 г. появилась версия 1.0 Турбо Си (совместно с T-shirts).
     Перчатка была брошена и соревнование объявлено.  Турбо Си подавил
     всех своими характеристиками.

          На самом деле фирма Вorland  International  приобрела  фирму
     Wigard Systems для того,  чтобы создать Турбо Си.  Промышленность
     делала  предположения  о  том,   когда  Borland  выйдет  на рынок
     компиляторов   Си,   после   того,   как она уже представила свои
     изделия:  Турбо-Паскаль,   а  вслед  за  ним   очень   популярный
     Турбо-Бейсик.  Вместо того,   чтобы предпринимать большие усилия,
     начиная с нуля, фирма Borland приняла мудрое решение:  она купила
     лучший компилятор   Си   и сконцентрировала усилия на том,  чтобы
     сделать его еще лучше.

          На момент анонсирования фирмой Borland своего компилятора на
     рынке было представлено 17 компиляторов Си для IBM  PC. Несколько
     человек решили,  что миру нужен еще один. Таковы краткие сведения
     о фирме Borland International Филиппа Кана,  которые тем не менее
     приковывают    внимание    и   захватывают   воображение.   После
     опубликования информации о Турбо Си многие  сомневались, немногие
     имели   представление   о   нем,   но  все  жаждали  увидеть  его
     собственными  глазами.  Мир  Си  готов  был  принять   еще   один
     компилятор,  при  условии,  что он поступит от Вorland.  Само это
     состояние ожидания имело очень большое  значение.  Фирма  Borland
     начала  дело не для того,  чтобы создать очередной компилятор Си;
     Borland поставила целью изменить представления о том,  как должна
     выглядеть  программная среда для разработки программ на языке Си.
                                                                       20


                Два Турбо Си
     -----------------------------------------------------------------

          Турбо Си обозначает два программных изделия: пакет программ,
     обеспечивающий выполнение последовательности команд в стиле Unix:
     make/compiler/linker,  и  интегрированную  программную  среду для
     разработки программ.

          Пакет программ  содержит  утилиту  make,  компилятор  tcc  и
     настраиваемый компоновщик.  Последующие версии  несомненно  будут
     включать  объектную  библиотеку.  Компилятор,  входящий  в пакет,
     похож на большинство  других  компиляторов  Си  для  IBM  PC,  но
     является  более  быстрым.  Программисты,  которые предпочтут этот
     пакет Турбо  Си,  найдут  все,  что  им  нужно,  включая  удобный
     редактор.  Поскольку вы приобрели эту книгу, то, вероятно, вы уже
     имеете или собираетесь приобрести Турбо Си.  Все,  что Вам  нужно
     знать  по  этому пакету,  содержится в руководстве пользователя и
     справочном руководстве.

          Интегрированная программная   среда    представляет    собой
     программу  под названием tc,  которая объединяет в себе текстовый
     редактор,  ориентированный на создание текстов программ на  языке
     Си, построитель задач, ориентированный на реализацию программного
     проекта,  и утилиты исполнения программ.  В  будущем  планируется
     включение  символьного  отладчика.  Наличие интегрированной среды
     выделяет Турбо Си среди конкурентов (также,  как и ее  безусловно
     блестящая реализация).

          Интегрированную среду  можно  считать витриной Турбо Си.  Ее
     большим  достоинством  является  достигнутый  уровень  интеграции
     между  редактором,   компилятором  и  компоновщиком.  Находясь  в
     интегрированной среде, программист может редактировать программу,
     транслировать    ее,   компоновать   ее   с   другими   исходными
     модулями  и  библиотеками  и  запускать  на  выполнение.   Данное
     качество является основным для нового поколения  компиляторов Си.
     Это  похоже  на  то,  чего фирма  Borland  достигла  тремя годами
     раньше    на   компиляторе  Турбо-Паскаль,   но   чего   не  было
     достигнуто до этого времени на  компиляторе Си.   Ожидается,  что
     основные  конкуренты  в   ближайшем  будущем  достигнут подобного
     уровня.



                Настройка интегрированной среды
     -----------------------------------------------------------------

          Вы имеете  возможность  настроить  интегрированную среду,  в
     которой все, от цвета изображения на экране до уровня контроля за
     ошибками,  может быть установлено по вашему требованию. Некоторые
     установки производятся при выполнении программы TCINST,  другие -
     путем  использования  меню,  создаваемых  интерактивной  системой
     ввода интегрированной среды и возникающих в верхней части экрана.
     Ниже   приводится   список  параметров,  значения  которых  могут
     устанавливаться по требованию заказчика:

      - модель памяти: крошечная, малая, средняя, компактная, большая,
        огромная;
      - соглашение о вызываемых функциях: Си или Паскаль;
      - микропроцессор: 8088/8086 или 80186/80286;
      - плавающая арифметика: отсутствует, сопроцессор или эмуляция;
      - уровень оптимизации;
      - уровень контроля за ошибками.

                                                                       21

          Вы можете выбирать и  большее  число  параметров  Турбо  Си.
     Турбо  Си  способен  осуществлять  строгий контроль за ошибками и
     подозрительными местами в программе  и  выдавать  предупреждающие
     сообщения.   Вы   можете   использовать   Устанавочное  Меню  для
     подавления  предупреждающих  сообщений.  Вы   можете   установить
     необходимость  соответствия  жестким  требованиям  ANSI или менее
     жестким требованиям стандарта,  изложенного в книге " K & R".  Вы
     можете  потребовать  выдачи  предупреждающего сообщения при любом
     несоответствии описания функции и прототипа или  можете разрешить
     неявное  описание функции и определение случайных параметров, как
     это делается в так называемых K & R-компиляторах.

          Возможно, вам  захочется  изменить  цвета   изображений   на
     экране.  Вы можете выбрать один из трех цветовых наборов, включая
     цветовой набор  по  умолчанию  (слишком  ярок),  бирюзовый  набор
     (неприятен) или малиновый набор (просто ужасен). Не отчаивайтесь,
     программа TCINST позволит выбрать  цвет  и  яркость  для  каждого
     отдельно  определяемого компонента интегрированной среды. Следует
     помнить,  что в данном обзоре имеются  в  виду  цветовые  наборы,
     формируемые   системой  СGA.  Вполне  возможно,  что  они  вам  и
     нравятся.



                Редактор Турбо Си
     -----------------------------------------------------------------

          В первом приближении редактор Турбо  Си  похож  на  редактор
     системы  WordStar,  работающий в режиме,  альтернативном к режиму
     "документ".  Архитектура этого редактора  характерна  для  многих
     других  программных  изделий Borland,  включая программу Sidekick
     Notepad и редактор  Турбо-Паскаля.   Eсли  вы  умеете  работать с
     редактором Турбо-Паскаля,  то  вы умеете работать  и с редактором
     Турбо  Си.  Однако в случае  приобретения  именно этого редактора
     пользователи      получат     некоторые    преимущества.    Путем
     использования программы TCINST вы можете изменить размер окна  по
     умолчанию     и   назначение    клавиш   команд   редактирования.
     Программисты,   которые  раньше  работали  с  другим  редактором,
     оценят   предоставляемую   им редактором   Турбо  Си  возможность
     работы с  двумя  наборами  команд  редактирования,  что позволяет
     избежать  многих  затруднений.   Диапазон   изменения  параметров
     редактора  ограничен:    определенные  функциональные  клавиши  и
     комбинации различных клавиш с  клавишей  АLT зарезервированы  под
     "горячие клавиши"  и  не  могут  быть  задействованы  под команды
     редактирования.

          Редактор Турбо Си не такой мощный, как некоторые специальные
     программы  редактирования,  но  вполне  отвечает  требованиям  не
     слишком  больших   задач   по  редактированию.    Редактор  имеет
     неизменяемое   значение   интервала   для    клавиши   табуляции,
     соответствующее  восьми символьным промежуткам.  Это неудобно при
     работе с исходными  текстами  программ,  представленных  в данной
     книге,  так  как  их  интервалы  табуляции  соответствуют четырем
     символьным    промежуткам,   что  обусловлено  ограничениями  при
     печати.  Borland  поставляет  программу   PATCH.COM  и  несколько
     примеров    "заплат"   на   программы Compuserve  и BIX.  Один из
     этих  примеров  позволяет   вам   поставить  "заплату",   которая
     устанавливает   интервал    табуляции    на    четыре  символьных
     промежутка,   в   результате   чего   редактор  становится  очень
     удобным  для  программ  из  этой  книги.   Возможность  изменения
     интервала  табуляции,  вероятно,  будет предусмотрена в следующей
     реализации Турбо Си.


                                                                       22


                Компоновщик Турбо Си
     -----------------------------------------------------------------

          Турбо Си  имеет  свой   собственный   компоновщик,   который
     называется   TLINK.   Компоновщик   используется  для  связывания
     различных объектных модулей, каждый из которых может быть получен
     путем  трансляции  с  языков  Си,  ассемблера  и  других в единый
     загрузочный  модуль.  Объектные  файлы,  формируемые  Турбо   Си,
     соответствуют  стандарту  программы  LINK DOS,  поэтому они могут
     быть скомпонованы с объектными библиотеками  для  других  языков,
     включая  ассемблер.  Основной причиной использования компоновщика
     TLINK является его скорость, поскольку TLINK работает значительно
     быстрее, чем компоновщик LINK DOS.



                Утилита построителя задач (Make) в Турбо Си
     -----------------------------------------------------------------

          Компилятор Турбо  Си имеет утилиту Make,  характерную для ОС
     Unix и других компиляторов Си для IBM PC.  Интегрированная  Среда
     дает уникальную  возможность  связывать  при  разработке программ
     исходные и объектные модули  с  соответствующими  им загрузочными
     модулями.   В  этом  отношении  утилита  Make  Турбо  Си является
     традиционной.    Однако    утилита   Make   Турбо   Си   является
     частью  интегрированной среды  и  использует  файл сопровождения,
     называемый "файлом  проекта",   который является более легким для
     чтения и понимания, чем у командной утилиты MAKE. В файле проекта
     перечисляются исходные модули,  составляющие программу, по одному
     в каждой  строке.  Справа от  имени каждого модуля  можно указать
     другие файлы (например,  заголовки),  с которыми связаны исходные
     модули.   Эти файлы   заключаются   в скобки и отделяются друг от
     друга запятыми. Ниже приводится пример записи файла проекта:

              myprogram (keys.h, twindow.h)

          Если версия  модуля   myprogram.c   старше   версии   модуля
     myprogram.obj   либо  версии  модулей  key.h или twindow.h старше
     версии модуля myprogram.c,  то модуль myprogram.c транслируется в
     модуль  myprogram.obj.  Если  версия  модуля myprogram.obj старше
     версии модуля myprogram.exe,  то модуль myprogram.obj компонуется
     с  соответствующими  (зависящими  от   модели  памяти)  начальным
     объектным  файлом  и   исполняющей   библиотекой.   Использование
     проектной утилиты Make становится насущно  необходимым, когда при
     формировании  загрузочного  модуля   используются  многочисленные
     исходные  модули на Си, зависящие от различных файлов заголовков.

          Вы можете указывать объектные файлы и объектные библиотеки в
     проектном  файле  MAKE.   Интегрированная  cреда  будет  включать
     объектные файлы без  попытки  их  компиляции  и  будет отыскивать
     соответствующие  библиотечные  модули   для   разрешения  вызовов
     внешних  функций.











                                                                       23

                Обнаружение ошибок при компиляции и компоновке
     -----------------------------------------------------------------

          При построении  задачи  в  интегрированной  среде  Турбо  Си
     производится запись всех сообщений об ошибках  и предупреждениях.
     После   завершения  построения  задачи  сообщения  об  ошибках  и
     предупреждениях выводятся в одно окно,  в то время,  как исходный
     текст программы отображается в другом окне. Вы имеете возможность
     перемещаться по файлу  с  исходным  текстом  программы  вперед  и
     назад, от одной ошибки к другой. Интегрированная среда отображает
     каждое сообщение об ошибке и устанавливает  курсор  в  строке,  в
     которой  ошибка  была  обнаружена.  Вы можете внести исправления,
     какие считаете нужными,  и  снова  запустить  процесс  построения
     задачи.  Программа обнаружения ошибок следит за тем, удаляете или
     добавляете вы строки в исходном модуле, и соответствующим образом
     корректирует положение курсора.

                Программные средства низкого уровня
     -----------------------------------------------------------------

          Турбо Си  включает  несколько  расширений   языка   Си,   не
     обладающих  свойством  мобильности,  доставшиеся  в наследство от
     Wizard, но которые являются весьма существенными для программного
     обеспечения,  представленного  в  данной  книге.  Эти  расширения
     содержат программы обработки прерываний и других операций низкого
     уровня.

          Расширения языка   включают  функцию  типа  прерывание,  при
     вызове которой производится сохранение регистров  процессора 8086
     и  установка регистра сегмента данных на значение сегмента данных
     для  функции  прерывания.  Перед  тем,  как  функция   возвращает
     управление    вызывающей    программе,    содержимое    регистров
     восстанавливается.  Возврат осуществляется с помощью команды IRET
     процессора 8086, которая используется для возврата из прерываний.

          При включении  в  программу  на  Си фрагментов на ассемблере
     используется ключевое слово asm.  Все,  что следует  после  этого
     ключевого   слова,   поступает   непосредственно   на   обработку
     транслятором с ассемблера  фирмы  Microsoft,  который  вы  должны
     иметь,   чтобы   использовать   данную   возможность.  Включаемые
     ассемблерные фрагменты могут  использовать  имена  переменных  из
     программы  на  Си.  Эта  возможность  позволит  писать функции на
     ассемблере,  которые не будут  зависеть  от  используемой  модели
     памяти.  Программы  без  ассемблерных  фрагментов не подвергаются
     обработке транслятором с  ассемблера,  а  только  компилятором  с
     языка   Си.   Программа   с   ассемблерными   фрагментами  должна
     компилироваться обязательно командным компилятором tcc, поскольку
     компилятор  tc  интегрированной  среды не допускает использования
     ассемблерных  фрагментов.  Фирма  Воrland  планирует  убрать  это
     ограничение в последующих реализациях.

          Несколько ключевых     слов    используется    в    качестве
     псевдопеременных для осуществления  непосредственного  доступа  к
     регистрам ЭВМ. Если вам известно, что содержат регистры и как это
     можно  использовать,  то  вы  можете  оптимизировать   выполнение
     некоторых  операций.  Будьте  внимательны при использовании этого
     средства.  Наилучшим  подходом   является   трансляция   исходной
     программы   на   Си  в  модуль  на  ассемблере  (что  достигается
     использованием ключа -S в командной строке  компилятора  tcc),  а
     затем  внесение  изменений  в полученный модуль.  При переходе на
     следующие  версии  Турбо  Си  вы  должны  проверить   возможность
     использования  каждого  из  описанных средств.  Нет уверенности в
     том,  что Borland не изменит способ доступа к  регистрам,  и  это
     изменение может сделать ваши программы неработоспособными.
                                                                       24


                Начальная установка
     -----------------------------------------------------------------

          Самым слабым местом документации по Турбо Си является раздел
     по  начальной установке.   Есть ряд  фактов,  которые обязательно
     необходимо  знать,    а  структура  руководства  такова,  что  не
     позволяет легко найти нужную информацию.

          И командный компилятор,  и интегрированная среда  используют
     специальные файлы, в которых пользователь описывает требуемую ему
     конфигурацию.  Каждому из компиляторов соответствует  свой  файл.
     Руководство    дает  подробные  инструкции  по  подготовке  файла
     конфигурации   TURBOC.CFG  для  командного   компилятора  и  явно
     недостаточную   информацию  по файлу конфигурации TCCONFIG.TC для
     интегрированной  среды.   После того,  как вы произвели начальные
     установки в интегрированной  среде,  вы  должны запустить процесс
     инсталляции  еще  раз   и  установить   значения  параметров   по
     умолчанию,   включая  путь  доступа,   по которому  компилятор tc
     будет искать библиотеки,  стартовую программу, включаемые файлы и
     себя самого.

          Эти параметры    могут    быть    установлены    также    из
     интегрированной  среды  путем  выбора  меню Options (Параметров).
     После установки всех параметров такими, как вы хотели, выберите в
     меню  строку  "Запомнить",  завершая  тем  самым  создание  файла
     TCCONFIG.TC.



                Модели памяти
     -----------------------------------------------------------------

          Турбо Си   поддерживает  шесть  моделей  памяти:  крошечную,
     малую,  среднюю,  компактную,  большую  и  огромную.  Руководство
     пользователя   содержит  раздел,  посвященный  моделям  памяти  и
     разъясняющий сегментную организацию памяти для процессора  8086 и
     ее проявления в различных моделях памяти.  Советуем вам прочитать
     и  осмыслить  этот  раздел,   поскольку   понимание   архитектуры
     процессора    8086   позволит   использовать   и   модифицировать
     резидентные в памяти программные утилиты, представленные в данной
     книге.

                Библиотека исходных модулей
     -----------------------------------------------------------------

          Турбо Си  поставляется   без   исходных   текстов   программ
     библиотеки  функций  исполняющей системы.  Но каждый пользователь
     Турбо Си может купить лицензию на использование исходных текстов,
     которые в этом случае поставляются ему фирмой Borland.

 
                Заключение
     -----------------------------------------------------------------

          Раздел 4 начинает  описание  библиотеки  функций  Турбо  Си.
     После  прочтения  этого и последующих разделов вы получите в свое
     распоряжение инструментальные программные  средства,  необходимые
     для  создания  вашими программами всплывающих окон и последующего
     преобразования этих программ в резидентные утилиты.  На настоящий
     момент  нет  другого  компилятора,  который  поддерживал  бы  эти
     средства на таком же уровне, что и Турбо Си.


                                                                       25